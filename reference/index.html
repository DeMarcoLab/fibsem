
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../roadmap/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.0">
    
    
      
        <title>API Reference - FIBSEM Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.9f615399.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="FIBSEM Docs" class="md-header__button md-logo" aria-label="FIBSEM Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FIBSEM Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="FIBSEM Docs" class="md-nav__button md-logo" aria-label="FIBSEM Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    FIBSEM Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenFIBSEM
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../automation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../ml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine Learning
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Roadmap
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#acquire" class="md-nav__link">
    Acquire
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire" class="md-nav__link">
    acquire
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire.apply_clahe" class="md-nav__link">
    apply_clahe()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire.auto_gamma" class="md-nav__link">
    auto_gamma()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire.last_image" class="md-nav__link">
    last_image()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire.new_image" class="md-nav__link">
    new_image()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire.take_reference_images" class="md-nav__link">
    take_reference_images()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire.take_set_of_reference_images" class="md-nav__link">
    take_set_of_reference_images()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alignment" class="md-nav__link">
    Alignment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.alignment" class="md-nav__link">
    alignment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.alignment.align_using_reference_images" class="md-nav__link">
    align_using_reference_images()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.alignment.beam_shift_alignment" class="md-nav__link">
    beam_shift_alignment()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.alignment.correct_stage_drift" class="md-nav__link">
    correct_stage_drift()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.alignment.crosscorrelation_v2" class="md-nav__link">
    crosscorrelation_v2()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.alignment.shift_from_crosscorrelation" class="md-nav__link">
    shift_from_crosscorrelation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calibration" class="md-nav__link">
    Calibration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.calibration" class="md-nav__link">
    calibration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.calibration.align_needle_to_eucentric_position" class="md-nav__link">
    align_needle_to_eucentric_position()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conversions" class="md-nav__link">
    Conversions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions" class="md-nav__link">
    conversions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.convert_metres_to_pixels" class="md-nav__link">
    convert_metres_to_pixels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.convert_pixels_to_metres" class="md-nav__link">
    convert_pixels_to_metres()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.convert_point_from_metres_to_pixel" class="md-nav__link">
    convert_point_from_metres_to_pixel()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.convert_point_from_pixel_to_metres" class="md-nav__link">
    convert_point_from_pixel_to_metres()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.distance_between_points" class="md-nav__link">
    distance_between_points()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.get_lamella_size_in_pixels" class="md-nav__link">
    get_lamella_size_in_pixels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.image_to_microscope_image_coordinates" class="md-nav__link">
    image_to_microscope_image_coordinates()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#milling" class="md-nav__link">
    Milling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling" class="md-nav__link">
    milling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_bitmap" class="md-nav__link">
    draw_bitmap()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_circle" class="md-nav__link">
    draw_circle()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_fiducial" class="md-nav__link">
    draw_fiducial()
  </a>
  
    <nav class="md-nav" aria-label="draw_fiducial()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.milling.draw_fiducial--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_line" class="md-nav__link">
    draw_line()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_pattern" class="md-nav__link">
    draw_pattern()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_patterns" class="md-nav__link">
    draw_patterns()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_rectangle" class="md-nav__link">
    draw_rectangle()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_stress_relief" class="md-nav__link">
    draw_stress_relief()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_trench" class="md-nav__link">
    draw_trench()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.finish_milling" class="md-nav__link">
    finish_milling()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.read_protocol_dictionary" class="md-nav__link">
    read_protocol_dictionary()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.run_milling" class="md-nav__link">
    run_milling()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.run_milling_drift_corrected" class="md-nav__link">
    run_milling_drift_corrected()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.setup_milling" class="md-nav__link">
    setup_milling()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#movement" class="md-nav__link">
    Movement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.movement" class="md-nav__link">
    movement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.movement.angle_difference" class="md-nav__link">
    angle_difference()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.movement.rotation_angle_is_larger" class="md-nav__link">
    rotation_angle_is_larger()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.movement.rotation_angle_is_smaller" class="md-nav__link">
    rotation_angle_is_smaller()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structures" class="md-nav__link">
    Structures
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures" class="md-nav__link">
    structures
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.BeamSettings" class="md-nav__link">
    BeamSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.BeamSystemSettings" class="md-nav__link">
    BeamSystemSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.BeamType" class="md-nav__link">
    BeamType
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemDetectorSettings" class="md-nav__link">
    FibsemDetectorSettings
  </a>
  
    <nav class="md-nav" aria-label="FibsemDetectorSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemDetectorSettings.__from_dict__" class="md-nav__link">
    __from_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemDetectorSettings.__to_dict__" class="md-nav__link">
    __to_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemDetectorSettings.to_tescan" class="md-nav__link">
    to_tescan()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemExperiment" class="md-nav__link">
    FibsemExperiment
  </a>
  
    <nav class="md-nav" aria-label="FibsemExperiment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemExperiment.__from_dict__" class="md-nav__link">
    __from_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemExperiment.__to_dict__" class="md-nav__link">
    __to_dict__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemHardware" class="md-nav__link">
    FibsemHardware
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImage" class="md-nav__link">
    FibsemImage
  </a>
  
    <nav class="md-nav" aria-label="FibsemImage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImage.fromAdornedImage" class="md-nav__link">
    fromAdornedImage()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImage.fromTescanImage" class="md-nav__link">
    fromTescanImage()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImage.load" class="md-nav__link">
    load()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImage.save" class="md-nav__link">
    save()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImageMetadata" class="md-nav__link">
    FibsemImageMetadata
  </a>
  
    <nav class="md-nav" aria-label="FibsemImageMetadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImageMetadata.__from_dict__" class="md-nav__link">
    __from_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImageMetadata.__to_dict__" class="md-nav__link">
    __to_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImageMetadata.compare_image_settings" class="md-nav__link">
    compare_image_settings()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemManipulatorPosition" class="md-nav__link">
    FibsemManipulatorPosition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemMillingSettings" class="md-nav__link">
    FibsemMillingSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemPatternSettings" class="md-nav__link">
    FibsemPatternSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemRectangle" class="md-nav__link">
    FibsemRectangle
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemStagePosition" class="md-nav__link">
    FibsemStagePosition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemState" class="md-nav__link">
    FibsemState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemSystem" class="md-nav__link">
    FibsemSystem
  </a>
  
    <nav class="md-nav" aria-label="FibsemSystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemSystem.__from_dict__" class="md-nav__link">
    __from_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemSystem.__to_dict__" class="md-nav__link">
    __to_dict__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemUser" class="md-nav__link">
    FibsemUser
  </a>
  
    <nav class="md-nav" aria-label="FibsemUser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemUser.__from_dict__" class="md-nav__link">
    __from_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemUser.__to_dict__" class="md-nav__link">
    __to_dict__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.ImageSettings" class="md-nav__link">
    ImageSettings
  </a>
  
    <nav class="md-nav" aria-label="ImageSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.ImageSettings.fromFibsemImage" class="md-nav__link">
    fromFibsemImage()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.MicroscopeSettings" class="md-nav__link">
    MicroscopeSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.MicroscopeState" class="md-nav__link">
    MicroscopeState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.Point" class="md-nav__link">
    Point
  </a>
  
    <nav class="md-nav" aria-label="Point">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.Point.distance" class="md-nav__link">
    distance()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.Point.euclidean" class="md-nav__link">
    euclidean()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.StageSettings" class="md-nav__link">
    StageSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.SystemSettings" class="md-nav__link">
    SystemSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.check_data_format" class="md-nav__link">
    check_data_format()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.load_needle_yaml" class="md-nav__link">
    load_needle_yaml()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.save_needle_yaml" class="md-nav__link">
    save_needle_yaml()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.stage_position_from_dict" class="md-nav__link">
    stage_position_from_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.stage_position_to_dict" class="md-nav__link">
    stage_position_to_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    Utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils" class="md-nav__link">
    utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.configure_logging" class="md-nav__link">
    configure_logging()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.create_gif" class="md-nav__link">
    create_gif()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.current_timestamp" class="md-nav__link">
    current_timestamp()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.current_timestamp_v2" class="md-nav__link">
    current_timestamp_v2()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.get_params" class="md-nav__link">
    get_params()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.load_protocol" class="md-nav__link">
    load_protocol()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.load_settings_from_config" class="md-nav__link">
    load_settings_from_config()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.load_yaml" class="md-nav__link">
    load_yaml()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.make_logging_directory" class="md-nav__link">
    make_logging_directory()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.save_yaml" class="md-nav__link">
    save_yaml()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.setup_session" class="md-nav__link">
    setup_session()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    Validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.validation" class="md-nav__link">
    validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.validation.check_shift_within_tolerance" class="md-nav__link">
    check_shift_within_tolerance()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.validation.validate_initial_microscope_state" class="md-nav__link">
    validate_initial_microscope_state()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.validation.validate_stage_height_for_needle_insertion" class="md-nav__link">
    validate_stage_height_for_needle_insertion()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detection" class="md-nav__link">
    Detection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection" class="md-nav__link">
    detection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection.detect_bounding_box" class="md-nav__link">
    detect_bounding_box()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection.detect_centre_point" class="md-nav__link">
    detect_centre_point()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection.detect_closest_edge_v2" class="md-nav__link">
    detect_closest_edge_v2()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection.extract_class_pixels" class="md-nav__link">
    extract_class_pixels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection.plot_detection" class="md-nav__link">
    plot_detection()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection.plot_detections" class="md-nav__link">
    plot_detections()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils" class="md-nav__link">
    utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils.coordinate_distance" class="md-nav__link">
    coordinate_distance()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils.decode_segmap" class="md-nav__link">
    decode_segmap()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils.extract_img_for_labelling" class="md-nav__link">
    extract_img_for_labelling()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils.get_scale_invariant_coordinates" class="md-nav__link">
    get_scale_invariant_coordinates()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils.scale_coordinate_to_image" class="md-nav__link">
    scale_coordinate_to_image()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils.scale_pixel_coordinates" class="md-nav__link">
    scale_pixel_coordinates()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-interface" class="md-nav__link">
    User Interface
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.ui" class="md-nav__link">
    ui
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#acquire" class="md-nav__link">
    Acquire
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire" class="md-nav__link">
    acquire
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire.apply_clahe" class="md-nav__link">
    apply_clahe()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire.auto_gamma" class="md-nav__link">
    auto_gamma()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire.last_image" class="md-nav__link">
    last_image()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire.new_image" class="md-nav__link">
    new_image()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire.take_reference_images" class="md-nav__link">
    take_reference_images()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.acquire.take_set_of_reference_images" class="md-nav__link">
    take_set_of_reference_images()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alignment" class="md-nav__link">
    Alignment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.alignment" class="md-nav__link">
    alignment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.alignment.align_using_reference_images" class="md-nav__link">
    align_using_reference_images()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.alignment.beam_shift_alignment" class="md-nav__link">
    beam_shift_alignment()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.alignment.correct_stage_drift" class="md-nav__link">
    correct_stage_drift()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.alignment.crosscorrelation_v2" class="md-nav__link">
    crosscorrelation_v2()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.alignment.shift_from_crosscorrelation" class="md-nav__link">
    shift_from_crosscorrelation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calibration" class="md-nav__link">
    Calibration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.calibration" class="md-nav__link">
    calibration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.calibration.align_needle_to_eucentric_position" class="md-nav__link">
    align_needle_to_eucentric_position()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conversions" class="md-nav__link">
    Conversions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions" class="md-nav__link">
    conversions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.convert_metres_to_pixels" class="md-nav__link">
    convert_metres_to_pixels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.convert_pixels_to_metres" class="md-nav__link">
    convert_pixels_to_metres()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.convert_point_from_metres_to_pixel" class="md-nav__link">
    convert_point_from_metres_to_pixel()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.convert_point_from_pixel_to_metres" class="md-nav__link">
    convert_point_from_pixel_to_metres()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.distance_between_points" class="md-nav__link">
    distance_between_points()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.get_lamella_size_in_pixels" class="md-nav__link">
    get_lamella_size_in_pixels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.conversions.image_to_microscope_image_coordinates" class="md-nav__link">
    image_to_microscope_image_coordinates()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#milling" class="md-nav__link">
    Milling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling" class="md-nav__link">
    milling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_bitmap" class="md-nav__link">
    draw_bitmap()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_circle" class="md-nav__link">
    draw_circle()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_fiducial" class="md-nav__link">
    draw_fiducial()
  </a>
  
    <nav class="md-nav" aria-label="draw_fiducial()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.milling.draw_fiducial--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_line" class="md-nav__link">
    draw_line()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_pattern" class="md-nav__link">
    draw_pattern()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_patterns" class="md-nav__link">
    draw_patterns()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_rectangle" class="md-nav__link">
    draw_rectangle()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_stress_relief" class="md-nav__link">
    draw_stress_relief()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.draw_trench" class="md-nav__link">
    draw_trench()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.finish_milling" class="md-nav__link">
    finish_milling()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.read_protocol_dictionary" class="md-nav__link">
    read_protocol_dictionary()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.run_milling" class="md-nav__link">
    run_milling()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.run_milling_drift_corrected" class="md-nav__link">
    run_milling_drift_corrected()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.milling.setup_milling" class="md-nav__link">
    setup_milling()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#movement" class="md-nav__link">
    Movement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.movement" class="md-nav__link">
    movement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.movement.angle_difference" class="md-nav__link">
    angle_difference()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.movement.rotation_angle_is_larger" class="md-nav__link">
    rotation_angle_is_larger()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.movement.rotation_angle_is_smaller" class="md-nav__link">
    rotation_angle_is_smaller()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structures" class="md-nav__link">
    Structures
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures" class="md-nav__link">
    structures
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.BeamSettings" class="md-nav__link">
    BeamSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.BeamSystemSettings" class="md-nav__link">
    BeamSystemSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.BeamType" class="md-nav__link">
    BeamType
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemDetectorSettings" class="md-nav__link">
    FibsemDetectorSettings
  </a>
  
    <nav class="md-nav" aria-label="FibsemDetectorSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemDetectorSettings.__from_dict__" class="md-nav__link">
    __from_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemDetectorSettings.__to_dict__" class="md-nav__link">
    __to_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemDetectorSettings.to_tescan" class="md-nav__link">
    to_tescan()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemExperiment" class="md-nav__link">
    FibsemExperiment
  </a>
  
    <nav class="md-nav" aria-label="FibsemExperiment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemExperiment.__from_dict__" class="md-nav__link">
    __from_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemExperiment.__to_dict__" class="md-nav__link">
    __to_dict__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemHardware" class="md-nav__link">
    FibsemHardware
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImage" class="md-nav__link">
    FibsemImage
  </a>
  
    <nav class="md-nav" aria-label="FibsemImage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImage.fromAdornedImage" class="md-nav__link">
    fromAdornedImage()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImage.fromTescanImage" class="md-nav__link">
    fromTescanImage()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImage.load" class="md-nav__link">
    load()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImage.save" class="md-nav__link">
    save()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImageMetadata" class="md-nav__link">
    FibsemImageMetadata
  </a>
  
    <nav class="md-nav" aria-label="FibsemImageMetadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImageMetadata.__from_dict__" class="md-nav__link">
    __from_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImageMetadata.__to_dict__" class="md-nav__link">
    __to_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemImageMetadata.compare_image_settings" class="md-nav__link">
    compare_image_settings()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemManipulatorPosition" class="md-nav__link">
    FibsemManipulatorPosition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemMillingSettings" class="md-nav__link">
    FibsemMillingSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemPatternSettings" class="md-nav__link">
    FibsemPatternSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemRectangle" class="md-nav__link">
    FibsemRectangle
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemStagePosition" class="md-nav__link">
    FibsemStagePosition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemState" class="md-nav__link">
    FibsemState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemSystem" class="md-nav__link">
    FibsemSystem
  </a>
  
    <nav class="md-nav" aria-label="FibsemSystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemSystem.__from_dict__" class="md-nav__link">
    __from_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemSystem.__to_dict__" class="md-nav__link">
    __to_dict__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemUser" class="md-nav__link">
    FibsemUser
  </a>
  
    <nav class="md-nav" aria-label="FibsemUser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemUser.__from_dict__" class="md-nav__link">
    __from_dict__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.FibsemUser.__to_dict__" class="md-nav__link">
    __to_dict__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.ImageSettings" class="md-nav__link">
    ImageSettings
  </a>
  
    <nav class="md-nav" aria-label="ImageSettings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.ImageSettings.fromFibsemImage" class="md-nav__link">
    fromFibsemImage()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.MicroscopeSettings" class="md-nav__link">
    MicroscopeSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.MicroscopeState" class="md-nav__link">
    MicroscopeState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.Point" class="md-nav__link">
    Point
  </a>
  
    <nav class="md-nav" aria-label="Point">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.Point.distance" class="md-nav__link">
    distance()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fibsem.structures.Point.euclidean" class="md-nav__link">
    euclidean()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.StageSettings" class="md-nav__link">
    StageSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.SystemSettings" class="md-nav__link">
    SystemSettings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.check_data_format" class="md-nav__link">
    check_data_format()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.load_needle_yaml" class="md-nav__link">
    load_needle_yaml()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.save_needle_yaml" class="md-nav__link">
    save_needle_yaml()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.stage_position_from_dict" class="md-nav__link">
    stage_position_from_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.structures.stage_position_to_dict" class="md-nav__link">
    stage_position_to_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    Utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils" class="md-nav__link">
    utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.configure_logging" class="md-nav__link">
    configure_logging()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.create_gif" class="md-nav__link">
    create_gif()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.current_timestamp" class="md-nav__link">
    current_timestamp()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.current_timestamp_v2" class="md-nav__link">
    current_timestamp_v2()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.get_params" class="md-nav__link">
    get_params()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.load_protocol" class="md-nav__link">
    load_protocol()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.load_settings_from_config" class="md-nav__link">
    load_settings_from_config()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.load_yaml" class="md-nav__link">
    load_yaml()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.make_logging_directory" class="md-nav__link">
    make_logging_directory()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.save_yaml" class="md-nav__link">
    save_yaml()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.utils.setup_session" class="md-nav__link">
    setup_session()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    Validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.validation" class="md-nav__link">
    validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.validation.check_shift_within_tolerance" class="md-nav__link">
    check_shift_within_tolerance()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.validation.validate_initial_microscope_state" class="md-nav__link">
    validate_initial_microscope_state()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.validation.validate_stage_height_for_needle_insertion" class="md-nav__link">
    validate_stage_height_for_needle_insertion()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detection" class="md-nav__link">
    Detection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection" class="md-nav__link">
    detection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection.detect_bounding_box" class="md-nav__link">
    detect_bounding_box()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection.detect_centre_point" class="md-nav__link">
    detect_centre_point()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection.detect_closest_edge_v2" class="md-nav__link">
    detect_closest_edge_v2()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection.extract_class_pixels" class="md-nav__link">
    extract_class_pixels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection.plot_detection" class="md-nav__link">
    plot_detection()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.detection.plot_detections" class="md-nav__link">
    plot_detections()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils" class="md-nav__link">
    utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils.coordinate_distance" class="md-nav__link">
    coordinate_distance()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils.decode_segmap" class="md-nav__link">
    decode_segmap()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils.extract_img_for_labelling" class="md-nav__link">
    extract_img_for_labelling()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils.get_scale_invariant_coordinates" class="md-nav__link">
    get_scale_invariant_coordinates()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils.scale_coordinate_to_image" class="md-nav__link">
    scale_coordinate_to_image()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.detection.utils.scale_pixel_coordinates" class="md-nav__link">
    scale_pixel_coordinates()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-interface" class="md-nav__link">
    User Interface
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fibsem.ui" class="md-nav__link">
    ui
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="api-reference">API Reference</h1>
<h2 id="acquire">Acquire</h2>


<div class="doc doc-object doc-module">



<a id="fibsem.acquire"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="fibsem.acquire.apply_clahe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">apply_clahe</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">which_package</span><span class="o">=</span><span class="s1">&#39;skimage&#39;</span><span class="p">,</span> <span class="n">clip_limit_cv2</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">tile_grid_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">clip_limit_skimage</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Applies Contrast Limited Adaptive Histogram Equalisation correction to the input <code>FibsemImage</code>.
image is divided into small blocks called "tiles" (tileSize is 8x8 by default in OpenCV). Then each of these
blocks are histogram equalized as usual. So in a small area, histogram would confine to a small region
(unless there is noise). If noise is there, it will be amplified. To avoid this, contrast limiting is applied.
If any histogram bin is above the specified contrast limit (by default 40 in OpenCV), those pixels are clipped and
distributed uniformly to other bins before applying histogram equalization. After equalization, to remove artifacts
in tile borders, bilinear interpolation is applied.</p>
<p>In OpenCV tileGridSize (tile_grid_size) is by default 8x8, clipLimit (clip_limit_cv2) is by default 40</p>
<p>In skimage kernel_size (int or array_like), is optional. It defines the shape of contextual regions used in the
algorithm. By default, kernel_size is 1/8 of image height by 1/8 of its width.
clip_limit float, optional. Clipping limit, normalized between 0 and 1 (higher values give more contrast).</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>image</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input <code>FibsemImage</code> to apply gamma correction to.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>clip_limit_cv2</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>used if which_package=="OpenCV". Defaults to 15. (by default 40 in OpenCV)</p>
            </div>
          </td>
          <td>
                <code>15</code>
          </td>
        </tr>
        <tr>
          <td><code>tile_grid_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>used if which_package=='OpenCV'. Defaults to 8x8 pixels.</p>
            </div>
          </td>
          <td>
                <code>8</code>
          </td>
        </tr>
        <tr>
          <td><code>clip_limit_skimage</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>used if which_package=="skimage". Defaults to 0.01. Clipping limit, normalised between 0 and 1 (higher values give more contrast).</p>
            </div>
          </td>
          <td>
                <code>0.02</code>
          </td>
        </tr>
        <tr>
          <td><code>tile_grid_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>used if which_package=='skimage'. if None, defaults to kernel_size is 1/8 of image height by 1/8 of its width.</p>
            </div>
          </td>
          <td>
                <code>8</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new <code>FibsemImage</code> object containing the clahe-enhanced image data, with the same metadata</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>as the input image.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>This function applies gamma correction to the input image using either the <code>cv2.createCLAHE</code> or <code>skimage.exposure.equalize_adapthist</code> function</li>
<li>The <code>FibsemImage</code> object in the returned list contains the clahe-enhanced image data as a
  numpy array, as well as other image metadata.</li>
</ul>
</details>
          <details class="quote">
            <summary>Source code in <code>fibsem/acquire.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_clahe</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">FibsemImage</span><span class="p">,</span>
    <span class="n">which_package</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;skimage&quot;</span><span class="p">,</span>
    <span class="n">clip_limit_cv2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">tile_grid_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">clip_limit_skimage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span>
    <span class="n">kernel_size</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FibsemImage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies Contrast Limited Adaptive Histogram Equalisation correction to the input `FibsemImage`.</span>
<span class="sd">    image is divided into small blocks called &quot;tiles&quot; (tileSize is 8x8 by default in OpenCV). Then each of these</span>
<span class="sd">    blocks are histogram equalized as usual. So in a small area, histogram would confine to a small region</span>
<span class="sd">    (unless there is noise). If noise is there, it will be amplified. To avoid this, contrast limiting is applied.</span>
<span class="sd">    If any histogram bin is above the specified contrast limit (by default 40 in OpenCV), those pixels are clipped and</span>
<span class="sd">    distributed uniformly to other bins before applying histogram equalization. After equalization, to remove artifacts</span>
<span class="sd">    in tile borders, bilinear interpolation is applied.</span>

<span class="sd">    In OpenCV tileGridSize (tile_grid_size) is by default 8x8, clipLimit (clip_limit_cv2) is by default 40</span>

<span class="sd">    In skimage kernel_size (int or array_like), is optional. It defines the shape of contextual regions used in the</span>
<span class="sd">    algorithm. By default, kernel_size is 1/8 of image height by 1/8 of its width.</span>
<span class="sd">    clip_limit float, optional. Clipping limit, normalized between 0 and 1 (higher values give more contrast).</span>

<span class="sd">    Args:</span>
<span class="sd">        image (FibsemImage): The input `FibsemImage` to apply gamma correction to.</span>

<span class="sd">        type (str) Either &quot;skimage&quot; or &quot;OpenCV&quot; to apply the filter from the corresponding library</span>

<span class="sd">        clip_limit_cv2 (float): used if which_package==&quot;OpenCV&quot;. Defaults to 15. (by default 40 in OpenCV)</span>
<span class="sd">        tile_grid_size (int): used if which_package==&#39;OpenCV&#39;. Defaults to 8x8 pixels.</span>

<span class="sd">        clip_limit_skimage (float): used if which_package==&quot;skimage&quot;. Defaults to 0.01. Clipping limit, normalised between 0 and 1 (higher values give more contrast).</span>
<span class="sd">        tile_grid_size (int): used if which_package==&#39;skimage&#39;. if None, defaults to kernel_size is 1/8 of image height by 1/8 of its width.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new `FibsemImage` object containing the clahe-enhanced image data, with the same metadata</span>
<span class="sd">        as the input image.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - This function applies gamma correction to the input image using either the `cv2.createCLAHE` or `skimage.exposure.equalize_adapthist` function</span>
<span class="sd">        - The `FibsemImage` object in the returned list contains the clahe-enhanced image data as a</span>
<span class="sd">          numpy array, as well as other image metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        OpenCV requires 8-bit images for CLAHE, skimage requires either 8-bit images or arrays with values between [0,1]</span>
<span class="sd">        Here, we convert the raw data into an 8-bit image to proceed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">data</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">/</span> <span class="n">temp</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">which_package</span><span class="o">==</span><span class="s1">&#39;OpenCV&#39;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">cv2</span>
        <span class="n">tile_grid_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tile_grid_size</span><span class="p">)</span>
        <span class="n">clahe</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">createCLAHE</span><span class="p">(</span><span class="n">clipLimit</span><span class="o">=</span><span class="n">clip_limit_cv2</span><span class="p">,</span>
                                <span class="n">tileGridSize</span><span class="o">=</span><span class="p">(</span><span class="n">tile_grid_size</span><span class="p">,</span><span class="n">tile_grid_size</span><span class="p">))</span>
        <span class="n">image_data</span> <span class="o">=</span> <span class="n">clahe</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span> <span class="c1"># default filter</span>
        <span class="c1"># nbin = 256 default, for 8-bit images</span>
        <span class="n">image_data</span> <span class="o">=</span> <span class="n">exposure</span><span class="o">.</span><span class="n">equalize_adapthist</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span>
                                                 <span class="n">kernel_size</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">,</span>
                                                 <span class="n">clip_limit</span><span class="o">=</span><span class="n">clip_limit_skimage</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">skimage</span>
        <span class="n">image_data</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">image_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">FibsemImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">image_data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.acquire.auto_gamma" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">auto_gamma</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">min_gamma</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">max_gamma</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">gamma_threshold</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;autogamma&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Applies automatic gamma correction to the input <code>FibsemImage</code>.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>image</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input <code>FibsemImage</code> to apply gamma correction to.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>min_gamma</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The minimum gamma value allowed in the correction. Defaults to 0.15.</p>
            </div>
          </td>
          <td>
                <code>0.15</code>
          </td>
        </tr>
        <tr>
          <td><code>max_gamma</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The maximum gamma value allowed in the correction. Defaults to 1.8.</p>
            </div>
          </td>
          <td>
                <code>1.8</code>
          </td>
        </tr>
        <tr>
          <td><code>scale_factor</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A scaling factor to adjust the gamma correction range based on the image
brightness. Defaults to 0.01.</p>
            </div>
          </td>
          <td>
                <code>0.01</code>
          </td>
        </tr>
        <tr>
          <td><code>gamma_threshold</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The maximum threshold of brightness difference from the mid-gray value
(i.e., 128) before the gamma value is forced to 1.0. Defaults to 45.</p>
            </div>
          </td>
          <td>
                <code>45</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new <code>FibsemImage</code> object containing the gamma-corrected image data, with the same metadata</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>as the input image.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>This function applies gamma correction to the input image using the <code>skimage.exposure.adjust_gamma</code>
  function, with the gamma value computed based on the mean intensity of the image.</li>
<li>If the difference between the mean image intensity and the mid-gray value (i.e., 128) is greater
  than the specified <code>gamma_threshold</code>, the gamma value is forced to 1.0 to avoid over-correction.</li>
<li>The <code>FibsemImage</code> object in the returned list contains the gamma-corrected image data as a
  numpy array, as well as other image metadata.</li>
</ul>
</details>
          <details class="quote">
            <summary>Source code in <code>fibsem/acquire.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">auto_gamma</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">FibsemImage</span><span class="p">,</span>
    <span class="n">min_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span>
    <span class="n">max_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.8</span><span class="p">,</span>
    <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">gamma_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;autogamma&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FibsemImage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies automatic gamma correction to the input `FibsemImage`.</span>

<span class="sd">    Args:</span>
<span class="sd">        image (FibsemImage): The input `FibsemImage` to apply gamma correction to.</span>
<span class="sd">        min_gamma (float): The minimum gamma value allowed in the correction. Defaults to 0.15.</span>
<span class="sd">        max_gamma (float): The maximum gamma value allowed in the correction. Defaults to 1.8.</span>
<span class="sd">        scale_factor (float): A scaling factor to adjust the gamma correction range based on the image</span>
<span class="sd">            brightness. Defaults to 0.01.</span>
<span class="sd">        gamma_threshold (int): The maximum threshold of brightness difference from the mid-gray value</span>
<span class="sd">            (i.e., 128) before the gamma value is forced to 1.0. Defaults to 45.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new `FibsemImage` object containing the gamma-corrected image data, with the same metadata</span>
<span class="sd">        as the input image.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - This function applies gamma correction to the input image using the `skimage.exposure.adjust_gamma`</span>
<span class="sd">          function, with the gamma value computed based on the mean intensity of the image.</span>
<span class="sd">        - If the difference between the mean image intensity and the mid-gray value (i.e., 128) is greater</span>
<span class="sd">          than the specified `gamma_threshold`, the gamma value is forced to 1.0 to avoid over-correction.</span>
<span class="sd">        - The `FibsemImage` object in the returned list contains the gamma-corrected image data as a</span>
<span class="sd">          numpy array, as well as other image metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;autogamma&quot;</span><span class="p">:</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># unused variable?</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">-</span> <span class="mi">255</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">gam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
            <span class="n">min_gamma</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">,</span> <span class="n">max_gamma</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">gamma_threshold</span><span class="p">:</span>
            <span class="n">gam</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;AUTO_GAMMA | </span><span class="si">{</span><span class="n">image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">diff</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">gam</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">image_data</span> <span class="o">=</span> <span class="n">exposure</span><span class="o">.</span><span class="n">adjust_gamma</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">gam</span><span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">FibsemImage</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">image_data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;autoclahe&quot;</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">apply_clahe</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.acquire.last_image" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">last_image</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">beam_type</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p><em>summary</em></p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>microscope instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>beam_type</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.BeamType" href="#fibsem.structures.BeamType">BeamType</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>beam type for image</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>FibsemImage</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>last image acquired by the microscope</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/acquire.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">last_image</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">beam_type</span><span class="p">:</span> <span class="n">BeamType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FibsemImage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): microscope instance</span>
<span class="sd">        beam_type (BeamType): beam type for image</span>

<span class="sd">    Returns:</span>
<span class="sd">        FibsemImage: last image acquired by the microscope</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">microscope</span><span class="o">.</span><span class="n">last_image</span><span class="p">(</span><span class="n">beam_type</span><span class="o">=</span><span class="n">beam_type</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.acquire.new_image" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">new_image</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Apply the given image settings and acquire a new image.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The FibsemMicroscope instance used to acquire the image.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>settings</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.ImageSettings" href="../started/#fibsem.structures.ImageSettings">ImageSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The image settings used to acquire the image.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>FibsemImage</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The acquired image.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/acquire.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">new_image</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">ImageSettings</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FibsemImage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply the given image settings and acquire a new image.</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): The FibsemMicroscope instance used to acquire the image.</span>
<span class="sd">        settings (ImageSettings): The image settings used to acquire the image.</span>

<span class="sd">    Returns:</span>
<span class="sd">        FibsemImage: The acquired image.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># set label</span>
    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">beam_type</span> <span class="ow">is</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">_eb&quot;</span>

    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">beam_type</span> <span class="ow">is</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">_ib&quot;</span>

    <span class="c1"># run autocontrast</span>
    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">autocontrast</span><span class="p">:</span>
        <span class="n">microscope</span><span class="o">.</span><span class="n">autocontrast</span><span class="p">(</span><span class="n">beam_type</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">beam_type</span><span class="p">)</span>

    <span class="c1"># acquire the image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">acquire_image</span><span class="p">(</span>
        <span class="n">image_settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">gamma_enabled</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">auto_gamma</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># save image</span>
    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">save</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.acquire.take_reference_images" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">take_reference_images</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Acquires a pair of electron and ion reference images using the specified imaging settings and
a FibsemMicroscope instance.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A FibsemMicroscope instance for imaging.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_settings</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.ImageSettings" href="../started/#fibsem.structures.ImageSettings">ImageSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An ImageSettings object with the desired imaging parameters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple containing a pair of FibsemImage objects, representing the electron and ion reference</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>images acquired using the specified microscope and image settings.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>This function temporarily changes the <code>image_settings.beam_type</code> to <code>BeamType.ELECTRON</code>
  and then <code>BeamType.ION</code> to acquire the electron and ion reference images, respectively.
  It resets the <code>image_settings.beam_type</code> to the original value after acquiring the images.</li>
<li>The <code>FibsemImage</code> objects in the returned tuple contain the image data as numpy arrays,
  as well as other image metadata.</li>
</ul>
</details>
          <details class="quote">
            <summary>Source code in <code>fibsem/acquire.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">take_reference_images</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">:</span> <span class="n">ImageSettings</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">FibsemImage</span><span class="p">,</span> <span class="n">FibsemImage</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acquires a pair of electron and ion reference images using the specified imaging settings and</span>
<span class="sd">    a FibsemMicroscope instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): A FibsemMicroscope instance for imaging.</span>
<span class="sd">        image_settings (ImageSettings): An ImageSettings object with the desired imaging parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple containing a pair of FibsemImage objects, representing the electron and ion reference</span>
<span class="sd">        images acquired using the specified microscope and image settings.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - This function temporarily changes the `image_settings.beam_type` to `BeamType.ELECTRON`</span>
<span class="sd">          and then `BeamType.ION` to acquire the electron and ion reference images, respectively.</span>
<span class="sd">          It resets the `image_settings.beam_type` to the original value after acquiring the images.</span>
<span class="sd">        - The `FibsemImage` objects in the returned tuple contain the image data as numpy arrays,</span>
<span class="sd">          as well as other image metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">time</span> 
    <span class="kn">from</span> <span class="nn">fibsem.microscope</span> <span class="kn">import</span> <span class="n">TescanMicroscope</span>
    <span class="n">tmp_beam_type</span> <span class="o">=</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span>
    <span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">=</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span>
    <span class="n">eb_image</span> <span class="o">=</span> <span class="n">new_image</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">)</span>
    <span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">=</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">TescanMicroscope</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ib_image</span> <span class="o">=</span> <span class="n">new_image</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">)</span>
    <span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">=</span> <span class="n">tmp_beam_type</span>  <span class="c1"># reset to original beam type</span>

    <span class="k">return</span> <span class="n">eb_image</span><span class="p">,</span> <span class="n">ib_image</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.acquire.take_set_of_reference_images" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">take_set_of_reference_images</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">,</span> <span class="n">hfws</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ref_image&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Takes a set of reference images at low and high magnification using a FibsemMicroscope.
The image settings and half-field widths for the low- and high-resolution images are
specified using an ImageSettings object and a tuple of two floats, respectively.
The optional label parameter can be used to customize the image labels.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A FibsemMicroscope object to acquire the images from.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_settings</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.ImageSettings" href="../started/#fibsem.structures.ImageSettings">ImageSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An ImageSettings object with the desired imaging parameters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>hfws</code></td>
          <td>
                <code>Tuple[float, float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple of two floats specifying the half-field widths (in microns)
for the low- and high-resolution images, respectively.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>label</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A label to be included in the image filenames. Defaults to "ref_image".</p>
            </div>
          </td>
          <td>
                <code>&#39;ref_image&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="fibsem.structures.ReferenceImages">ReferenceImages</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A ReferenceImages object containing the low- and high-resolution electron and ion beam images.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="notes" open>
  <summary>Notes</summary>
  <p>This function sets image_settings.save to True before taking the images.
The returned ReferenceImages object contains the electron and ion beam images as FibsemImage objects.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>fibsem/acquire.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">take_set_of_reference_images</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span>
    <span class="n">image_settings</span><span class="p">:</span> <span class="n">ImageSettings</span><span class="p">,</span>
    <span class="n">hfws</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ref_image&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReferenceImages</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a set of reference images at low and high magnification using a FibsemMicroscope.</span>
<span class="sd">    The image settings and half-field widths for the low- and high-resolution images are</span>
<span class="sd">    specified using an ImageSettings object and a tuple of two floats, respectively.</span>
<span class="sd">    The optional label parameter can be used to customize the image labels.</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): A FibsemMicroscope object to acquire the images from.</span>
<span class="sd">        image_settings (ImageSettings): An ImageSettings object with the desired imaging parameters.</span>
<span class="sd">        hfws (Tuple[float, float]): A tuple of two floats specifying the half-field widths (in microns)</span>
<span class="sd">            for the low- and high-resolution images, respectively.</span>
<span class="sd">        label (str, optional): A label to be included in the image filenames. Defaults to &quot;ref_image&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ReferenceImages object containing the low- and high-resolution electron and ion beam images.</span>

<span class="sd">    Notes:</span>
<span class="sd">        This function sets image_settings.save to True before taking the images.</span>
<span class="sd">        The returned ReferenceImages object contains the electron and ion beam images as FibsemImage objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># force save</span>
    <span class="n">image_settings</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">image_settings</span><span class="o">.</span><span class="n">hfw</span> <span class="o">=</span> <span class="n">hfws</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">image_settings</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_low_res&quot;</span>
    <span class="n">low_eb</span><span class="p">,</span> <span class="n">low_ib</span> <span class="o">=</span> <span class="n">take_reference_images</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">)</span>

    <span class="n">image_settings</span><span class="o">.</span><span class="n">hfw</span> <span class="o">=</span> <span class="n">hfws</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">image_settings</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_high_res&quot;</span>
    <span class="n">high_eb</span><span class="p">,</span> <span class="n">high_ib</span> <span class="o">=</span> <span class="n">take_reference_images</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">)</span>

    <span class="n">reference_images</span> <span class="o">=</span> <span class="n">ReferenceImages</span><span class="p">(</span><span class="n">low_eb</span><span class="p">,</span> <span class="n">high_eb</span><span class="p">,</span> <span class="n">low_ib</span><span class="p">,</span> <span class="n">high_ib</span><span class="p">)</span>


    <span class="c1"># more flexible version</span>
    <span class="c1"># reference_images = []</span>
    <span class="c1"># for i, hfw in enumerate(hfws):</span>
    <span class="c1">#     image_settings.hfw = hfw</span>
    <span class="c1">#     image_settings.label = f&quot;{label}_res_{i:02d}&quot;</span>
    <span class="c1">#     eb_image, ib_image = take_reference_images(microscope, image_settings)</span>
    <span class="c1">#     reference_images.append([eb_image, ib_image])</span>

    <span class="k">return</span> <span class="n">reference_images</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="alignment">Alignment</h2>


<div class="doc doc-object doc-module">



<a id="fibsem.alignment"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="fibsem.alignment.align_using_reference_images" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">align_using_reference_images</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">ref_image</span><span class="p">,</span> <span class="n">new_image</span><span class="p">,</span> <span class="n">ref_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xcorr_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">constrain_vertical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_beam_shift</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Uses cross-correlation to align a new image to a reference image.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A FibsemMicroscope instance representing the microscope being used.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>settings</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.MicroscopeSettings" href="../started/#fibsem.structures.MicroscopeSettings">MicroscopeSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A MicroscopeSettings instance representing the settings for the imaging session.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ref_image</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A FibsemImage instance representing the reference image to which the new image will be aligned.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>new_image</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A FibsemImage instance representing the new image that will be aligned to the reference image.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ref_mask</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A numpy array representing a mask to apply to the reference image during alignment. Default is None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>xcorr_limit</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An integer representing the limit for the cross-correlation coefficient. If the coefficient is below
this limit, alignment will fail. Default is None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>constrain_vertical</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A boolean indicating whether to constrain movement to the vertical axis. If True, movement
will be restricted to the vertical axis, which is useful for eucentric movement. If False, movement will be
allowed on both the X and Y axes. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A boolean indicating whether the alignment was successful. True if the alignment was successful, False otherwise.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/alignment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">align_using_reference_images</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">MicroscopeSettings</span><span class="p">,</span>
    <span class="n">ref_image</span><span class="p">:</span> <span class="n">FibsemImage</span><span class="p">,</span>
    <span class="n">new_image</span><span class="p">:</span> <span class="n">FibsemImage</span><span class="p">,</span>
    <span class="n">ref_mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xcorr_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">constrain_vertical</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_beam_shift</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses cross-correlation to align a new image to a reference image.</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope: A FibsemMicroscope instance representing the microscope being used.</span>
<span class="sd">        settings: A MicroscopeSettings instance representing the settings for the imaging session.</span>
<span class="sd">        ref_image: A FibsemImage instance representing the reference image to which the new image will be aligned.</span>
<span class="sd">        new_image: A FibsemImage instance representing the new image that will be aligned to the reference image.</span>
<span class="sd">        ref_mask: A numpy array representing a mask to apply to the reference image during alignment. Default is None.</span>
<span class="sd">        xcorr_limit: An integer representing the limit for the cross-correlation coefficient. If the coefficient is below</span>
<span class="sd">            this limit, alignment will fail. Default is None.</span>
<span class="sd">        constrain_vertical: A boolean indicating whether to constrain movement to the vertical axis. If True, movement</span>
<span class="sd">            will be restricted to the vertical axis, which is useful for eucentric movement. If False, movement will be</span>
<span class="sd">            allowed on both the X and Y axes. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A boolean indicating whether the alignment was successful. True if the alignment was successful, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get beam type</span>
    <span class="n">ref_beam_type</span> <span class="o">=</span> <span class="n">BeamType</span><span class="p">[</span><span class="n">ref_image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
    <span class="n">new_beam_type</span> <span class="o">=</span> <span class="n">BeamType</span><span class="p">[</span><span class="n">new_image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;aligning </span><span class="si">{</span><span class="n">ref_beam_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> reference image to </span><span class="si">{</span><span class="n">new_beam_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">hp_px</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">lp_px</span> <span class="o">=</span> <span class="mi">128</span>  <span class="c1"># MAGIC_NUMBER</span>

    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">xcorr</span> <span class="o">=</span> <span class="n">shift_from_crosscorrelation</span><span class="p">(</span>
        <span class="n">ref_image</span><span class="p">,</span>
        <span class="n">new_image</span><span class="p">,</span>
        <span class="n">lowpass</span><span class="o">=</span><span class="n">lp_px</span><span class="p">,</span>
        <span class="n">highpass</span><span class="o">=</span><span class="n">hp_px</span><span class="p">,</span>
        <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
        <span class="n">use_rect_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ref_mask</span><span class="o">=</span><span class="n">ref_mask</span><span class="p">,</span>
        <span class="n">xcorr_limit</span><span class="o">=</span><span class="n">xcorr_limit</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">shift_within_tolerance</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">validation</span><span class="o">.</span><span class="n">check_shift_within_tolerance</span><span class="p">(</span>  <span class="c1"># TODO: Abstract validation.py</span>
            <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="n">dy</span><span class="p">,</span> <span class="n">ref_image</span><span class="o">=</span><span class="n">ref_image</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mf">0.5</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">shift_within_tolerance</span><span class="p">:</span>

        <span class="c1"># vertical constraint = eucentric movement</span>
        <span class="k">if</span> <span class="n">constrain_vertical</span><span class="p">:</span>
            <span class="n">microscope</span><span class="o">.</span><span class="n">eucentric_move</span><span class="p">(</span>
                <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="o">=-</span><span class="n">dy</span>
            <span class="p">)</span>  <span class="c1"># FLAG_TEST</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_beam_shift</span><span class="p">:</span>
                <span class="c1"># move the beam shift</span>
                <span class="n">microscope</span><span class="o">.</span><span class="n">beam_shift</span><span class="p">(</span><span class="n">dx</span><span class="o">=-</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="n">dy</span><span class="p">,</span> <span class="n">beam_type</span><span class="o">=</span><span class="n">new_beam_type</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># move the stage</span>
                <span class="n">microscope</span><span class="o">.</span><span class="n">stable_move</span><span class="p">(</span>
                    <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
                    <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span>
                    <span class="n">dy</span><span class="o">=-</span><span class="n">dy</span><span class="p">,</span>
                    <span class="n">beam_type</span><span class="o">=</span><span class="n">new_beam_type</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">shift_within_tolerance</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.alignment.beam_shift_alignment" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">beam_shift_alignment</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">,</span> <span class="n">ref_image</span><span class="p">,</span> <span class="n">reduced_area</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Aligns the images by adjusting the beam shift instead of moving the stage.</p>
<p>This method uses cross-correlation between the reference image and a new image to calculate the
optimal beam shift for alignment. This approach offers increased precision, but a lower range
compared to stage movement.</p>
<p>NOTE: Only shift the ion beam, never the electron beam.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An OpenFIBSEM microscope client.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_settings</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.acquire.ImageSettings" href="../started/#fibsem.structures.ImageSettings">ImageSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Settings for taking the image.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ref_image</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The reference image to align to.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reduced_area</code></td>
          <td>
                <code>FibseRectangle</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The reduced area to image with.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If <code>image_settings.beam_type</code> is not set to <code>BeamType.ION</code>.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/alignment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">beam_shift_alignment</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span>
    <span class="n">image_settings</span><span class="p">:</span> <span class="n">ImageSettings</span><span class="p">,</span>
    <span class="n">ref_image</span><span class="p">:</span> <span class="n">FibsemImage</span><span class="p">,</span>
    <span class="n">reduced_area</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FibsemRectangle</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aligns the images by adjusting the beam shift instead of moving the stage.</span>

<span class="sd">    This method uses cross-correlation between the reference image and a new image to calculate the</span>
<span class="sd">    optimal beam shift for alignment. This approach offers increased precision, but a lower range</span>
<span class="sd">    compared to stage movement.</span>

<span class="sd">    NOTE: Only shift the ion beam, never the electron beam.</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): An OpenFIBSEM microscope client.</span>
<span class="sd">        image_settings (acquire.ImageSettings): Settings for taking the image.</span>
<span class="sd">        ref_image (FibsemImage): The reference image to align to.</span>
<span class="sd">        reduced_area (FibseRectangle): The reduced area to image with.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If `image_settings.beam_type` is not set to `BeamType.ION`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># threading is too fast?</span>
    <span class="n">image_settings</span> <span class="o">=</span> <span class="n">ImageSettings</span><span class="o">.</span><span class="n">fromFibsemImage</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
    <span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">=</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span>
    <span class="n">image_settings</span><span class="o">.</span><span class="n">reduced_area</span> <span class="o">=</span> <span class="n">reduced_area</span>
    <span class="n">new_image</span> <span class="o">=</span> <span class="n">acquire</span><span class="o">.</span><span class="n">new_image</span><span class="p">(</span>
        <span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">image_settings</span>
    <span class="p">)</span>
    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">shift_from_crosscorrelation</span><span class="p">(</span>
        <span class="n">ref_image</span><span class="p">,</span> <span class="n">new_image</span><span class="p">,</span> <span class="n">lowpass</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">highpass</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">use_rect_mask</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># adjust beamshift </span>
    <span class="n">microscope</span><span class="o">.</span><span class="n">beam_shift</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.alignment.correct_stage_drift" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">correct_stage_drift</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">reference_images</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="p">(</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">,</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">),</span> <span class="n">rotate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ref_mask_rad</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">xcorr_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">constrain_vertical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_beam_shift</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Corrects the stage drift by aligning low- and high-resolution reference images
using cross-correlation.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The microscope used for image acquisition.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>settings</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.MicroscopeSettings" href="../started/#fibsem.structures.MicroscopeSettings">MicroscopeSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The settings used for image acquisition.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reference_images</code></td>
          <td>
                <code><span title="fibsem.structures.ReferenceImages">ReferenceImages</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A container of low- and high-resolution
reference images.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>alignment</code></td>
          <td>
                <code>tuple[<a class="autorefs autorefs-internal" title="fibsem.structures.BeamType" href="#fibsem.structures.BeamType">BeamType</a>, <a class="autorefs autorefs-internal" title="fibsem.structures.BeamType" href="#fibsem.structures.BeamType">BeamType</a>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple of two <code>BeamType</code>
objects, specifying the beam types used for the alignment of low- and
high-resolution images, respectively. Defaults to (BeamType.ELECTRON,
BeamType.ELECTRON).</p>
            </div>
          </td>
          <td>
                <code>(<span title="fibsem.structures.BeamType.ELECTRON">ELECTRON</span>, <span title="fibsem.structures.BeamType.ELECTRON">ELECTRON</span>)</code>
          </td>
        </tr>
        <tr>
          <td><code>rotate</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to rotate the reference images before
alignment. Defaults to False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>ref_mask_rad</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The radius of the circular mask used for reference</p>
            </div>
          </td>
          <td>
                <code>512</code>
          </td>
        </tr>
        <tr>
          <td><code>xcorr_limit</code></td>
          <td>
                <code>tuple[int, int] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple of two integers that
represent the minimum and maximum cross-correlation values allowed for the
alignment. If not specified, the values are set to (None, None), which means
there are no limits. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>constrain_vertical</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to constrain the alignment to the
vertical axis. Defaults to False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>bool</code></td>          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>True if the stage drift correction was successful, False otherwise.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/alignment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">correct_stage_drift</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">MicroscopeSettings</span><span class="p">,</span>
    <span class="n">reference_images</span><span class="p">:</span> <span class="n">ReferenceImages</span><span class="p">,</span>
    <span class="n">alignment</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">BeamType</span><span class="p">,</span> <span class="n">BeamType</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">,</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">),</span>
    <span class="n">rotate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ref_mask_rad</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>
    <span class="n">xcorr_limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">constrain_vertical</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_beam_shift</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Corrects the stage drift by aligning low- and high-resolution reference images</span>
<span class="sd">    using cross-correlation.</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): The microscope used for image acquisition.</span>
<span class="sd">        settings (MicroscopeSettings): The settings used for image acquisition.</span>
<span class="sd">        reference_images (ReferenceImages): A container of low- and high-resolution</span>
<span class="sd">            reference images.</span>
<span class="sd">        alignment (tuple[BeamType, BeamType], optional): A tuple of two `BeamType`</span>
<span class="sd">            objects, specifying the beam types used for the alignment of low- and</span>
<span class="sd">            high-resolution images, respectively. Defaults to (BeamType.ELECTRON,</span>
<span class="sd">            BeamType.ELECTRON).</span>
<span class="sd">        rotate (bool, optional): Whether to rotate the reference images before</span>
<span class="sd">            alignment. Defaults to False.</span>
<span class="sd">        ref_mask_rad (int, optional): The radius of the circular mask used for reference</span>
<span class="sd">        xcorr_limit (tuple[int, int] | None, optional): A tuple of two integers that</span>
<span class="sd">            represent the minimum and maximum cross-correlation values allowed for the</span>
<span class="sd">            alignment. If not specified, the values are set to (None, None), which means</span>
<span class="sd">            there are no limits. Defaults to None.</span>
<span class="sd">        constrain_vertical (bool, optional): Whether to constrain the alignment to the</span>
<span class="sd">            vertical axis. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the stage drift correction was successful, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># set reference images</span>
    <span class="k">if</span> <span class="n">alignment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">:</span>
        <span class="n">ref_lowres</span><span class="p">,</span> <span class="n">ref_highres</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">reference_images</span><span class="o">.</span><span class="n">low_res_eb</span><span class="p">,</span>
            <span class="n">reference_images</span><span class="o">.</span><span class="n">high_res_eb</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">alignment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">:</span>
        <span class="n">ref_lowres</span><span class="p">,</span> <span class="n">ref_highres</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">reference_images</span><span class="o">.</span><span class="n">low_res_ib</span><span class="p">,</span>
            <span class="n">reference_images</span><span class="o">.</span><span class="n">high_res_ib</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">xcorr_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xcorr_limit</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># rotate reference</span>
    <span class="k">if</span> <span class="n">rotate</span><span class="p">:</span>
        <span class="n">ref_lowres</span> <span class="o">=</span> <span class="n">image_utils</span><span class="o">.</span><span class="n">rotate_image</span><span class="p">(</span><span class="n">ref_lowres</span><span class="p">)</span>
        <span class="n">ref_highres</span> <span class="o">=</span> <span class="n">image_utils</span><span class="o">.</span><span class="n">rotate_image</span><span class="p">(</span><span class="n">ref_highres</span><span class="p">)</span>

    <span class="c1"># align lowres, then highres</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ref_image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">ref_lowres</span><span class="p">,</span> <span class="n">ref_highres</span><span class="p">]):</span>

        <span class="n">ref_mask</span> <span class="o">=</span> <span class="n">masks</span><span class="o">.</span><span class="n">create_circle_mask</span><span class="p">(</span><span class="n">ref_image</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">ref_mask_rad</span><span class="p">)</span>

        <span class="c1"># take new images</span>
        <span class="c1"># set new image settings (same as reference)</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">ImageSettings</span><span class="o">.</span><span class="n">fromFibsemImage</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">=</span> <span class="n">alignment</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_image</span> <span class="o">=</span> <span class="n">acquire</span><span class="o">.</span><span class="n">new_image</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># crosscorrelation alignment</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">align_using_reference_images</span><span class="p">(</span>
            <span class="n">microscope</span><span class="p">,</span>
            <span class="n">settings</span><span class="p">,</span>
            <span class="n">ref_image</span><span class="p">,</span>
            <span class="n">new_image</span><span class="p">,</span>
            <span class="n">ref_mask</span><span class="o">=</span><span class="n">ref_mask</span><span class="p">,</span>
            <span class="n">xcorr_limit</span><span class="o">=</span><span class="n">xcorr_limit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">constrain_vertical</span><span class="o">=</span><span class="n">constrain_vertical</span><span class="p">,</span>
            <span class="n">use_beam_shift</span><span class="o">=</span><span class="n">use_beam_shift</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">break</span>  <span class="c1"># cross correlation has failed...</span>

    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.alignment.crosscorrelation_v2" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">crosscorrelation_v2</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="n">img2</span><span class="p">,</span> <span class="n">bandpass</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Cross-correlate two images using Fourier convolution matching.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>img1</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The reference image.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>img2</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The new image to be cross-correlated with the reference.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bandpass</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A bandpass mask to apply to both images before cross-correlation. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>np.ndarray: The cross-correlation map between the two images.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/alignment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">crosscorrelation_v2</span><span class="p">(</span>
    <span class="n">img1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">img2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bandpass</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cross-correlate two images using Fourier convolution matching.</span>

<span class="sd">    Args:</span>
<span class="sd">        img1 (np.ndarray): The reference image.</span>
<span class="sd">        img2 (np.ndarray): The new image to be cross-correlated with the reference.</span>
<span class="sd">        bandpass (np.ndarray, optional): A bandpass mask to apply to both images before cross-correlation. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: The cross-correlation map between the two images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">img1</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">img2</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="n">err</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Image 1 </span><span class="si">{</span><span class="n">img1</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> and Image 2 </span><span class="si">{</span><span class="n">img2</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> need to have the same shape&quot;</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">bandpass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bandpass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">img1</span><span class="p">)</span>

    <span class="n">n_pixels</span> <span class="o">=</span> <span class="n">img1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">img1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">img1ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifftshift</span><span class="p">(</span><span class="n">bandpass</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">img1</span><span class="p">)))</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">img1ft</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">img1ft</span><span class="p">)</span>
    <span class="n">img1ft</span> <span class="o">=</span> <span class="n">n_pixels</span> <span class="o">*</span> <span class="n">img1ft</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

    <span class="n">img2ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifftshift</span><span class="p">(</span><span class="n">bandpass</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">img2</span><span class="p">)))</span>
    <span class="n">img2ft</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">img2ft</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">img2ft</span><span class="p">)</span>

    <span class="n">img2ft</span> <span class="o">=</span> <span class="n">n_pixels</span> <span class="o">*</span> <span class="n">img2ft</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

    <span class="c1"># import matplotlib.pyplot as plt</span>
    <span class="c1"># fig, ax = plt.subplots(1, 2, figsize=(15, 15))</span>
    <span class="c1"># ax[0].imshow(np.fft.ifft2(img1ft).real)</span>
    <span class="c1"># ax[1].imshow(np.fft.ifft2(img2ft).real)</span>
    <span class="c1"># plt.show()</span>

    <span class="c1"># plt.title(&quot;Power Spectra&quot;)</span>
    <span class="c1"># plt.imshow(np.log(np.abs(np.fft.fftshift(np.fft.fft2(img1)))))</span>
    <span class="c1"># plt.show()</span>

    <span class="n">xcorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft2</span><span class="p">(</span><span class="n">img1ft</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">img2ft</span><span class="p">))))</span>

    <span class="k">return</span> <span class="n">xcorr</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.alignment.shift_from_crosscorrelation" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">shift_from_crosscorrelation</span><span class="p">(</span><span class="n">ref_image</span><span class="p">,</span> <span class="n">new_image</span><span class="p">,</span> <span class="n">lowpass</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">highpass</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">use_rect_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ref_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xcorr_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Calculates the shift between two images by cross-correlating them and finding the position of maximum correlation.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ref_image</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The reference image.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>new_image</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The new image to align to the reference.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>lowpass</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The low-pass filter frequency (in pixels) for the bandpass filter used to
enhance the correlation signal. Defaults to 128.</p>
            </div>
          </td>
          <td>
                <code>128</code>
          </td>
        </tr>
        <tr>
          <td><code>highpass</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The high-pass filter frequency (in pixels) for the bandpass filter used to
enhance the correlation signal. Defaults to 6.</p>
            </div>
          </td>
          <td>
                <code>6</code>
          </td>
        </tr>
        <tr>
          <td><code>sigma</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The standard deviation (in pixels) of the Gaussian filter used to create the bandpass
mask. Defaults to 6.</p>
            </div>
          </td>
          <td>
                <code>6</code>
          </td>
        </tr>
        <tr>
          <td><code>use_rect_mask</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to use a rectangular mask for the correlation. If True, the correlation
is performed only inside a rectangle that covers most of the image, to reduce the effect of noise at the
edges. Defaults to False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>ref_mask</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A mask to apply to the reference image before correlation. If not None,
it should be a binary array with the same shape as the images. Pixels with value 0 will be ignored in the
correlation. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>xcorr_limit</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If not None, the correlation map will be circularly masked to a square
with sides of length 2 * xcorr_limit + 1, centred on the maximum correlation peak. This can be used to
limit the search range and improve the accuracy of the shift. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple (x_shift, y_shift, xcorr), where x_shift and y_shift are the shifts along x and y (in meters),</p>
            </div>
          </td>
        </tr>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>and xcorr is the cross-correlation map between the images.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/alignment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">shift_from_crosscorrelation</span><span class="p">(</span>
    <span class="n">ref_image</span><span class="p">:</span> <span class="n">FibsemImage</span><span class="p">,</span>
    <span class="n">new_image</span><span class="p">:</span> <span class="n">FibsemImage</span><span class="p">,</span>
    <span class="n">lowpass</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
    <span class="n">highpass</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">sigma</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">use_rect_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ref_mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xcorr_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the shift between two images by cross-correlating them and finding the position of maximum correlation.</span>

<span class="sd">    Args:</span>
<span class="sd">        ref_image (FibsemImage): The reference image.</span>
<span class="sd">        new_image (FibsemImage): The new image to align to the reference.</span>
<span class="sd">        lowpass (int, optional): The low-pass filter frequency (in pixels) for the bandpass filter used to</span>
<span class="sd">            enhance the correlation signal. Defaults to 128.</span>
<span class="sd">        highpass (int, optional): The high-pass filter frequency (in pixels) for the bandpass filter used to</span>
<span class="sd">            enhance the correlation signal. Defaults to 6.</span>
<span class="sd">        sigma (int, optional): The standard deviation (in pixels) of the Gaussian filter used to create the bandpass</span>
<span class="sd">            mask. Defaults to 6.</span>
<span class="sd">        use_rect_mask (bool, optional): Whether to use a rectangular mask for the correlation. If True, the correlation</span>
<span class="sd">            is performed only inside a rectangle that covers most of the image, to reduce the effect of noise at the</span>
<span class="sd">            edges. Defaults to False.</span>
<span class="sd">        ref_mask (np.ndarray, optional): A mask to apply to the reference image before correlation. If not None,</span>
<span class="sd">            it should be a binary array with the same shape as the images. Pixels with value 0 will be ignored in the</span>
<span class="sd">            correlation. Defaults to None.</span>
<span class="sd">        xcorr_limit (int, optional): If not None, the correlation map will be circularly masked to a square</span>
<span class="sd">            with sides of length 2 * xcorr_limit + 1, centred on the maximum correlation peak. This can be used to</span>
<span class="sd">            limit the search range and improve the accuracy of the shift. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple (x_shift, y_shift, xcorr), where x_shift and y_shift are the shifts along x and y (in meters),</span>
<span class="sd">        and xcorr is the cross-correlation map between the images.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get pixel_size</span>
    <span class="n">pixelsize_x</span> <span class="o">=</span> <span class="n">new_image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">x</span>
    <span class="n">pixelsize_y</span> <span class="o">=</span> <span class="n">new_image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">y</span>

    <span class="c1"># normalise both images</span>
    <span class="n">ref_data_norm</span> <span class="o">=</span> <span class="n">image_utils</span><span class="o">.</span><span class="n">normalise_image</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
    <span class="n">new_data_norm</span> <span class="o">=</span> <span class="n">image_utils</span><span class="o">.</span><span class="n">normalise_image</span><span class="p">(</span><span class="n">new_image</span><span class="p">)</span>

    <span class="c1"># cross-correlate normalised images</span>
    <span class="k">if</span> <span class="n">use_rect_mask</span><span class="p">:</span>
        <span class="n">rect_mask</span> <span class="o">=</span> <span class="n">masks</span><span class="o">.</span><span class="n">_mask_rectangular</span><span class="p">(</span><span class="n">new_data_norm</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ref_data_norm</span> <span class="o">=</span> <span class="n">rect_mask</span> <span class="o">*</span> <span class="n">ref_data_norm</span>
        <span class="n">new_data_norm</span> <span class="o">=</span> <span class="n">rect_mask</span> <span class="o">*</span> <span class="n">new_data_norm</span>

    <span class="k">if</span> <span class="n">ref_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ref_data_norm</span> <span class="o">=</span> <span class="n">ref_mask</span> <span class="o">*</span> <span class="n">ref_data_norm</span>  <span class="c1"># mask the reference</span>

    <span class="c1"># bandpass mask</span>
    <span class="n">bandpass</span> <span class="o">=</span> <span class="n">masks</span><span class="o">.</span><span class="n">create_bandpass_mask</span><span class="p">(</span>
        <span class="n">shape</span><span class="o">=</span><span class="n">ref_data_norm</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">lp</span><span class="o">=</span><span class="n">lowpass</span><span class="p">,</span> <span class="n">hp</span><span class="o">=</span><span class="n">highpass</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span>
    <span class="p">)</span>

    <span class="c1"># crosscorrelation</span>
    <span class="n">xcorr</span> <span class="o">=</span> <span class="n">crosscorrelation_v2</span><span class="p">(</span><span class="n">ref_data_norm</span><span class="p">,</span> <span class="n">new_data_norm</span><span class="p">,</span> <span class="n">bandpass</span><span class="o">=</span><span class="n">bandpass</span><span class="p">)</span>

    <span class="c1"># limit xcorr range</span>
    <span class="k">if</span> <span class="n">xcorr_limit</span><span class="p">:</span>
        <span class="n">xcorr</span> <span class="o">=</span> <span class="n">masks</span><span class="o">.</span><span class="n">apply_circular_mask</span><span class="p">(</span><span class="n">xcorr</span><span class="p">,</span> <span class="n">xcorr_limit</span><span class="p">)</span>

    <span class="c1"># calculate maximum crosscorrelation</span>
    <span class="n">maxX</span><span class="p">,</span> <span class="n">maxY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">xcorr</span><span class="p">),</span> <span class="n">xcorr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># TODO: backwards</span>
    <span class="n">cen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xcorr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cen</span> <span class="o">-</span> <span class="p">[</span><span class="n">maxX</span><span class="p">,</span> <span class="n">maxY</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>

    <span class="c1"># calculate shift in metres</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">err</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">pixelsize_x</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">err</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">pixelsize_y</span>  <span class="c1"># this could be the issue?</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cross-correlation:&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pixelsize: x: </span><span class="si">{</span><span class="n">pixelsize_x</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">, y: </span><span class="si">{</span><span class="n">pixelsize_y</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;maxX: </span><span class="si">{</span><span class="n">maxX</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">maxY</span><span class="si">}</span><span class="s2">, centre: </span><span class="si">{</span><span class="n">cen</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x: </span><span class="si">{</span><span class="n">err</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">px, y: </span><span class="si">{</span><span class="n">err</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x: </span><span class="si">{</span><span class="n">dx</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">m, y: </span><span class="si">{</span><span class="n">dy</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> meters&quot;</span><span class="p">)</span>

    <span class="c1"># save data</span>
    <span class="n">_save_alignment_data</span><span class="p">(</span>
        <span class="n">ref_image</span><span class="o">=</span><span class="n">ref_image</span><span class="p">,</span>
        <span class="n">new_image</span><span class="o">=</span><span class="n">new_image</span><span class="p">,</span>
        <span class="n">bandpass</span><span class="o">=</span><span class="n">bandpass</span><span class="p">,</span>
        <span class="n">xcorr</span><span class="o">=</span><span class="n">xcorr</span><span class="p">,</span>
        <span class="n">use_rect_mask</span><span class="o">=</span><span class="n">use_rect_mask</span><span class="p">,</span>
        <span class="n">ref_mask</span><span class="o">=</span><span class="n">ref_mask</span><span class="p">,</span>
        <span class="n">xcorr_limit</span><span class="o">=</span><span class="n">xcorr_limit</span><span class="p">,</span>
        <span class="n">lowpass</span><span class="o">=</span><span class="n">lowpass</span><span class="p">,</span>
        <span class="n">highpass</span><span class="o">=</span><span class="n">highpass</span><span class="p">,</span>
        <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
        <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span>
        <span class="n">dy</span><span class="o">=</span><span class="n">dy</span><span class="p">,</span>
        <span class="n">pixelsize_x</span><span class="o">=</span><span class="n">pixelsize_x</span><span class="p">,</span>
        <span class="n">pixelsize_y</span><span class="o">=</span><span class="n">pixelsize_y</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># metres</span>
    <span class="k">return</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">xcorr</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="calibration">Calibration</h2>


<div class="doc doc-object doc-module">



<a id="fibsem.calibration"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="fibsem.calibration.align_needle_to_eucentric_position" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">align_needle_to_eucentric_position</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Move the needle to the eucentric position, and save the updated position to disk</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>OpenFIBSEM microscope instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>settings</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.MicroscopeSettings" href="../started/#fibsem.structures.MicroscopeSettings">MicroscopeSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>microscope settings</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>validate</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>validate the alignment. Defaults to False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/calibration.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">align_needle_to_eucentric_position</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">MicroscopeSettings</span><span class="p">,</span>
    <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Move the needle to the eucentric position, and save the updated position to disk</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): OpenFIBSEM microscope instance</span>
<span class="sd">        settings (MicroscopeSettings): microscope settings</span>
<span class="sd">        validate (bool, optional): validate the alignment. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">fibsem.ui</span> <span class="kn">import</span> <span class="n">windows</span> <span class="k">as</span> <span class="n">fibsem_ui_windows</span>
    <span class="kn">from</span> <span class="nn">fibsem.detection</span> <span class="kn">import</span> <span class="n">detection</span>

    <span class="c1"># take reference images</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">=</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span>

    <span class="n">det</span> <span class="o">=</span> <span class="n">fibsem_ui_windows</span><span class="o">.</span><span class="n">detect_features_v2</span><span class="p">(</span>
        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
        <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
        <span class="n">features</span><span class="o">=</span><span class="p">[</span>
            <span class="n">NeedleTip</span><span class="p">(),</span>
            <span class="n">ImageCentre</span><span class="p">(),</span>
        <span class="p">],</span>
        <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">detection</span><span class="o">.</span><span class="n">move_based_on_detection</span><span class="p">(</span>
        <span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">det</span><span class="p">,</span> <span class="n">beam_type</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">beam_type</span>
    <span class="p">)</span>

    <span class="c1"># take reference images</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">beam_type</span> <span class="o">=</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">acquire</span><span class="o">.</span><span class="n">new_image</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>

    <span class="n">det</span> <span class="o">=</span> <span class="n">fibsem_ui_windows</span><span class="o">.</span><span class="n">detect_features_v2</span><span class="p">(</span>
        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span>
        <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
        <span class="n">features</span><span class="o">=</span><span class="p">[</span>
            <span class="n">NeedleTip</span><span class="p">(),</span>
            <span class="n">ImageCentre</span><span class="p">(),</span>
        <span class="p">],</span>
        <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">detection</span><span class="o">.</span><span class="n">move_based_on_detection</span><span class="p">(</span>
        <span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">det</span><span class="p">,</span> <span class="n">beam_type</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">beam_type</span><span class="p">,</span> <span class="n">move_x</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="c1"># take image</span>
    <span class="n">acquire</span><span class="o">.</span><span class="n">take_reference_images</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="conversions">Conversions</h2>


<div class="doc doc-object doc-module">



<a id="fibsem.conversions"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="fibsem.conversions.convert_metres_to_pixels" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">convert_metres_to_pixels</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert a distance in metres to pixels based on a given pixel size.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>distance</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The distance to convert, in metres.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pixelsize</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The size of a pixel in metres.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The distance converted to pixels, as an integer.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/conversions.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_metres_to_pixels</span><span class="p">(</span><span class="n">distance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a distance in metres to pixels based on a given pixel size.</span>

<span class="sd">    Args:</span>
<span class="sd">        distance (float): The distance to convert, in metres.</span>
<span class="sd">        pixelsize (float): The size of a pixel in metres.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The distance converted to pixels, as an integer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">distance</span> <span class="o">/</span> <span class="n">pixelsize</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.conversions.convert_pixels_to_metres" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">convert_pixels_to_metres</span><span class="p">(</span><span class="n">pixels</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert a distance in pixels to metres based on a given pixel size.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pixels</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of pixels to convert.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pixelsize</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The size of a pixel in metres.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>float</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The distance converted to metres.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/conversions.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_pixels_to_metres</span><span class="p">(</span><span class="n">pixels</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a distance in pixels to metres based on a given pixel size.</span>

<span class="sd">    Args:</span>
<span class="sd">        pixels (int): The number of pixels to convert.</span>
<span class="sd">        pixelsize (float): The size of a pixel in metres.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The distance converted to metres.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">pixels</span> <span class="o">*</span> <span class="n">pixelsize</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.conversions.convert_point_from_metres_to_pixel" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">convert_point_from_metres_to_pixel</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert a Point object from metre coordinates to pixel coordinates, based on a given pixel size.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>point</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.Point" href="#fibsem.structures.Point">Point</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Point object to convert.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pixelsize</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The size of a pixel in metres.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Point</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.Point" href="#fibsem.structures.Point">Point</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The converted Point object, with its x and y values in pixel coordinates.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/conversions.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_point_from_metres_to_pixel</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a Point object from metre coordinates to pixel coordinates, based on a given pixel size.</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): The Point object to convert.</span>
<span class="sd">        pixelsize (float): The size of a pixel in metres.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: The converted Point object, with its x and y values in pixel coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">point_px</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">convert_metres_to_pixels</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">convert_metres_to_pixels</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">point_px</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.conversions.convert_point_from_pixel_to_metres" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">convert_point_from_pixel_to_metres</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert a Point object from pixel coordinates to metre coordinates, based on a given pixel size.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>point</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.Point" href="#fibsem.structures.Point">Point</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Point object to convert.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pixelsize</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The size of a pixel in metres.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Point</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.Point" href="#fibsem.structures.Point">Point</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The converted Point object, with its x and y values in metre coordinates.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/conversions.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_point_from_pixel_to_metres</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a Point object from pixel coordinates to metre coordinates, based on a given pixel size.</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): The Point object to convert.</span>
<span class="sd">        pixelsize (float): The size of a pixel in metres.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: The converted Point object, with its x and y values in metre coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">point_m</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">convert_pixels_to_metres</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">convert_pixels_to_metres</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">point_m</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.conversions.distance_between_points" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">distance_between_points</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Calculate the Euclidean distance between two points, returning a Point object representing the result.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>p1</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.Point" href="#fibsem.structures.Point">Point</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The first point.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>p2</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.Point" href="#fibsem.structures.Point">Point</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The second point.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Point</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.Point" href="#fibsem.structures.Point">Point</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A Point object representing the distance between the two points.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/conversions.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">distance_between_points</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Euclidean distance between two points, returning a Point object representing the result.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (Point): The first point.</span>
<span class="sd">        p2 (Point): The second point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: A Point object representing the distance between the two points.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.conversions.get_lamella_size_in_pixels" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_lamella_size_in_pixels</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">use_trench_height</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get the relative size of the lamella in pixels based on the hfw of the image.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>img</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A reference image.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>protocol</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dictionary containing the protocol information.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>use_trench_height</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, returns the height of the trench instead of the lamella. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>tuple[int]: A tuple containing the height and width of the lamella in pixels.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/conversions.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_lamella_size_in_pixels</span><span class="p">(</span>
    <span class="n">img</span><span class="p">:</span> <span class="n">FibsemImage</span><span class="p">,</span> <span class="n">protocol</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">use_trench_height</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the relative size of the lamella in pixels based on the hfw of the image.</span>

<span class="sd">    Args:</span>
<span class="sd">        img (FibsemImage): A reference image.</span>
<span class="sd">        protocol (dict): A dictionary containing the protocol information.</span>
<span class="sd">        use_trench_height (bool, optional): If True, returns the height of the trench instead of the lamella. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[int]: A tuple containing the height and width of the lamella in pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get real size from protocol</span>
    <span class="n">lamella_width</span> <span class="o">=</span> <span class="n">protocol</span><span class="p">[</span><span class="s2">&quot;lamella_width&quot;</span><span class="p">]</span>
    <span class="n">lamella_height</span> <span class="o">=</span> <span class="n">protocol</span><span class="p">[</span><span class="s2">&quot;lamella_height&quot;</span><span class="p">]</span>

    <span class="n">total_height</span> <span class="o">=</span> <span class="n">lamella_height</span>
    <span class="k">if</span> <span class="n">use_trench_height</span><span class="p">:</span>
        <span class="n">trench_height</span> <span class="o">=</span> <span class="n">protocol</span><span class="p">[</span><span class="s2">&quot;stages&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;trench_height&quot;</span><span class="p">]</span>
        <span class="n">total_height</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">trench_height</span>

    <span class="c1"># convert to m</span>
    <span class="n">pixelsize</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">x</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span>
    <span class="n">vfw</span> <span class="o">=</span> <span class="n">convert_pixels_to_metres</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">)</span>
    <span class="n">hfw</span> <span class="o">=</span> <span class="n">convert_pixels_to_metres</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">)</span>

    <span class="c1"># lamella size in px (% of image)</span>
    <span class="n">lamella_height_px</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">total_height</span> <span class="o">/</span> <span class="n">vfw</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span><span class="p">)</span>
    <span class="n">lamella_width_px</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">lamella_width</span> <span class="o">/</span> <span class="n">hfw</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">lamella_height_px</span><span class="p">,</span> <span class="n">lamella_width_px</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.conversions.image_to_microscope_image_coordinates" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">image_to_microscope_image_coordinates</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert an image pixel coordinate to a microscope image coordinate.</p>
<p>The microscope image coordinate system is centered on the image with positive Y-axis pointing upwards.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>coord</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.Point" href="#fibsem.structures.Point">Point</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A Point object representing the pixel coordinates in the original image.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A numpy array representing the image.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pixelsize</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The pixel size in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Point</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.Point" href="#fibsem.structures.Point">Point</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A Point object representing the corresponding microscope image coordinates in meters.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/conversions.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">image_to_microscope_image_coordinates</span><span class="p">(</span>
    <span class="n">coord</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pixelsize</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert an image pixel coordinate to a microscope image coordinate.</span>

<span class="sd">    The microscope image coordinate system is centered on the image with positive Y-axis pointing upwards.</span>

<span class="sd">    Args:</span>
<span class="sd">        coord (Point): A Point object representing the pixel coordinates in the original image.</span>
<span class="sd">        image (np.ndarray): A numpy array representing the image.</span>
<span class="sd">        pixelsize (float): The pixel size in meters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: A Point object representing the corresponding microscope image coordinates in meters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># convert from image pixel coord (0, 0) top left to microscope image (0, 0) mid</span>

    <span class="c1"># shape</span>
    <span class="n">cy</span><span class="p">,</span> <span class="n">cx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="c1"># distance from centre?</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">cy</span><span class="p">))</span>  <span class="c1"># neg = down</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span>  <span class="c1"># neg = left</span>

    <span class="n">point_m</span> <span class="o">=</span> <span class="n">convert_point_from_pixel_to_metres</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">),</span> <span class="n">pixelsize</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">point_m</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="milling">Milling</h2>


<div class="doc doc-object doc-module">



<a id="fibsem.milling"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.draw_bitmap" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">draw_bitmap</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Draw a butmap milling pattern from settings</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Fibsem</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mill_settings</code></td>
          <td>
                <code>MillingSettings</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>milling pattern settings</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw_bitmap</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="p">:</span> <span class="n">FibsemPatternSettings</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw a butmap milling pattern from settings</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): Fibsem</span>
<span class="sd">        mill_settings (MillingSettings): milling pattern settings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">convert_to_bitmap_format</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">microscope</span><span class="o">.</span><span class="n">draw_bitmap_pattern</span><span class="p">(</span><span class="n">pattern_settings</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.draw_circle" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">draw_circle</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Draw a circular milling pattern from settings</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Fibsem microscope instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mill_settings</code></td>
          <td>
                <code>MillingSettings</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>milling pattern settings</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw_circle</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="p">:</span> <span class="n">FibsemPatternSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw a circular milling pattern from settings</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): Fibsem microscope instance</span>
<span class="sd">        mill_settings (MillingSettings): milling pattern settings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">microscope</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">pattern_settings</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.draw_fiducial" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">draw_fiducial</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>draw the fiducial milling patterns</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>OpenFIBSEM microscope instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mill_settings</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>fiducial milling settings</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>point</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.Point" href="#fibsem.structures.Point">Point</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>centre x, y coordinate</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <h4 id="fibsem.milling.draw_fiducial--returns">Returns</h4>
<pre><code>patterns : list
    List of rectangular patterns used to create the fiducial marker.
</code></pre>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw_fiducial</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span>
    <span class="n">pattern_settings</span><span class="p">:</span> <span class="n">FibsemPatternSettings</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;draw the fiducial milling patterns</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): OpenFIBSEM microscope instance</span>
<span class="sd">        mill_settings (dict): fiducial milling settings</span>
<span class="sd">        point (Point): centre x, y coordinate</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        patterns : list</span>
<span class="sd">            List of rectangular patterns used to create the fiducial marker.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pattern_settings</span><span class="o">.</span><span class="n">rotation</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">pattern_1</span> <span class="o">=</span> <span class="n">draw_rectangle</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="p">)</span>
    <span class="n">pattern_settings</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">pattern_settings</span><span class="o">.</span><span class="n">rotation</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">pattern_2</span> <span class="o">=</span> <span class="n">draw_rectangle</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">pattern_1</span><span class="p">,</span> <span class="n">pattern_2</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.draw_line" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">draw_line</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Draw a line milling pattern from settings</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Fibsem microscope instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mill_settings</code></td>
          <td>
                <code>MillingSettings</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>milling pattern settings</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw_line</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="p">:</span> <span class="n">FibsemPatternSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw a line milling pattern from settings</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): Fibsem microscope instance</span>
<span class="sd">        mill_settings (MillingSettings): milling pattern settings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">microscope</span><span class="o">.</span><span class="n">draw_line</span><span class="p">(</span><span class="n">pattern_settings</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.draw_pattern" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">draw_pattern</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Draw a milling pattern from settings</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Fibsem microscope instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pattern_settings</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemPatternSettings" href="#fibsem.structures.FibsemPatternSettings">FibsemPatternSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pattern settings</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mill_settings</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemMillingSettings" href="#fibsem.structures.FibsemMillingSettings">FibsemMillingSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>milling settings</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw_pattern</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">FibsemPatternSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw a milling pattern from settings</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): Fibsem microscope instance</span>
<span class="sd">        pattern_settings (FibsemPatternSettings): pattern settings</span>
<span class="sd">        mill_settings (FibsemMillingSettings): milling settings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">:</span>
        <span class="n">microscope</span><span class="o">.</span><span class="n">draw_rectangle</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Line</span><span class="p">:</span>
        <span class="n">microscope</span><span class="o">.</span><span class="n">draw_line</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Circle</span><span class="p">:</span>
        <span class="n">microscope</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">:</span>
        <span class="n">microscope</span><span class="o">.</span><span class="n">draw_bitmap_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">pattern</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Annulus</span><span class="p">:</span>
        <span class="n">microscope</span><span class="o">.</span><span class="n">draw_annulus</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.draw_patterns" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">draw_patterns</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">patterns</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Draw a milling pattern from settings
Args:
    microscope (FibsemMicroscope): Fibsem microscope instance</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw_patterns</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">patterns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FibsemPatternSettings</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw a milling pattern from settings</span>
<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): Fibsem microscope instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
        <span class="n">draw_pattern</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.draw_rectangle" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">draw_rectangle</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Draw a rectangular milling pattern from settings</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Fibsem microscope instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pattern_settings</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemPatternSettings" href="#fibsem.structures.FibsemPatternSettings">FibsemPatternSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pattern settings</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mill_settings</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemMillingSettings" href="#fibsem.structures.FibsemMillingSettings">FibsemMillingSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>milling settings</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw_rectangle</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="p">:</span> <span class="n">FibsemPatternSettings</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw a rectangular milling pattern from settings</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): Fibsem microscope instance</span>
<span class="sd">        pattern_settings (FibsemPatternSettings): pattern settings</span>
<span class="sd">        mill_settings (FibsemMillingSettings): milling settings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">microscope</span><span class="o">.</span><span class="n">draw_rectangle</span><span class="p">(</span><span class="n">pattern_settings</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.draw_stress_relief" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">draw_stress_relief</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">microexpansion_protocol</span><span class="p">,</span> <span class="n">lamella_protocol</span><span class="p">,</span> <span class="n">centre_point</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">scan_direction</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LeftToRight&#39;</span><span class="p">,</span> <span class="s1">&#39;RightToLeft&#39;</span><span class="p">])</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Draw the microexpansion joints for stress relief of lamella.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>OpenFIBSEM microscope instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>microexpansion_protocol</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Contains a dictionary of the necessary values for drawing the joints.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>lamella_protocol</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Lamella protocol</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>patterns</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw_stress_relief</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span>
    <span class="n">microexpansion_protocol</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">lamella_protocol</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">centre_point</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">scan_direction</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;LeftToRight&quot;</span><span class="p">,</span> <span class="s2">&quot;RightToLeft&quot;</span><span class="p">],</span> 
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw the microexpansion joints for stress relief of lamella.</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): OpenFIBSEM microscope instance</span>
<span class="sd">        microexpansion_protocol (dict): Contains a dictionary of the necessary values for drawing the joints.</span>
<span class="sd">        lamella_protocol (dict): Lamella protocol</span>

<span class="sd">    Returns:</span>
<span class="sd">        patterns: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">microexpansion_protocol</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">microexpansion_protocol</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">lamella_protocol</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">scan_direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scan_direction</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;LeftToRight&quot;</span><span class="p">,</span> <span class="s2">&quot;RightToLeft&quot;</span><span class="p">]</span>

    <span class="n">left_pattern_settings</span> <span class="o">=</span> <span class="n">FibsemPatternSettings</span><span class="p">(</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
        <span class="n">centre_x</span><span class="o">=</span><span class="n">centre_point</span><span class="o">.</span><span class="n">x</span>
        <span class="o">-</span> <span class="n">lamella_protocol</span><span class="p">[</span><span class="s2">&quot;lamella_width&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="o">-</span> <span class="n">microexpansion_protocol</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">],</span>
        <span class="n">centre_y</span><span class="o">=</span><span class="n">centre_point</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
        <span class="n">cleaning_cross_section</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">scan_direction</span><span class="o">=</span><span class="n">scan_direction</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">right_pattern_settings</span> <span class="o">=</span> <span class="n">FibsemPatternSettings</span><span class="p">(</span>
        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
        <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
        <span class="n">centre_x</span><span class="o">=</span><span class="n">centre_point</span><span class="o">.</span><span class="n">x</span>
        <span class="o">+</span> <span class="n">lamella_protocol</span><span class="p">[</span><span class="s2">&quot;lamella_width&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="o">+</span> <span class="n">microexpansion_protocol</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">],</span>
        <span class="n">centre_y</span><span class="o">=</span><span class="n">centre_point</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
        <span class="n">cleaning_cross_section</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">scan_direction</span><span class="o">=</span><span class="n">scan_direction</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">left_pattern</span> <span class="o">=</span> <span class="n">draw_rectangle</span><span class="p">(</span>
        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="o">=</span><span class="n">left_pattern_settings</span>
    <span class="p">)</span>
    <span class="n">right_pattern</span> <span class="o">=</span> <span class="n">draw_rectangle</span><span class="p">(</span>
        <span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span> <span class="n">pattern_settings</span><span class="o">=</span><span class="n">right_pattern_settings</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">left_pattern</span><span class="p">,</span> <span class="n">right_pattern</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.draw_trench" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">draw_trench</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="n">Point</span><span class="p">())</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Calculate the trench milling patterns</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw_trench</span><span class="p">(</span><span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">protocol</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the trench milling patterns&quot;&quot;&quot;</span>


    <span class="n">lower_pattern_settings</span><span class="p">,</span> <span class="n">upper_pattern_settings</span> <span class="o">=</span> <span class="n">extract_trench_parameters</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>

    <span class="c1"># draw patterns</span>
    <span class="n">lower_pattern</span> <span class="o">=</span> <span class="n">draw_rectangle</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">lower_pattern_settings</span><span class="p">)</span>
    <span class="n">upper_pattern</span> <span class="o">=</span> <span class="n">draw_rectangle</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">upper_pattern_settings</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">lower_pattern</span><span class="p">,</span> <span class="n">upper_pattern</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.finish_milling" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">finish_milling</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">imaging_current</span><span class="o">=</span><span class="mf">2e-11</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Clear milling patterns, and restore to the imaging current.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code>FIbsemMicroscope</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Fibsem microscope instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>imaging_current</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Imaging Current. Defaults to 20e-12.</p>
            </div>
          </td>
          <td>
                <code>2e-11</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">finish_milling</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">imaging_current</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20e-12</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear milling patterns, and restore to the imaging current.</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FIbsemMicroscope): Fibsem microscope instance</span>
<span class="sd">        imaging_current (float, optional): Imaging Current. Defaults to 20e-12.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># restore imaging current</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Changing to Imaging Current: </span><span class="si">{</span><span class="n">imaging_current</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">microscope</span><span class="o">.</span><span class="n">finish_milling</span><span class="p">(</span><span class="n">imaging_current</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished Ion Beam Milling.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.read_protocol_dictionary" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">read_protocol_dictionary</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">stage_name</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Read the milling protocol settings dictionary into a structured format</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>protocol</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>protocol dictionary</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>stage_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>milling stage name</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list[dict]: milling protocol stages</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_protocol_dictionary</span><span class="p">(</span><span class="n">protocol</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">stage_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read the milling protocol settings dictionary into a structured format</span>

<span class="sd">    Args:</span>
<span class="sd">        protocol (dict): protocol dictionary</span>
<span class="sd">        stage_name (str): milling stage name</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict]: milling protocol stages</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># multi-stage</span>
    <span class="k">if</span> <span class="s2">&quot;protocol_stages&quot;</span> <span class="ow">in</span> <span class="n">protocol</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]:</span>
        <span class="n">protocol_stages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stage_settings</span> <span class="ow">in</span> <span class="n">protocol</span><span class="p">[</span><span class="n">stage_name</span><span class="p">][</span><span class="s2">&quot;protocol_stages&quot;</span><span class="p">]:</span>
            <span class="n">tmp_settings</span> <span class="o">=</span> <span class="n">protocol</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">tmp_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">stage_settings</span><span class="p">)</span>
            <span class="n">protocol_stages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_settings</span><span class="p">)</span>
    <span class="c1"># single-stage</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">protocol_stages</span> <span class="o">=</span> <span class="p">[</span><span class="n">protocol</span><span class="p">[</span><span class="n">stage_name</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">protocol_stages</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.run_milling" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">run_milling</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">milling_current</span><span class="p">,</span> <span class="n">asynch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Run Ion Beam Milling.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Fibsem microscope instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>milling_current</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ion beam milling current. Defaults to None.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>asynch</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>flag to run milling asynchronously. Defaults to False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_milling</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span>
    <span class="n">milling_current</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">asynch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run Ion Beam Milling.</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): Fibsem microscope instance</span>
<span class="sd">        milling_current (float, optional): ion beam milling current. Defaults to None.</span>
<span class="sd">        asynch (bool, optional): flag to run milling asynchronously. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">microscope</span><span class="o">.</span><span class="n">run_milling</span><span class="p">(</span><span class="n">milling_current</span><span class="p">,</span> <span class="n">asynch</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.run_milling_drift_corrected" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">run_milling_drift_corrected</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">milling_current</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">,</span> <span class="n">ref_image</span><span class="p">,</span> <span class="n">reduced_area</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Run Ion Beam Milling.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Fibsem microscope instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>milling_current</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ion beam milling current. Defaults to None.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>asynch</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>flag to run milling asynchronously. Defaults to False.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_milling_drift_corrected</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> 
    <span class="n">milling_current</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>  
    <span class="n">image_settings</span><span class="p">:</span> <span class="n">ImageSettings</span><span class="p">,</span> 
    <span class="n">ref_image</span><span class="p">:</span> <span class="n">FibsemImage</span><span class="p">,</span> 
    <span class="n">reduced_area</span><span class="p">:</span> <span class="n">FibsemRectangle</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run Ion Beam Milling.</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): Fibsem microscope instance</span>
<span class="sd">        milling_current (float, optional): ion beam milling current. Defaults to None.</span>
<span class="sd">        asynch (bool, optional): flag to run milling asynchronously. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">microscope</span><span class="o">.</span><span class="n">run_milling_drift_corrected</span><span class="p">(</span><span class="n">milling_current</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">,</span> <span class="n">ref_image</span><span class="p">,</span> <span class="n">reduced_area</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.milling.setup_milling" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">setup_milling</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">mill_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Setup Microscope for Ion Beam Milling.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code><span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Fibsem microscope instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>patterning_mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Ion beam milling patterning mode. Defaults to "Serial".</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>hfw</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>horizontal field width for milling. Defaults to 100e-6.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/milling.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_milling</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span>
    <span class="n">mill_settings</span><span class="p">:</span> <span class="n">FibsemMillingSettings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup Microscope for Ion Beam Milling.</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (FibsemMicroscope): Fibsem microscope instance</span>
<span class="sd">        patterning_mode (str, optional): Ion beam milling patterning mode. Defaults to &quot;Serial&quot;.</span>
<span class="sd">        hfw (float, optional): horizontal field width for milling. Defaults to 100e-6.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">microscope</span><span class="o">.</span><span class="n">setup_milling</span><span class="p">(</span><span class="n">mill_settings</span> <span class="o">=</span> <span class="n">mill_settings</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="movement">Movement</h2>


<div class="doc doc-object doc-module">



<a id="fibsem.movement"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="fibsem.movement.angle_difference" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">angle_difference</span><span class="p">(</span><span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return the difference between two angles, accounting for greater than 360, less than 0 angles</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>angle1</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>angle1 (radians)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>angle2</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>angle2 (radians)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>float</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><em>description</em></p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/movement.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">angle_difference</span><span class="p">(</span><span class="n">angle1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">angle2</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the difference between two angles, accounting for greater than 360, less than 0 angles</span>

<span class="sd">    Args:</span>
<span class="sd">        angle1 (float): angle1 (radians)</span>
<span class="sd">        angle2 (float): angle2 (radians)</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">angle1</span> <span class="o">%=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">angle2</span> <span class="o">%=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="n">large_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">])</span>
    <span class="n">small_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">])</span>

    <span class="k">return</span> <span class="nb">min</span><span class="p">((</span><span class="n">large_angle</span> <span class="o">-</span> <span class="n">small_angle</span><span class="p">),</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">small_angle</span> <span class="o">-</span> <span class="n">large_angle</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.movement.rotation_angle_is_larger" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">rotation_angle_is_larger</span><span class="p">(</span><span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Check the rotation angles are large</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>angle1</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>angle1 (radians)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>angle2</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>angle2 (radians)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>atol</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>tolerance (degrees)</p>
            </div>
          </td>
          <td>
                <code>90</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>bool</code></td>          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>rotation angle is larger than atol</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/movement.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rotation_angle_is_larger</span><span class="p">(</span><span class="n">angle1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">angle2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">90</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the rotation angles are large</span>

<span class="sd">    Args:</span>
<span class="sd">        angle1 (float): angle1 (radians)</span>
<span class="sd">        angle2 (float): angle2 (radians)</span>
<span class="sd">        atol : tolerance (degrees)</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: rotation angle is larger than atol</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">angle_difference</span><span class="p">(</span><span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">atol</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.movement.rotation_angle_is_smaller" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">rotation_angle_is_smaller</span><span class="p">(</span><span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Check the rotation angles are large</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>angle1</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>angle1 (radians)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>angle2</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>angle2 (radians)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>atol</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>tolerance (degrees)</p>
            </div>
          </td>
          <td>
                <code>5</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>bool</code></td>          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>rotation angle is smaller than atol</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/movement.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rotation_angle_is_smaller</span><span class="p">(</span><span class="n">angle1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">angle2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the rotation angles are large</span>

<span class="sd">    Args:</span>
<span class="sd">        angle1 (float): angle1 (radians)</span>
<span class="sd">        angle2 (float): angle2 (radians)</span>
<span class="sd">        atol : tolerance (degrees)</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: rotation angle is smaller than atol</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">angle_difference</span><span class="p">(</span><span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">atol</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="structures">Structures</h2>


<div class="doc doc-object doc-module">



<a id="fibsem.structures"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.BeamSettings" class="doc doc-heading">
          <code>BeamSettings</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Dataclass representing the beam settings for an imaging session.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>beam_type</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.BeamType" href="#fibsem.structures.BeamType">BeamType</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of beam to use for imaging.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>working_distance</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The working distance for the microscope, in meters.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>beam_current</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The beam current for the microscope, in amps.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>hfw</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The horizontal field width for the microscope, in meters.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>resolution</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The desired resolution for the image.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>dwell_time</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dwell time for the microscope.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>stigmation</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.Point" href="#fibsem.structures.Point">Point</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The point for stigmation correction.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>shift</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.Point" href="#fibsem.structures.Point">Point</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The point for shift correction.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Methods:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
          <tr>
            <td><code>__to_dict__</code></td>
            <td>
              <div class="doc-md-description">
                <p>Returns a dictionary representation of the object.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>__from_dict__</code></td>
            <td>
              <div class="doc-md-description">
                <p>dict) -&gt; BeamSettings: Returns a new BeamSettings object created from a dictionary.</p>
              </div>
            </td>
          </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">BeamSettings</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dataclass representing the beam settings for an imaging session.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        beam_type (BeamType): The type of beam to use for imaging.</span>
<span class="sd">        working_distance (float): The working distance for the microscope, in meters.</span>
<span class="sd">        beam_current (float): The beam current for the microscope, in amps.</span>
<span class="sd">        hfw (float): The horizontal field width for the microscope, in meters.</span>
<span class="sd">        resolution (list): The desired resolution for the image.</span>
<span class="sd">        dwell_time (float): The dwell time for the microscope.</span>
<span class="sd">        stigmation (Point): The point for stigmation correction.</span>
<span class="sd">        shift (Point): The point for shift correction.</span>

<span class="sd">    Methods:</span>
<span class="sd">        __to_dict__(): Returns a dictionary representation of the object.</span>
<span class="sd">        __from_dict__(state_dict: dict) -&gt; BeamSettings: Returns a new BeamSettings object created from a dictionary.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">beam_type</span><span class="p">:</span> <span class="n">BeamType</span>
    <span class="n">working_distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">beam_current</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">voltage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">hfw</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">dwell_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">stigmation</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="n">shift</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="n">scan_rotation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="ow">in</span> <span class="p">[</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">,</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;beam_type must be instance of BeamType, currently </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_distance</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">working_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Working distance must be float or int, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_distance</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_current</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_current</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;beam current must be float or int, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_current</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voltage</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">voltage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;voltage must be float or int, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voltage</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hfw</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">hfw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;horizontal field width (HFW) must be float or int, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hfw</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;resolution must be a list, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dwell_time</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwell_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;dwell_time must be float or int, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dwell_time</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stigmation</span><span class="p">,</span><span class="n">Point</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stigmation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;stigmation must be a Point instance, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stigmation</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shift</span><span class="p">,</span><span class="n">Point</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;shift must be a Point instance, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

        <span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;beam_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;working_distance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">working_distance</span><span class="p">,</span>
            <span class="s2">&quot;beam_current&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_current</span><span class="p">,</span>
            <span class="s2">&quot;voltage&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">voltage</span><span class="p">,</span>
            <span class="s2">&quot;hfw&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hfw</span><span class="p">,</span>
            <span class="s2">&quot;resolution&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
            <span class="s2">&quot;dwell_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwell_time</span><span class="p">,</span>
            <span class="s2">&quot;stigmation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stigmation</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stigmation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;shift&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;scan_rotation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_rotation</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">state_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">state_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BeamSettings&quot;</span><span class="p">:</span>

        <span class="k">if</span> <span class="s2">&quot;stigmation&quot;</span> <span class="ow">in</span> <span class="n">state_dict</span> <span class="ow">and</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;stigmation&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stigmation</span> <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;stigmation&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stigmation</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;shift&quot;</span> <span class="ow">in</span> <span class="n">state_dict</span> <span class="ow">and</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;shift&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;shift&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">Point</span><span class="p">()</span>


        <span class="n">beam_settings</span> <span class="o">=</span> <span class="n">BeamSettings</span><span class="p">(</span>
            <span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;beam_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()],</span>
            <span class="n">working_distance</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;working_distance&quot;</span><span class="p">],</span>
            <span class="n">beam_current</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;beam_current&quot;</span><span class="p">],</span>
            <span class="n">voltage</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;voltage&quot;</span><span class="p">],</span>
            <span class="n">hfw</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;hfw&quot;</span><span class="p">],</span>
            <span class="n">resolution</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">],</span>
            <span class="n">dwell_time</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;dwell_time&quot;</span><span class="p">],</span>
            <span class="n">stigmation</span><span class="o">=</span><span class="n">stigmation</span><span class="p">,</span>
            <span class="n">shift</span><span class="o">=</span><span class="n">shift</span><span class="p">,</span>
            <span class="n">scan_rotation</span><span class="o">=</span><span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_rotation&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">beam_settings</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.BeamSystemSettings" class="doc doc-heading">
          <code>BeamSystemSettings</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>A data class that represents the settings of a beam system.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>beam_type</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.BeamType" href="#fibsem.structures.BeamType">BeamType</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of beam used in the system (Electron or Ion).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>voltage</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The voltage used in the system.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>current</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The current used in the system.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>detector_type</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of detector used in the system.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>detector_mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The mode of the detector used in the system.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>eucentric_height</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The eucentric height of the system.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>plasma_gas</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of plasma gas used in the system.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Methods:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
          <tr>
            <td><code>__to_dict__</code></td>
            <td>
              <div class="doc-md-description">
                <p>Converts the instance variables to a dictionary.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>__from_dict__</code></td>
            <td>
              <div class="doc-md-description">
                <p>dict, beam_type: BeamType) -&gt; BeamSystemSettings:
Creates an instance of the class from a dictionary and a beam type.</p>
              </div>
            </td>
          </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">BeamSystemSettings</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A data class that represents the settings of a beam system.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        beam_type (BeamType): The type of beam used in the system (Electron or Ion).</span>
<span class="sd">        voltage (float): The voltage used in the system.</span>
<span class="sd">        current (float): The current used in the system.</span>
<span class="sd">        detector_type (str): The type of detector used in the system.</span>
<span class="sd">        detector_mode (str): The mode of the detector used in the system.</span>
<span class="sd">        eucentric_height (float): The eucentric height of the system.</span>
<span class="sd">        plasma_gas (str, optional): The type of plasma gas used in the system.</span>

<span class="sd">    Methods:</span>
<span class="sd">        __to_dict__(self) -&gt; dict:</span>
<span class="sd">            Converts the instance variables to a dictionary.</span>
<span class="sd">        __from_dict__(settings: dict, beam_type: BeamType) -&gt; BeamSystemSettings:</span>
<span class="sd">            Creates an instance of the class from a dictionary and a beam type.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">beam_type</span><span class="p">:</span> <span class="n">BeamType</span>
    <span class="n">voltage</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">current</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">detector_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">detector_mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">eucentric_height</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">plasma_gas</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

        <span class="n">settings_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;voltage&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">voltage</span><span class="p">,</span>
            <span class="s2">&quot;current&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span>
            <span class="s2">&quot;detector_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector_type</span><span class="p">,</span>
            <span class="s2">&quot;detector_mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector_mode</span><span class="p">,</span>
            <span class="s2">&quot;eucentric_height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">eucentric_height</span><span class="p">,</span>
            <span class="s2">&quot;plasma_gas&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plasma_gas</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">settings_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">beam_type</span><span class="p">:</span> <span class="n">BeamType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BeamSystemSettings&quot;</span><span class="p">:</span>

        <span class="k">if</span> <span class="s2">&quot;plasma_gas&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;plasma_gas&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NULL&quot;</span>

        <span class="n">system_settings</span> <span class="o">=</span> <span class="n">BeamSystemSettings</span><span class="p">(</span>
            <span class="n">beam_type</span><span class="o">=</span><span class="n">beam_type</span><span class="p">,</span>
            <span class="n">voltage</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;voltage&quot;</span><span class="p">],</span>
            <span class="n">current</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;current&quot;</span><span class="p">],</span>
            <span class="n">detector_type</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;detector_type&quot;</span><span class="p">],</span>
            <span class="n">detector_mode</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;detector_mode&quot;</span><span class="p">],</span>
            <span class="n">eucentric_height</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;eucentric_height&quot;</span><span class="p">],</span>
            <span class="n">plasma_gas</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;plasma_gas&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">system_settings</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.BeamType" class="doc doc-heading">
          <code>BeamType</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="enum.Enum">Enum</span></code></p>

  
      <p>Enumerator Class for Beam Type
1: Electron Beam
2: Ion Beam</p>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BeamType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enumerator Class for Beam Type</span>
<span class="sd">        1: Electron Beam</span>
<span class="sd">        2: Ion Beam</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ELECTRON</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Electron</span>
    <span class="n">ION</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Ion</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemDetectorSettings" class="doc doc-heading">
          <code>FibsemDetectorSettings</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FibsemDetectorSettings</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">brightness</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;type must be input as str, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;mode must be input as str, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brightness</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">brightness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;brightness must be int or float value, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brightness</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contrast</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;contrast must be int or float value, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contrast</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">TESCAN</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">to_tescan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Converts to tescan format.&quot;&quot;&quot;</span>
            <span class="n">tescan_brightness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brightness</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">tescan_contrast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="k">return</span> <span class="n">tescan_brightness</span><span class="p">,</span> <span class="n">tescan_contrast</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts to a dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
            <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">brightness</span><span class="p">,</span>
            <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemDetectorSettings&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts from a dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">FibsemDetectorSettings</span><span class="p">(</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="n">brightness</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;brightness&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="n">contrast</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contrast&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemDetectorSettings.__from_dict__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts from a dictionary.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemDetectorSettings&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts from a dictionary.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">FibsemDetectorSettings</span><span class="p">(</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="n">brightness</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;brightness&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="n">contrast</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;contrast&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemDetectorSettings.__to_dict__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__to_dict__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts to a dictionary.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts to a dictionary.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
        <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
        <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">brightness</span><span class="p">,</span>
        <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemDetectorSettings.to_tescan" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">to_tescan</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts to tescan format.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_tescan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts to tescan format.&quot;&quot;&quot;</span>
    <span class="n">tescan_brightness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brightness</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">tescan_contrast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="k">return</span> <span class="n">tescan_brightness</span><span class="p">,</span> <span class="n">tescan_contrast</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemExperiment" class="doc doc-heading">
          <code>FibsemExperiment</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FibsemExperiment</span><span class="p">:</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">date</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timestamp</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
    <span class="n">application</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;OpenFIBSEM&quot;</span>
    <span class="n">fibsem_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">fibsem</span><span class="o">.</span><span class="n">__version__</span>
    <span class="n">application_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts to a dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
            <span class="s2">&quot;application&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="p">,</span>
            <span class="s2">&quot;fibsem_version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fibsem_version</span><span class="p">,</span>
            <span class="s2">&quot;application_version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_version</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemExperiment&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts from a dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">FibsemExperiment</span><span class="p">(</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="n">application</span><span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;OpenFIBSEM&quot;</span><span class="p">),</span>
            <span class="n">fibsem_version</span><span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fibsem_version&quot;</span><span class="p">,</span> <span class="n">fibsem</span><span class="o">.</span><span class="n">__version__</span><span class="p">),</span>
            <span class="n">application_version</span><span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;application_version&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemExperiment.__from_dict__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts from a dictionary.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemExperiment&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts from a dictionary.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">FibsemExperiment</span><span class="p">(</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="n">application</span><span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;OpenFIBSEM&quot;</span><span class="p">),</span>
        <span class="n">fibsem_version</span><span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fibsem_version&quot;</span><span class="p">,</span> <span class="n">fibsem</span><span class="o">.</span><span class="n">__version__</span><span class="p">),</span>
        <span class="n">application_version</span><span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;application_version&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemExperiment.__to_dict__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__to_dict__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts to a dictionary.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts to a dictionary.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
        <span class="s2">&quot;application&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="p">,</span>
        <span class="s2">&quot;fibsem_version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fibsem_version</span><span class="p">,</span>
        <span class="s2">&quot;application_version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_version</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemHardware" class="doc doc-heading">
          <code>FibsemHardware</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Data class for storing hardware information.
Attributes:</p>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FibsemHardware</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data class for storing hardware information.</span>
<span class="sd">Attributes:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">electron_beam</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">ion_beam</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">can_select_plasma_gas</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">stage_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">stage_rotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">stage_tilt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">manipulator_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">manipulator_rotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">manipulator_tilt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">gis_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">gis_multichem</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">manipulator_positions</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;electron_beam&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ion_beam&quot;</span><span class="p">,</span>
            <span class="s2">&quot;can_select_plasma_gas&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stage_enabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stage_rotation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stage_tilt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;manipulator_enabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;manipulator_rotation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;manipulator_tilt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gis_enabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gis_multichem&quot;</span><span class="p">,</span>
            <span class="s2">&quot;manipulator_positions&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">object_attribute</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attribute</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;manipulator_positions&quot;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">object_attribute</span><span class="p">,</span><span class="nb">bool</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">hardware_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemHardware&quot;</span><span class="p">:</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">electron_beam</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;electron&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]),</span>
            <span class="n">ion_beam</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]),</span>
            <span class="n">can_select_plasma_gas</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">][</span><span class="s2">&quot;can_select_plasma_gas&quot;</span><span class="p">]),</span>
            <span class="n">stage_enabled</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]),</span>
            <span class="n">stage_rotation</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">][</span><span class="s2">&quot;rotation&quot;</span><span class="p">]),</span>
            <span class="n">stage_tilt</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">][</span><span class="s2">&quot;tilt&quot;</span><span class="p">]),</span>
            <span class="n">manipulator_enabled</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]),</span>
            <span class="n">manipulator_rotation</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;rotation&quot;</span><span class="p">]),</span>
            <span class="n">manipulator_tilt</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;tilt&quot;</span><span class="p">]),</span>
            <span class="n">gis_enabled</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;gis&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]),</span>
            <span class="n">gis_multichem</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;gis&quot;</span><span class="p">][</span><span class="s2">&quot;multichem&quot;</span><span class="p">]),</span>
            <span class="n">manipulator_positions</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;parking&quot;</span><span class="p">:{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;parking&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
                           <span class="s2">&quot;y&quot;</span><span class="p">:</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;parking&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
                           <span class="s2">&quot;z&quot;</span><span class="p">:</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;parking&quot;</span><span class="p">][</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
                <span class="p">},</span>
                <span class="s2">&quot;standby&quot;</span><span class="p">:{</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;standby&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;y&quot;</span><span class="p">:</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;standby&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;z&quot;</span><span class="p">:</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;standby&quot;</span><span class="p">][</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
                <span class="p">},</span>
                <span class="s2">&quot;working&quot;</span><span class="p">:{</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;working&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;y&quot;</span><span class="p">:</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;working&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;z&quot;</span><span class="p">:</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;working&quot;</span><span class="p">][</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
                <span class="p">},</span>
                <span class="s2">&quot;calibrated&quot;</span><span class="p">:</span><span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;calibrated&quot;</span><span class="p">]},</span> 
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

            <span class="n">hardware_dict</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;electron&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;electron&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electron_beam</span>

            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ion_beam</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">][</span><span class="s2">&quot;can_select_plasma_gas&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_select_plasma_gas</span>

            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_enabled</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">][</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_rotation</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">][</span><span class="s2">&quot;tilt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_tilt</span>

            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_enabled</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_rotation</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;tilt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_tilt</span>

            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;gis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;gis&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gis_enabled</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;gis&quot;</span><span class="p">][</span><span class="s2">&quot;multichem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gis_multichem</span>

            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;calibrated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_positions</span><span class="p">[</span><span class="s2">&quot;calibrated&quot;</span><span class="p">]</span>

            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;parking&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;parking&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_positions</span><span class="p">[</span><span class="s2">&quot;parking&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;parking&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_positions</span><span class="p">[</span><span class="s2">&quot;parking&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;parking&quot;</span><span class="p">][</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_positions</span><span class="p">[</span><span class="s2">&quot;parking&quot;</span><span class="p">][</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>

            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;standby&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;standby&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_positions</span><span class="p">[</span><span class="s2">&quot;standby&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;standby&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_positions</span><span class="p">[</span><span class="s2">&quot;standby&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> 
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;standby&quot;</span><span class="p">][</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_positions</span><span class="p">[</span><span class="s2">&quot;standby&quot;</span><span class="p">][</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>

            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;working&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;working&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_positions</span><span class="p">[</span><span class="s2">&quot;working&quot;</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;working&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_positions</span><span class="p">[</span><span class="s2">&quot;working&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
            <span class="n">hardware_dict</span><span class="p">[</span><span class="s2">&quot;manipulator&quot;</span><span class="p">][</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="s2">&quot;working&quot;</span><span class="p">][</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manipulator_positions</span><span class="p">[</span><span class="s2">&quot;working&quot;</span><span class="p">][</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>


            <span class="k">return</span> <span class="n">hardware_dict</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemImage" class="doc doc-heading">
          <code>FibsemImage</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Class representing a FibsemImage and its associated metadata. 
Has in built methods to deal with image types of TESCAN and ThermoFisher API </p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The image data stored in a numpy array.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>metadata</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImageMetadata" href="#fibsem.structures.FibsemImageMetadata">FibsemImageMetadata</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The metadata associated with the image. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Methods:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
          <tr>
            <td><code>load</code></td>
            <td>
              <div class="doc-md-description">
                <p>str) -&gt; "FibsemImage":
Loads a FibsemImage from a tiff file.</p>
<p>Args:
    tiff_path (path): path to the tif* file</p>
<p>Returns:
    FibsemImage: instance of FibsemImage</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>save</code></td>
            <td>
              <div class="doc-md-description">
                <p>Path) -&gt; None:
Saves a FibsemImage to a tiff file.</p>
<p>Inputs:
    save_path (path): path to save directory and filename</p>
              </div>
            </td>
          </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FibsemImage</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class representing a FibsemImage and its associated metadata. </span>
<span class="sd">    Has in built methods to deal with image types of TESCAN and ThermoFisher API </span>

<span class="sd">    Args:</span>
<span class="sd">        data (np.ndarray): The image data stored in a numpy array.</span>
<span class="sd">        metadata (FibsemImageMetadata, optional): The metadata associated with the image. Defaults to None.</span>

<span class="sd">    Methods:</span>
<span class="sd">        load(cls, tiff_path: str) -&gt; &quot;FibsemImage&quot;:</span>
<span class="sd">            Loads a FibsemImage from a tiff file.</span>

<span class="sd">            Args:</span>
<span class="sd">                tiff_path (path): path to the tif* file</span>

<span class="sd">            Returns:</span>
<span class="sd">                FibsemImage: instance of FibsemImage</span>

<span class="sd">        save(self, save_path: Path) -&gt; None:</span>
<span class="sd">            Saves a FibsemImage to a tiff file.</span>

<span class="sd">            Inputs:</span>
<span class="sd">                save_path (path): path to save directory and filename</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">FibsemImageMetadata</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">check_data_format</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid Data format for Fibsem Image&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tiff_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemImage&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a FibsemImage from a tiff file.</span>

<span class="sd">        Args:</span>
<span class="sd">            tiff_path (path): path to the tif* file</span>

<span class="sd">        Returns:</span>
<span class="sd">            FibsemImage: instance of FibsemImage</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tff</span><span class="o">.</span><span class="n">TiffFile</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">tiff_image</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">tiff_image</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
                    <span class="n">tiff_image</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;ImageDescription&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="p">)</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="n">FibsemImageMetadata</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="kn">import</span> <span class="nn">traceback</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves a FibsemImage to a tiff file.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            save_path (path): path to save directory and filename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metadata_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tff</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span>
            <span class="n">save_path</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata_dict</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">THERMO</span><span class="p">:</span>

        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">fromAdornedImage</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">adorned</span><span class="p">:</span> <span class="n">AdornedImage</span><span class="p">,</span>
            <span class="n">image_settings</span><span class="p">:</span> <span class="n">ImageSettings</span><span class="p">,</span>
            <span class="n">state</span><span class="p">:</span> <span class="n">MicroscopeState</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">detector</span><span class="p">:</span> <span class="n">FibsemDetectorSettings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemImage&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Creates FibsemImage from an AdornedImage (microscope output format).</span>

<span class="sd">            Args:</span>
<span class="sd">                adorned (AdornedImage): Adorned Image from microscope</span>
<span class="sd">                metadata (FibsemImageMetadata, optional): metadata extracted from microscope output. Defaults to None.</span>

<span class="sd">            Returns:</span>
<span class="sd">                FibsemImage: instance of FibsemImage from AdornedImage</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">MicroscopeState</span><span class="p">(</span>
                    <span class="n">timestamp</span><span class="o">=</span><span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">acquisition</span><span class="o">.</span><span class="n">acquisition_datetime</span><span class="p">,</span>
                    <span class="n">absolute_position</span><span class="o">=</span><span class="n">FibsemStagePosition</span><span class="p">(</span>
                        <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stage_settings</span><span class="o">.</span><span class="n">stage_position</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                        <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stage_settings</span><span class="o">.</span><span class="n">stage_position</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                        <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stage_settings</span><span class="o">.</span><span class="n">stage_position</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                        <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stage_settings</span><span class="o">.</span><span class="n">stage_position</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
                        <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stage_settings</span><span class="o">.</span><span class="n">stage_position</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">eb_settings</span><span class="o">=</span><span class="n">BeamSettings</span><span class="p">(</span><span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">),</span>
                    <span class="n">ib_settings</span><span class="o">=</span><span class="n">BeamSettings</span><span class="p">(</span><span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">acquisition</span><span class="o">.</span><span class="n">acquisition_datetime</span>

            <span class="n">pixel_size</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span>
                <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">binary_result</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">binary_result</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">metadata</span> <span class="o">=</span> <span class="n">FibsemImageMetadata</span><span class="p">(</span>
                <span class="n">image_settings</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
                <span class="n">pixel_size</span><span class="o">=</span><span class="n">pixel_size</span><span class="p">,</span>
                <span class="n">microscope_state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
                <span class="n">detector_settings</span><span class="o">=</span> <span class="n">detector</span><span class="p">,</span> 
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">adorned</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">TESCAN</span><span class="p">:</span>

        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">fromTescanImage</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">image</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span>
            <span class="n">image_settings</span><span class="p">:</span> <span class="n">ImageSettings</span><span class="p">,</span>
            <span class="n">state</span><span class="p">:</span> <span class="n">MicroscopeState</span><span class="p">,</span>
            <span class="n">detector</span><span class="p">:</span> <span class="n">FibsemDetectorSettings</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemImage&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Creates FibsemImage from a tescan (microscope output format).</span>

<span class="sd">            Args:</span>
<span class="sd">                image (Tescan): Adorned Image from microscope</span>
<span class="sd">                metadata (FibsemImageMetadata, optional): metadata extracted from microscope output. Defaults to None.</span>

<span class="sd">            Returns:</span>
<span class="sd">                FibsemImage: instance of FibsemImage from AdornedImage</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">pixel_size</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;PixelSizeX&quot;</span><span class="p">]),</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;PixelSizeY&quot;</span><span class="p">]),</span>
            <span class="p">)</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">FibsemImageMetadata</span><span class="p">(</span>
                <span class="n">image_settings</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
                <span class="n">pixel_size</span><span class="o">=</span><span class="n">pixel_size</span><span class="p">,</span>
                <span class="n">microscope_state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
                <span class="n">detector_settings</span><span class="o">=</span> <span class="n">detector</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">Image</span><span class="p">),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">fromTescanFile</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">image_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">metadata_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">beam_type</span><span class="p">:</span> <span class="n">BeamType</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemImage&quot;</span><span class="p">:</span>

            <span class="k">with</span> <span class="n">tff</span><span class="o">.</span><span class="n">TiffFile</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">tiff_image</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">tiff_image</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>

            <span class="n">stage</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MAIN&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;SEM&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;FIB&quot;</span><span class="p">:</span> <span class="p">{}}</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">metadata_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">):</span>
                        <span class="n">stage</span> <span class="o">+=</span><span class="mi">1</span> 
                        <span class="k">continue</span> 

                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">continue</span>  <span class="c1"># Skip empty lines</span>

                    <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">beam_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ELECTRON&quot;</span><span class="p">:</span>
                        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">beam_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ION&quot;</span><span class="p">:</span>
                        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;FIB&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">if</span> <span class="n">beam_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ELECTRON&quot;</span><span class="p">:</span>  
                <span class="n">image_settings</span> <span class="o">=</span> <span class="n">ImageSettings</span><span class="p">(</span>
                    <span class="n">resolution</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">dwell_time</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="s2">&quot;DwellTime&quot;</span><span class="p">]),</span>
                    <span class="n">hfw</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;PixelSizeX&quot;</span><span class="p">]),</span>
                    <span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span>
                    <span class="n">save_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">pixel_size</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;PixelSizeX&quot;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;PixelSizeY&quot;</span><span class="p">]))</span>
                <span class="n">microscope_state</span> <span class="o">=</span> <span class="n">MicroscopeState</span><span class="p">(</span>
                    <span class="n">timestamp</span><span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;Time&quot;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
                    <span class="n">eb_settings</span><span class="o">=</span><span class="n">BeamSettings</span><span class="p">(</span>
                        <span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">,</span>
                        <span class="n">working_distance</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="s2">&quot;WD&quot;</span><span class="p">]),</span>
                        <span class="n">beam_current</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="s2">&quot;PredictedBeamCurrent&quot;</span><span class="p">]),</span>
                        <span class="n">voltage</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="s2">&quot;TubeVoltage&quot;</span><span class="p">]),</span>
                        <span class="n">hfw</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;PixelSizeX&quot;</span><span class="p">]),</span>
                        <span class="n">resolution</span><span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="n">dwell_time</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="s2">&quot;DwellTime&quot;</span><span class="p">]),</span>
                        <span class="n">shift</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="s2">&quot;ImageShiftX&quot;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="s2">&quot;ImageShiftY&quot;</span><span class="p">])),</span>
                        <span class="n">stigmation</span><span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="s2">&quot;StigmatorX&quot;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="s2">&quot;StigmatorY&quot;</span><span class="p">])),</span>
                        <span class="p">),</span>
                    <span class="n">ib_settings</span> <span class="o">=</span> <span class="n">BeamSettings</span><span class="p">(</span><span class="n">beam_type</span> <span class="o">=</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">detector_settings</span> <span class="o">=</span> <span class="n">FibsemDetectorSettings</span><span class="p">(</span>
                    <span class="nb">type</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="s2">&quot;Detector&quot;</span><span class="p">],</span>
                    <span class="n">brightness</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="s2">&quot;Detector0Offset&quot;</span><span class="p">]),</span>
                    <span class="n">contrast</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;SEM&quot;</span><span class="p">][</span><span class="s2">&quot;Detector0Gain&quot;</span><span class="p">]),</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">beam_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ION&quot;</span><span class="p">:</span>
                <span class="n">image_settings</span> <span class="o">=</span> <span class="n">ImageSettings</span><span class="p">(</span>
                    <span class="n">resolution</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">dwell_time</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;FIB&quot;</span><span class="p">][</span><span class="s2">&quot;DwellTime&quot;</span><span class="p">]),</span>
                    <span class="n">hfw</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;PixelSizeX&quot;</span><span class="p">]),</span>
                    <span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span>
                    <span class="n">save_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">pixel_size</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;PixelSizeX&quot;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;PixelSizeY&quot;</span><span class="p">]))</span>
                <span class="n">microscope_state</span> <span class="o">=</span> <span class="n">MicroscopeState</span><span class="p">(</span>
                    <span class="n">timestamp</span><span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;Time&quot;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
                    <span class="n">eb_settings</span> <span class="o">=</span> <span class="n">BeamSettings</span><span class="p">(</span><span class="n">beam_type</span> <span class="o">=</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">),</span>
                    <span class="n">ib_settings</span> <span class="o">=</span> <span class="n">BeamSettings</span><span class="p">(</span>
                        <span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">,</span>
                        <span class="n">working_distance</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;FIB&quot;</span><span class="p">][</span><span class="s2">&quot;WD&quot;</span><span class="p">]),</span>
                        <span class="n">beam_current</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;FIB&quot;</span><span class="p">][</span><span class="s2">&quot;PredictedBeamCurrent&quot;</span><span class="p">]),</span>
                        <span class="n">hfw</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;PixelSizeX&quot;</span><span class="p">]),</span>
                        <span class="n">resolution</span><span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="n">dwell_time</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;FIB&quot;</span><span class="p">][</span><span class="s2">&quot;DwellTime&quot;</span><span class="p">]),</span>
                        <span class="n">shift</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;FIB&quot;</span><span class="p">][</span><span class="s2">&quot;ImageShiftX&quot;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;FIB&quot;</span><span class="p">][</span><span class="s2">&quot;ImageShiftY&quot;</span><span class="p">])),</span>
                        <span class="n">stigmation</span><span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;FIB&quot;</span><span class="p">][</span><span class="s2">&quot;StigmatorX&quot;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;FIB&quot;</span><span class="p">][</span><span class="s2">&quot;StigmatorY&quot;</span><span class="p">])),</span>
                        <span class="p">),</span>
                <span class="p">)</span>
                <span class="n">detector_settings</span> <span class="o">=</span> <span class="n">FibsemDetectorSettings</span><span class="p">(</span>
                    <span class="nb">type</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;FIB&quot;</span><span class="p">][</span><span class="s2">&quot;Detector&quot;</span><span class="p">],</span>
                    <span class="n">brightness</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;FIB&quot;</span><span class="p">][</span><span class="s2">&quot;Detector0Offset&quot;</span><span class="p">])</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span>
                    <span class="n">contrast</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;FIB&quot;</span><span class="p">][</span><span class="s2">&quot;Detector0Gain&quot;</span><span class="p">])</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">metadata</span> <span class="o">=</span> <span class="n">FibsemImageMetadata</span><span class="p">(</span>
                <span class="n">image_settings</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
                <span class="n">pixel_size</span><span class="o">=</span><span class="n">pixel_size</span><span class="p">,</span>
                <span class="n">microscope_state</span><span class="o">=</span><span class="n">microscope_state</span><span class="p">,</span>
                <span class="n">detector_settings</span><span class="o">=</span> <span class="n">detector_settings</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="n">METADATA_VERSION</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemImage.fromAdornedImage" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fromAdornedImage</span><span class="p">(</span><span class="n">adorned</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">detector</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates FibsemImage from an AdornedImage (microscope output format).</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>adorned</code></td>
          <td>
                <code><span title="autoscript_sdb_microscope_client.structures.AdornedImage">AdornedImage</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Adorned Image from microscope</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>metadata</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImageMetadata" href="#fibsem.structures.FibsemImageMetadata">FibsemImageMetadata</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>metadata extracted from microscope output. Defaults to None.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>FibsemImage</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>instance of FibsemImage from AdornedImage</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">fromAdornedImage</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">adorned</span><span class="p">:</span> <span class="n">AdornedImage</span><span class="p">,</span>
    <span class="n">image_settings</span><span class="p">:</span> <span class="n">ImageSettings</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">MicroscopeState</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">detector</span><span class="p">:</span> <span class="n">FibsemDetectorSettings</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemImage&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates FibsemImage from an AdornedImage (microscope output format).</span>

<span class="sd">    Args:</span>
<span class="sd">        adorned (AdornedImage): Adorned Image from microscope</span>
<span class="sd">        metadata (FibsemImageMetadata, optional): metadata extracted from microscope output. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        FibsemImage: instance of FibsemImage from AdornedImage</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">MicroscopeState</span><span class="p">(</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">acquisition</span><span class="o">.</span><span class="n">acquisition_datetime</span><span class="p">,</span>
            <span class="n">absolute_position</span><span class="o">=</span><span class="n">FibsemStagePosition</span><span class="p">(</span>
                <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stage_settings</span><span class="o">.</span><span class="n">stage_position</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stage_settings</span><span class="o">.</span><span class="n">stage_position</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stage_settings</span><span class="o">.</span><span class="n">stage_position</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stage_settings</span><span class="o">.</span><span class="n">stage_position</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
                <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stage_settings</span><span class="o">.</span><span class="n">stage_position</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">eb_settings</span><span class="o">=</span><span class="n">BeamSettings</span><span class="p">(</span><span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">),</span>
            <span class="n">ib_settings</span><span class="o">=</span><span class="n">BeamSettings</span><span class="p">(</span><span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">acquisition</span><span class="o">.</span><span class="n">acquisition_datetime</span>

    <span class="n">pixel_size</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span>
        <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">binary_result</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
        <span class="n">adorned</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">binary_result</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="n">FibsemImageMetadata</span><span class="p">(</span>
        <span class="n">image_settings</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
        <span class="n">pixel_size</span><span class="o">=</span><span class="n">pixel_size</span><span class="p">,</span>
        <span class="n">microscope_state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
        <span class="n">detector_settings</span><span class="o">=</span> <span class="n">detector</span><span class="p">,</span> 
    <span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">adorned</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemImage.fromTescanImage" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fromTescanImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">detector</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates FibsemImage from a tescan (microscope output format).</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>image</code></td>
          <td>
                <code>Tescan</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Adorned Image from microscope</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>metadata</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImageMetadata" href="#fibsem.structures.FibsemImageMetadata">FibsemImageMetadata</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>metadata extracted from microscope output. Defaults to None.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>FibsemImage</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>instance of FibsemImage from AdornedImage</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">fromTescanImage</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span>
    <span class="n">image_settings</span><span class="p">:</span> <span class="n">ImageSettings</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">MicroscopeState</span><span class="p">,</span>
    <span class="n">detector</span><span class="p">:</span> <span class="n">FibsemDetectorSettings</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemImage&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates FibsemImage from a tescan (microscope output format).</span>

<span class="sd">    Args:</span>
<span class="sd">        image (Tescan): Adorned Image from microscope</span>
<span class="sd">        metadata (FibsemImageMetadata, optional): metadata extracted from microscope output. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        FibsemImage: instance of FibsemImage from AdornedImage</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pixel_size</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;PixelSizeX&quot;</span><span class="p">]),</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;MAIN&quot;</span><span class="p">][</span><span class="s2">&quot;PixelSizeY&quot;</span><span class="p">]),</span>
    <span class="p">)</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">FibsemImageMetadata</span><span class="p">(</span>
        <span class="n">image_settings</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
        <span class="n">pixel_size</span><span class="o">=</span><span class="n">pixel_size</span><span class="p">,</span>
        <span class="n">microscope_state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
        <span class="n">detector_settings</span><span class="o">=</span> <span class="n">detector</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">Image</span><span class="p">),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemImage.load" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Loads a FibsemImage from a tiff file.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>tiff_path</code></td>
          <td>
                <code>path</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to the tif* file</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>FibsemImage</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>instance of FibsemImage</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tiff_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemImage&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads a FibsemImage from a tiff file.</span>

<span class="sd">    Args:</span>
<span class="sd">        tiff_path (path): path to the tif* file</span>

<span class="sd">    Returns:</span>
<span class="sd">        FibsemImage: instance of FibsemImage</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">tff</span><span class="o">.</span><span class="n">TiffFile</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">tiff_image</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">tiff_image</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
                <span class="n">tiff_image</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;ImageDescription&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="p">)</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">FibsemImageMetadata</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">traceback</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemImage.save" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Saves a FibsemImage to a tiff file.</p>

<details class="inputs" open>
  <summary>Inputs</summary>
  <p>save_path (path): path to save directory and filename</p>
</details>
          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves a FibsemImage to a tiff file.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        save_path (path): path to save directory and filename</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">save_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">metadata_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">metadata_dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">tff</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span>
        <span class="n">save_path</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">metadata_dict</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemImageMetadata" class="doc doc-heading">
          <code>FibsemImageMetadata</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Metadata for a FibsemImage.</p>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FibsemImageMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Metadata for a FibsemImage.&quot;&quot;&quot;</span>

    <span class="n">image_settings</span><span class="p">:</span> <span class="n">ImageSettings</span>
    <span class="n">pixel_size</span><span class="p">:</span> <span class="n">Point</span>
    <span class="n">microscope_state</span><span class="p">:</span> <span class="n">MicroscopeState</span>
    <span class="n">detector_settings</span><span class="p">:</span> <span class="n">FibsemDetectorSettings</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">METADATA_VERSION</span>
    <span class="n">user</span><span class="p">:</span> <span class="n">FibsemUser</span> <span class="o">=</span> <span class="n">FibsemUser</span><span class="p">()</span>
    <span class="n">experiment</span><span class="p">:</span> <span class="n">FibsemExperiment</span> <span class="o">=</span> <span class="n">FibsemExperiment</span><span class="p">()</span>
    <span class="n">system</span><span class="p">:</span> <span class="n">FibsemSystem</span> <span class="o">=</span> <span class="n">FibsemSystem</span><span class="p">()</span>



    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts metadata to a dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dictionary: self as a dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">settings_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span> <span class="c1"># TODO: gracefully depreceate this</span>
            <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;pixel_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">microscope_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;microscope_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">microscope_state</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;detector_settings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector_settings</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;experiment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">settings_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ImageSettings&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts a dictionary to metadata.&quot;&quot;&quot;</span>

        <span class="n">image_settings</span> <span class="o">=</span> <span class="n">ImageSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pixel_size&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pixel_size</span> <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pixel_size&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;microscope_state&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">microscope_state</span> <span class="o">=</span> <span class="n">MicroscopeState</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;microscope_state&quot;</span><span class="p">])</span>

        <span class="n">detector_dict</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;detector_settings&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
        <span class="n">detector_settings</span> <span class="o">=</span> <span class="n">FibsemDetectorSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">detector_dict</span><span class="p">)</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="n">FibsemImageMetadata</span><span class="p">(</span>
            <span class="n">image_settings</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
            <span class="n">pixel_size</span><span class="o">=</span><span class="n">pixel_size</span><span class="p">,</span>
            <span class="n">microscope_state</span><span class="o">=</span><span class="n">microscope_state</span><span class="p">,</span>
            <span class="n">detector_settings</span><span class="o">=</span><span class="n">detector_settings</span><span class="p">,</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">FibsemUser</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">{})),</span>
            <span class="n">experiment</span> <span class="o">=</span> <span class="n">FibsemExperiment</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;experiment&quot;</span><span class="p">,</span> <span class="p">{})),</span>
            <span class="n">system</span> <span class="o">=</span> <span class="n">FibsemSystem</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="p">{})),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata</span>

    <span class="k">if</span> <span class="n">THERMO</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">image_settings_from_adorned</span><span class="p">(</span>
            <span class="n">image</span><span class="o">=</span><span class="n">AdornedImage</span><span class="p">,</span> <span class="n">beam_type</span><span class="p">:</span> <span class="n">BeamType</span> <span class="o">=</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ImageSettings</span><span class="p">:</span>

            <span class="kn">from</span> <span class="nn">fibsem.utils</span> <span class="kn">import</span> <span class="n">current_timestamp</span>

            <span class="n">image_settings</span> <span class="o">=</span> <span class="n">ImageSettings</span><span class="p">(</span>
                <span class="n">resolution</span><span class="o">=</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">height</span><span class="p">],</span>
                <span class="n">dwell_time</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">scan_settings</span><span class="o">.</span><span class="n">dwell_time</span><span class="p">,</span>
                <span class="n">hfw</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">binary_result</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="n">autocontrast</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">beam_type</span><span class="o">=</span><span class="n">beam_type</span><span class="p">,</span>
                <span class="n">gamma_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;path&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">current_timestamp</span><span class="p">(),</span>
                <span class="n">reduced_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">image_settings</span>

    <span class="k">def</span> <span class="nf">compare_image_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">:</span> <span class="n">ImageSettings</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compares image settings to the metadata image settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            image_settings (ImageSettings): Image settings to compare to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the image settings match the metadata image settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;resolution: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">dwell_time</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">dwell_time</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;dwell_time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">dwell_time</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">dwell_time</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">hfw</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">hfw</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;hfw: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">hfw</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">hfw</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">autocontrast</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">autocontrast</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;autocontrast: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">autocontrast</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">autocontrast</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span><span class="o">.</span><span class="n">value</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;beam_type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">gamma_enabled</span><span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">gamma_enabled</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;gamma: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">gamma_enabled</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">gamma_enabled</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">save</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;save: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save_path</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">save_path</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;save_path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save_path</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">label</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;label: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">reduced_area</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">reduced_area</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;reduced_area: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">reduced_area</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">reduced_area</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemImageMetadata.__from_dict__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts a dictionary to metadata.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ImageSettings&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a dictionary to metadata.&quot;&quot;&quot;</span>

    <span class="n">image_settings</span> <span class="o">=</span> <span class="n">ImageSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pixel_size&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pixel_size</span> <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pixel_size&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;microscope_state&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">microscope_state</span> <span class="o">=</span> <span class="n">MicroscopeState</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;microscope_state&quot;</span><span class="p">])</span>

    <span class="n">detector_dict</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;detector_settings&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
    <span class="n">detector_settings</span> <span class="o">=</span> <span class="n">FibsemDetectorSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">detector_dict</span><span class="p">)</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="n">FibsemImageMetadata</span><span class="p">(</span>
        <span class="n">image_settings</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
        <span class="n">pixel_size</span><span class="o">=</span><span class="n">pixel_size</span><span class="p">,</span>
        <span class="n">microscope_state</span><span class="o">=</span><span class="n">microscope_state</span><span class="p">,</span>
        <span class="n">detector_settings</span><span class="o">=</span><span class="n">detector_settings</span><span class="p">,</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">FibsemUser</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">{})),</span>
        <span class="n">experiment</span> <span class="o">=</span> <span class="n">FibsemExperiment</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;experiment&quot;</span><span class="p">,</span> <span class="p">{})),</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">FibsemSystem</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="p">{})),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemImageMetadata.__to_dict__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__to_dict__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts metadata to a dictionary.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dictionary</code></td>          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>self as a dictionary</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts metadata to a dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dictionary: self as a dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">settings_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span> <span class="c1"># TODO: gracefully depreceate this</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;pixel_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">microscope_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;microscope_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">microscope_state</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;detector_settings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector_settings</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
    <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
    <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;experiment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>
    <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">settings_dict</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemImageMetadata.compare_image_settings" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">compare_image_settings</span><span class="p">(</span><span class="n">image_settings</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Compares image settings to the metadata image settings.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>image_settings</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.ImageSettings" href="../started/#fibsem.structures.ImageSettings">ImageSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Image settings to compare to.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>bool</code></td>          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>True if the image settings match the metadata image settings.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compare_image_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_settings</span><span class="p">:</span> <span class="n">ImageSettings</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compares image settings to the metadata image settings.</span>

<span class="sd">    Args:</span>
<span class="sd">        image_settings (ImageSettings): Image settings to compare to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the image settings match the metadata image settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;resolution: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">dwell_time</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">dwell_time</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;dwell_time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">dwell_time</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">dwell_time</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">hfw</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">hfw</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;hfw: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">hfw</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">hfw</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">autocontrast</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">autocontrast</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;autocontrast: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">autocontrast</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">autocontrast</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span><span class="o">.</span><span class="n">value</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;beam_type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">beam_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">gamma_enabled</span><span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">gamma_enabled</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;gamma: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">gamma_enabled</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">gamma_enabled</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">save</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;save: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save_path</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">save_path</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;save_path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save_path</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">label</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;label: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">reduced_area</span> <span class="o">==</span> <span class="n">image_settings</span><span class="o">.</span><span class="n">reduced_area</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;reduced_area: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">reduced_area</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">image_settings</span><span class="o">.</span><span class="n">reduced_area</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemManipulatorPosition" class="doc doc-heading">
          <code>FibsemManipulatorPosition</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Data class for storing manipulator position data.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The X position of the manipulator in meters.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Y position of the manipulator in meters.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>z</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Z position of the manipulator in meters.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>r</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Rotation of the manipulator in radians.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Tilt of the manipulator in radians.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>coordinate_system</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The coordinate system used for the manipulator position.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Methods:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
          <tr>
            <td><code>__to_dict__</code></td>
            <td>
              <div class="doc-md-description">
                <p>Convert the manipulator position object to a dictionary.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>__from_dict__</code></td>
            <td>
              <div class="doc-md-description">
                <p>dict): Create a new manipulator position object from a dictionary.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>to_autoscript_position</code></td>
            <td>
              <div class="doc-md-description">
                <p>Convert the manipulator position to a ManipulatorPosition object that is compatible with Autoscript.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>from_autoscript_position</code></td>
            <td>
              <div class="doc-md-description">
                <p>ManipulatorPosition) -&gt; None: Create a new FibsemManipulatorPosition object from a ManipulatorPosition object that is compatible with Autoscript.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>to_tescan_position</code></td>
            <td>
              <div class="doc-md-description">
                <p>Convert the manipulator position to a format that is compatible with Tescan.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>from_tescan_position</code></td>
            <td>
              <div class="doc-md-description">
                <p>Create a new FibsemManipulatorPosition object from a Tescan-compatible manipulator position.</p>
              </div>
            </td>
          </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FibsemManipulatorPosition</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data class for storing manipulator position data.</span>

<span class="sd">Attributes:</span>
<span class="sd">    x (float): The X position of the manipulator in meters.</span>
<span class="sd">    y (float): The Y position of the manipulator in meters.</span>
<span class="sd">    z (float): The Z position of the manipulator in meters.</span>
<span class="sd">    r (float): The Rotation of the manipulator in radians.</span>
<span class="sd">    t (float): The Tilt of the manipulator in radians.</span>
<span class="sd">    coordinate_system (str): The coordinate system used for the manipulator position.</span>

<span class="sd">Methods:</span>
<span class="sd">    __to_dict__(): Convert the manipulator position object to a dictionary.</span>
<span class="sd">    __from_dict__(data: dict): Create a new manipulator position object from a dictionary.</span>
<span class="sd">    to_autoscript_position() -&gt; ManipulatorPosition: Convert the manipulator position to a ManipulatorPosition object that is compatible with Autoscript.</span>
<span class="sd">    from_autoscript_position(position: ManipulatorPosition) -&gt; None: Create a new FibsemManipulatorPosition object from a ManipulatorPosition object that is compatible with Autoscript.</span>
<span class="sd">    to_tescan_position(): Convert the manipulator position to a format that is compatible with Tescan.</span>
<span class="sd">    from_tescan_position(): Create a new FibsemManipulatorPosition object from a Tescan-compatible manipulator position.</span>

<span class="sd">&quot;&quot;&quot;</span>

    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">coordinate_system</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;RAW&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># attributes = [&quot;x&quot;,&quot;y&quot;,&quot;z&quot;,&quot;r&quot;,&quot;t&quot;]</span>
        <span class="c1"># for attribute in attributes:</span>
            <span class="c1"># output = getattr(self,attribute)</span>
            <span class="c1"># assert isinstance(output,float) or isinstance(output,int), f&quot;Unsupported type {type(output)} for coordinate {attribute}&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;unsupported type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">)</span><span class="si">}</span><span class="s2"> for coorindate system&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="ow">in</span> <span class="n">SUPPORTED_COORDINATE_SYSTEMS</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;coordinate system value </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="si">}</span><span class="s2"> is unsupported or invalid syntax. Must be RAW or SPECIMEN&quot;</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">position_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;coordinate_system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">position_dict</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemManipulatorPosition&quot;</span><span class="p">:</span>

        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="s2">&quot;t&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span>


        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">z</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
            <span class="n">r</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">],</span>
            <span class="n">t</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">],</span>
            <span class="n">coordinate_system</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;coordinate_system&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">THERMO</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">to_autoscript_position</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ManipulatorPosition</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="o">==</span> <span class="s2">&quot;RAW&quot;</span><span class="p">:</span>
                    <span class="n">coordinate_system</span> <span class="o">=</span> <span class="s2">&quot;Raw&quot;</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="o">==</span> <span class="s2">&quot;STAGE&quot;</span><span class="p">:</span>
                    <span class="n">coordinate_system</span> <span class="o">=</span> <span class="s2">&quot;Stage&quot;</span>
                <span class="k">return</span> <span class="n">ManipulatorPosition</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">z</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                    <span class="n">r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># TODO figure this out, do we need it for real micrscope or just simulator ? </span>
                    <span class="c1">#r=None,</span>
                    <span class="n">coordinate_system</span><span class="o">=</span><span class="n">coordinate_system</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="nd">@classmethod</span>
            <span class="k">def</span> <span class="nf">from_autoscript_position</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">ManipulatorPosition</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">position</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">z</span><span class="o">=</span><span class="n">position</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                    <span class="n">coordinate_system</span><span class="o">=</span><span class="n">position</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                <span class="p">)</span>


    <span class="k">if</span> <span class="n">TESCAN</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">to_tescan_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">pass</span>

            <span class="nd">@classmethod</span>
            <span class="k">def</span> <span class="nf">from_tescan_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span><span class="s1">&#39;FibsemManipulatorPosition&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;FibsemManipulatorPosition&#39;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">FibsemManipulatorPosition</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemMillingSettings" class="doc doc-heading">
          <code>FibsemMillingSettings</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>This class is used to store and retrieve settings for FIBSEM milling.</p>
<p>Attributes:
milling_current (float): The current used in the FIBSEM milling process. Default value is 20.0e-12 A.
spot_size (float): The size of the beam spot used in the FIBSEM milling process. Default value is 5.0e-8 m.
rate (float): The milling rate of the FIBSEM process. Default value is 3.0e-3 m^3/A/s.
dwell_time (float): The dwell time of the beam at each point during the FIBSEM milling process. Default value is 1.0e-6 s.
hfw (float): The high voltage field width used in the FIBSEM milling process. Default value is 150e-6 m.</p>
<p>Methods:
to_dict(): Converts the object attributes into a dictionary.
from_dict(settings: dict) -&gt; "FibsemMillingSettings": Creates a FibsemMillingSettings object from a dictionary of settings.</p>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FibsemMillingSettings</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to store and retrieve settings for FIBSEM milling.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    milling_current (float): The current used in the FIBSEM milling process. Default value is 20.0e-12 A.</span>
<span class="sd">    spot_size (float): The size of the beam spot used in the FIBSEM milling process. Default value is 5.0e-8 m.</span>
<span class="sd">    rate (float): The milling rate of the FIBSEM process. Default value is 3.0e-3 m^3/A/s.</span>
<span class="sd">    dwell_time (float): The dwell time of the beam at each point during the FIBSEM milling process. Default value is 1.0e-6 s.</span>
<span class="sd">    hfw (float): The high voltage field width used in the FIBSEM milling process. Default value is 150e-6 m.</span>

<span class="sd">    Methods:</span>
<span class="sd">    to_dict(): Converts the object attributes into a dictionary.</span>
<span class="sd">    from_dict(settings: dict) -&gt; &quot;FibsemMillingSettings&quot;: Creates a FibsemMillingSettings object from a dictionary of settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">milling_current</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20.0e-12</span>
    <span class="n">spot_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0e-8</span>
    <span class="n">rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0e-11</span> <span class="c1"># m3/A/s</span>
    <span class="n">dwell_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0e-6</span> <span class="c1"># s</span>
    <span class="n">hfw</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">150e-6</span>
    <span class="n">patterning_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Serial&quot;</span> 
    <span class="n">application_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Si&quot;</span>
    <span class="n">preset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;30 keV; UHR imaging&quot;</span>
    <span class="n">spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">milling_current</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)),</span> <span class="sa">f</span><span class="s2">&quot;invalid type for milling_current, must be int or float, currently </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">milling_current</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spot_size</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)),</span> <span class="sa">f</span><span class="s2">&quot;invalid type for spot_size, must be int or float, currently </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spot_size</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)),</span> <span class="sa">f</span><span class="s2">&quot;invalid type for rate, must be int or float, currently </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dwell_time</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)),</span> <span class="sa">f</span><span class="s2">&quot;invalid type for dwell_time, must be int or float, currently </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dwell_time</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hfw</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)),</span> <span class="sa">f</span><span class="s2">&quot;invalid type for hfw, must be int or float, currently </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hfw</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patterning_mode</span><span class="p">,</span><span class="nb">str</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;invalid type for value for patterning_mode, must be str, currently </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patterning_mode</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application_file</span><span class="p">,(</span><span class="nb">str</span><span class="p">)),</span> <span class="sa">f</span><span class="s2">&quot;invalid type for value for application_file, must be str, currently </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)),</span> <span class="sa">f</span><span class="s2">&quot;invalid type for value for spacing, must be int or float, currently </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># assert isinstance(self.preset,(str)), f&quot;invalid type for value for preset, must be str, currently {type(self.preset)}&quot;</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

        <span class="n">settings_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;milling_current&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">milling_current</span><span class="p">,</span>
            <span class="s2">&quot;spot_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">spot_size</span><span class="p">,</span>
            <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">,</span>
            <span class="s2">&quot;dwell_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwell_time</span><span class="p">,</span>
            <span class="s2">&quot;hfw&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hfw</span><span class="p">,</span>
            <span class="s2">&quot;patterning_mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">patterning_mode</span><span class="p">,</span>
            <span class="s2">&quot;application_file&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application_file</span><span class="p">,</span>
            <span class="s2">&quot;preset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">preset</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">settings_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemMillingSettings&quot;</span><span class="p">:</span>

        <span class="n">milling_settings</span> <span class="o">=</span> <span class="n">FibsemMillingSettings</span><span class="p">(</span>
            <span class="n">milling_current</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;milling_current&quot;</span><span class="p">,</span> <span class="mf">20.0e-12</span><span class="p">),</span>
            <span class="n">spot_size</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;spot_size&quot;</span><span class="p">,</span> <span class="mf">5.0e-8</span><span class="p">),</span>
            <span class="n">rate</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">,</span> <span class="mf">3.0e-11</span><span class="p">),</span>
            <span class="n">dwell_time</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dwell_time&quot;</span><span class="p">,</span> <span class="mf">1.0e-6</span><span class="p">),</span>
            <span class="n">hfw</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hfw&quot;</span><span class="p">,</span> <span class="mf">150e-6</span><span class="p">),</span>
            <span class="n">patterning_mode</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;patterning_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;Serial&quot;</span><span class="p">),</span>
            <span class="n">application_file</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;application_file&quot;</span><span class="p">,</span> <span class="s2">&quot;Si&quot;</span><span class="p">),</span>
            <span class="n">preset</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;preset&quot;</span><span class="p">,</span> <span class="s2">&quot;30 keV; UHR imaging&quot;</span><span class="p">),</span>
            <span class="n">spacing</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;spacing&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">milling_settings</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemPatternSettings" class="doc doc-heading">
          <code>FibsemPatternSettings</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>FibsemPatternSettings is used to store all of the possible settings related to each pattern that may be drawn.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pattern</code></td>
          <td>
                <code><span title="fibsem.structures.FibsemPattern">FibsemPattern</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Used to indicate which pattern is utilised. Currently either Rectangle or Line.</p>
            </div>
          </td>
          <td>
                <code><span title="fibsem.structures.FibsemPattern.Rectangle">Rectangle</span></code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If FibsemPattern.Rectangle
        width: float (m),
        height: float (m), 
        depth: float (m),
        rotation: float = 0.0 (m), 
        centre_x: float = 0.0 (m), 
        centre_y: float = 0.0 (m),
        passes: float = 1.0,</p>
<pre><code>If FibsemPattern.Line
    start_x: float (m), 
    start_y: float (m), 
    end_x: float (m), 
    end_y: float (m), 
    depth: float (m),

If FibsemPattern.Circle
    centre_x: float (m),
    centre_y: float (m),
    radius: float (m),
    depth: float (m),
    start_angle: float = 0.0 (degrees),
    end_angle: float = 360.0 (degrees),

if FibsemPattern.Bitmap
    centre_x: float (m),
    centre_y: float (m),
    width: float (m),
    height: float (m),
    rotation: float = 0.0 (degrees),
    depth: float (m),
    path: str = path to image,
</code></pre>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FibsemPatternSettings</span><span class="p">:</span>  <span class="c1"># FibsemBasePattern</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    FibsemPatternSettings is used to store all of the possible settings related to each pattern that may be drawn.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern (FibsemPattern): Used to indicate which pattern is utilised. Currently either Rectangle or Line.</span>
<span class="sd">        **kwargs: If FibsemPattern.Rectangle</span>
<span class="sd">                    width: float (m),</span>
<span class="sd">                    height: float (m), </span>
<span class="sd">                    depth: float (m),</span>
<span class="sd">                    rotation: float = 0.0 (m), </span>
<span class="sd">                    centre_x: float = 0.0 (m), </span>
<span class="sd">                    centre_y: float = 0.0 (m),</span>
<span class="sd">                    passes: float = 1.0,</span>

<span class="sd">                If FibsemPattern.Line</span>
<span class="sd">                    start_x: float (m), </span>
<span class="sd">                    start_y: float (m), </span>
<span class="sd">                    end_x: float (m), </span>
<span class="sd">                    end_y: float (m), </span>
<span class="sd">                    depth: float (m),</span>

<span class="sd">                If FibsemPattern.Circle</span>
<span class="sd">                    centre_x: float (m),</span>
<span class="sd">                    centre_y: float (m),</span>
<span class="sd">                    radius: float (m),</span>
<span class="sd">                    depth: float (m),</span>
<span class="sd">                    start_angle: float = 0.0 (degrees),</span>
<span class="sd">                    end_angle: float = 360.0 (degrees),</span>

<span class="sd">                if FibsemPattern.Bitmap</span>
<span class="sd">                    centre_x: float (m),</span>
<span class="sd">                    centre_y: float (m),</span>
<span class="sd">                    width: float (m),</span>
<span class="sd">                    height: float (m),</span>
<span class="sd">                    rotation: float = 0.0 (degrees),</span>
<span class="sd">                    depth: float (m),</span>
<span class="sd">                    path: str = path to image,</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">FibsemPattern</span> <span class="o">=</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="k">if</span> <span class="n">pattern</span> <span class="o">==</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;rotation&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centre_x</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;centre_x&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;centre_x&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centre_y</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;centre_y&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;centre_y&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;scan_direction&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s2">&quot;TopToBottom&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;cleaning_cross_section&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">passes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;passes&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;passes&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">pattern</span> <span class="o">==</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Line</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_x</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;start_x&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_y</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;start_y&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_x</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;end_x&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_y</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;end_y&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;rotation&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;scan_direction&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s2">&quot;TopToBottom&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;cleaning_cross_section&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">pattern</span> <span class="o">==</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Circle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centre_x</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;centre_x&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centre_y</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;centre_y&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_angle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;start_angle&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;start_angle&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_angle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;end_angle&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;end_angle&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">360.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;rotation&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;scan_direction&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s2">&quot;TopToBottom&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;cleaning_cross_section&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">pattern</span> <span class="o">==</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centre_x</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;centre_x&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centre_y</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;centre_y&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;rotation&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;scan_direction&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s2">&quot;TopToBottom&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;cleaning_cross_section&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">pattern</span> <span class="o">==</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Annulus</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centre_x</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;centre_x&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centre_y</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;centre_y&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;thickness&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_angle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;start_angle&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;start_angle&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_angle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;end_angle&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;end_angle&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="mf">360.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;scan_direction&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s2">&quot;TopToBottom&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;cleaning_cross_section&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">==</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;FibsemPatternSettings(pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">, width=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="si">}</span><span class="s2">, height=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s2">, depth=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s2">, rotation=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="si">}</span><span class="s2">, centre_x=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">centre_x</span><span class="si">}</span><span class="s2">, centre_y=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">centre_y</span><span class="si">}</span><span class="s2">, scan_direction=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="si">}</span><span class="s2">, cleaning_cross_section=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="si">}</span><span class="s2">, passes=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">passes</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">==</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Line</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;FibsemPatternSettings(pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">, start_x=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_x</span><span class="si">}</span><span class="s2">, start_y=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_y</span><span class="si">}</span><span class="s2">, end_x=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_x</span><span class="si">}</span><span class="s2">, end_y=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_y</span><span class="si">}</span><span class="s2">, depth=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s2">, rotation=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="si">}</span><span class="s2">, scan_direction=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="si">}</span><span class="s2">, cleaning_cross_section=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Circle</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;FibsemPatternSettings(pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">, centre_x=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">centre_x</span><span class="si">}</span><span class="s2">, centre_y=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">centre_y</span><span class="si">}</span><span class="s2">, radius=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="si">}</span><span class="s2">, depth=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s2">, start_angle=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_angle</span><span class="si">}</span><span class="s2">, end_angle=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_angle</span><span class="si">}</span><span class="s2">, rotation=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="si">}</span><span class="s2">, scan_direction=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="si">}</span><span class="s2">, cleaning_cross_section=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;FibsemPatternSettings(pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">, centre_x=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">centre_x</span><span class="si">}</span><span class="s2">, centre_y=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">centre_y</span><span class="si">}</span><span class="s2">, width=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="si">}</span><span class="s2">, height=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s2">, depth=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s2">, path=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Annulus</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;FibsemPatternSettings(pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s1">, centre_x=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">centre_x</span><span class="si">}</span><span class="s1">, centre_y=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">centre_y</span><span class="si">}</span><span class="s1">, radius=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="si">}</span><span class="s1">, thickness=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="si">}</span><span class="s1">, depth=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s1">, start_angle=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_angle</span><span class="si">}</span><span class="s1">, end_angle=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_angle</span><span class="si">}</span><span class="s1">, scan_direction=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="si">}</span><span class="s1">, cleaning_cross_section=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="si">}</span><span class="s1">)&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">state_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemPatternSettings&quot;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Rectangle&quot;</span><span class="p">:</span>
            <span class="n">passes</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;passes&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">passes</span> <span class="o">=</span> <span class="n">passes</span> <span class="k">if</span> <span class="n">passes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="n">FibsemPatternSettings</span><span class="p">(</span>
                <span class="n">pattern</span><span class="o">=</span><span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                <span class="n">height</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                <span class="n">depth</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">],</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">],</span>
                <span class="n">centre_x</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;centre_x&quot;</span><span class="p">],</span>
                <span class="n">centre_y</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;centre_y&quot;</span><span class="p">],</span>
                <span class="n">scan_direction</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">],</span>
                <span class="n">cleaning_cross_section</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">],</span>
                <span class="n">passes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">passes</span><span class="p">),</span> 
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FibsemPatternSettings</span><span class="p">(</span>
                <span class="n">pattern</span><span class="o">=</span><span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Line</span><span class="p">,</span>
                <span class="n">start_x</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;start_x&quot;</span><span class="p">],</span>
                <span class="n">start_y</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;start_y&quot;</span><span class="p">],</span>
                <span class="n">end_x</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;end_x&quot;</span><span class="p">],</span>
                <span class="n">end_y</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;end_y&quot;</span><span class="p">],</span>
                <span class="n">depth</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">],</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rotation&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="n">scan_direction</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">],</span>
                <span class="n">cleaning_cross_section</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Circle&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FibsemPatternSettings</span><span class="p">(</span>
                <span class="n">pattern</span><span class="o">=</span><span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Circle</span><span class="p">,</span>
                <span class="n">centre_x</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;centre_x&quot;</span><span class="p">],</span>
                <span class="n">centre_y</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;centre_y&quot;</span><span class="p">],</span>
                <span class="n">radius</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">],</span>
                <span class="n">depth</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">],</span>
                <span class="n">start_angle</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;start_angle&quot;</span><span class="p">],</span>
                <span class="n">end_angle</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;end_angle&quot;</span><span class="p">],</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">],</span>
                <span class="n">scan_direction</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">],</span>
                <span class="n">cleaning_cross_section</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BitmapPattern&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FibsemPatternSettings</span><span class="p">(</span>
                <span class="n">pattern</span><span class="o">=</span><span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">,</span>
                <span class="n">centre_x</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;centre_x&quot;</span><span class="p">],</span>
                <span class="n">centre_y</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;centre_y&quot;</span><span class="p">],</span>
                <span class="n">width</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                <span class="n">height</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                <span class="n">depth</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">],</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">],</span>
                <span class="n">path</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Annulus&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FibsemPatternSettings</span><span class="p">(</span>
                <span class="n">pattern</span><span class="o">=</span><span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Annulus</span><span class="p">,</span>
                <span class="n">centre_x</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;centre_x&quot;</span><span class="p">],</span>
                <span class="n">centre_y</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;centre_y&quot;</span><span class="p">],</span>
                <span class="n">radius</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">],</span>
                <span class="n">thickness</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;thickness&quot;</span><span class="p">],</span>
                <span class="n">depth</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">],</span>
                <span class="n">start_angle</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;start_angle&quot;</span><span class="p">],</span>
                <span class="n">end_angle</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;end_angle&quot;</span><span class="p">],</span>
                <span class="n">scan_direction</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;scan_direction&quot;</span><span class="p">],</span>
                <span class="n">cleaning_cross_section</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">],</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">==</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;Rectangle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span>
                <span class="s2">&quot;centre_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre_x</span><span class="p">,</span>
                <span class="s2">&quot;centre_y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre_y</span><span class="p">,</span>
                <span class="s2">&quot;scan_direction&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="p">,</span>
                <span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="p">,</span>
                <span class="s2">&quot;passes&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">passes</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">==</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Line</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;Line&quot;</span><span class="p">,</span>
                <span class="s2">&quot;start_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_x</span><span class="p">,</span>
                <span class="s2">&quot;start_y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_y</span><span class="p">,</span>
                <span class="s2">&quot;end_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_x</span><span class="p">,</span>
                <span class="s2">&quot;end_y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_y</span><span class="p">,</span>
                <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span>
                <span class="s2">&quot;scan_direction&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="p">,</span>
                <span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">==</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Circle</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;Circle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;centre_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre_x</span><span class="p">,</span>
                <span class="s2">&quot;centre_y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre_y</span><span class="p">,</span>
                <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span>
                <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="s2">&quot;start_angle&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_angle</span><span class="p">,</span>
                <span class="s2">&quot;end_angle&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_angle</span><span class="p">,</span>
                <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span>
                <span class="s2">&quot;scan_direction&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="p">,</span>
                <span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">==</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;BitmapPattern&quot;</span><span class="p">,</span>
                <span class="s2">&quot;centre_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre_x</span><span class="p">,</span>
                <span class="s2">&quot;centre_y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre_y</span><span class="p">,</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span>
                <span class="s2">&quot;scan_direction&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="p">,</span>
                <span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="p">,</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">==</span> <span class="n">FibsemPattern</span><span class="o">.</span><span class="n">Annulus</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;Annulus&quot;</span><span class="p">,</span>
                <span class="s2">&quot;centre_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre_x</span><span class="p">,</span>
                <span class="s2">&quot;centre_y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre_y</span><span class="p">,</span>
                <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span>
                <span class="s2">&quot;thickness&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="p">,</span>
                <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="s2">&quot;start_angle&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_angle</span><span class="p">,</span>
                <span class="s2">&quot;end_angle&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_angle</span><span class="p">,</span>
                <span class="s2">&quot;scan_direction&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_direction</span><span class="p">,</span>
                <span class="s2">&quot;cleaning_cross_section&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaning_cross_section</span><span class="p">,</span>
            <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemRectangle" class="doc doc-heading">
          <code>FibsemRectangle</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Universal Rectangle class used for ReducedArea</p>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FibsemRectangle</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Universal Rectangle class used for ReducedArea&quot;&quot;&quot;</span>

    <span class="n">left</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">top</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="nb">int</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="si">}</span><span class="s2"> is unsupported for left, must be int or floar&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="nb">int</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span><span class="si">}</span><span class="s2"> is unsupported for top, must be int or floar&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span><span class="nb">int</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="si">}</span><span class="s2"> is unsupported for width, must be int or floar&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span><span class="nb">int</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="si">}</span><span class="s2"> is unsupported for height, must be int or floar&quot;</span>

    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemRectangle&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="s2">&quot;top&quot;</span><span class="p">,</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="n">point</span><span class="p">]</span>

            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">FibsemRectangle</span><span class="p">(</span>
            <span class="n">left</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">],</span>
            <span class="n">top</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">],</span>
            <span class="n">width</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
            <span class="n">height</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">),</span>
            <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">),</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">),</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="n">THERMO</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">__to_FEI__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rectangle</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Rectangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">__from_FEI__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rect</span><span class="p">:</span> <span class="n">Rectangle</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemRectangle&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">rect</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemStagePosition" class="doc doc-heading">
          <code>FibsemStagePosition</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Data class for storing stage position data.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The X position of the stage in meters.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Y position of the stage in meters.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>z</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Z position of the stage in meters.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>r</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Rotation of the stage in radians.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Tilt of the stage in radians.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>coordinate_system</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The coordinate system used for the stage position.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Methods:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
          <tr>
            <td><code>__to_dict__</code></td>
            <td>
              <div class="doc-md-description">
                <p>Convert the stage position object to a dictionary.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>__from_dict__</code></td>
            <td>
              <div class="doc-md-description">
                <p>dict): Create a new stage position object from a dictionary.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>to_autoscript_position</code></td>
            <td>
              <div class="doc-md-description">
                <p>float = 0.0) -&gt; StagePosition: Convert the stage position to a StagePosition object that is compatible with Autoscript.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>from_autoscript_position</code></td>
            <td>
              <div class="doc-md-description">
                <p>StagePosition, stage_tilt: float = 0.0) -&gt; None: Create a new FibsemStagePosition object from a StagePosition object that is compatible with Autoscript.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>to_tescan_position</code></td>
            <td>
              <div class="doc-md-description">
                <p>float = 0.0): Convert the stage position to a format that is compatible with Tescan.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>from_tescan_position</code></td>
            <td>
              <div class="doc-md-description">
                <p>Create a new FibsemStagePosition object from a Tescan-compatible stage position.</p>
              </div>
            </td>
          </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FibsemStagePosition</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data class for storing stage position data.</span>

<span class="sd">Attributes:</span>
<span class="sd">    x (float): The X position of the stage in meters.</span>
<span class="sd">    y (float): The Y position of the stage in meters.</span>
<span class="sd">    z (float): The Z position of the stage in meters.</span>
<span class="sd">    r (float): The Rotation of the stage in radians.</span>
<span class="sd">    t (float): The Tilt of the stage in radians.</span>
<span class="sd">    coordinate_system (str): The coordinate system used for the stage position.</span>

<span class="sd">Methods:</span>
<span class="sd">    __to_dict__(): Convert the stage position object to a dictionary.</span>
<span class="sd">    __from_dict__(data: dict): Create a new stage position object from a dictionary.</span>
<span class="sd">    to_autoscript_position(stage_tilt: float = 0.0) -&gt; StagePosition: Convert the stage position to a StagePosition object that is compatible with Autoscript.</span>
<span class="sd">    from_autoscript_position(position: StagePosition, stage_tilt: float = 0.0) -&gt; None: Create a new FibsemStagePosition object from a StagePosition object that is compatible with Autoscript.</span>
<span class="sd">    to_tescan_position(stage_tilt: float = 0.0): Convert the stage position to a format that is compatible with Tescan.</span>
<span class="sd">    from_tescan_position(): Create a new FibsemStagePosition object from a Tescan-compatible stage position.</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">coordinate_system</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># def __post_init__(self):</span>

    <span class="c1">#     coordinates = [&quot;x&quot;,&quot;y&quot;,&quot;z&quot;,&quot;r&quot;,&quot;t&quot;]</span>
    <span class="c1">#     for coordinate in coordinates:</span>
    <span class="c1">#         attribute = getattr(self,coordinate)</span>
    <span class="c1">#         assert isinstance(attribute,float) or isinstance(attribute,int)</span>

    <span class="c1">#     assert isinstance(self.coordinate_system,str) or self.coordinate_system is None</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">position_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">position_dict</span><span class="p">[</span><span class="s2">&quot;coordinate_system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span>

        <span class="k">return</span> <span class="n">position_dict</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemStagePosition&quot;</span><span class="p">:</span>

        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="s2">&quot;t&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span>


        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
            <span class="n">z</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
            <span class="n">r</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">],</span>
            <span class="n">t</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">],</span>
            <span class="n">coordinate_system</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;coordinate_system&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">THERMO</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">to_autoscript_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage_tilt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StagePosition</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">StagePosition</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="c1">#/ np.cos(stage_tilt),</span>
                <span class="n">z</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="c1">#/ np.cos(stage_tilt),</span>
                <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
                <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
                <span class="n">coordinate_system</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">from_autoscript_position</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">StagePosition</span><span class="p">,</span> <span class="n">stage_tilt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">position</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="c1"># * np.cos(stage_tilt),</span>
                <span class="n">z</span><span class="o">=</span><span class="n">position</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="c1"># * np.cos(stage_tilt),</span>
                <span class="n">r</span><span class="o">=</span><span class="n">position</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
                <span class="n">t</span><span class="o">=</span><span class="n">position</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
                <span class="n">coordinate_system</span><span class="o">=</span><span class="n">position</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">TESCAN</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">to_tescan_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage_tilt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="c1">#/ np.cos(stage_tilt),</span>

        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">from_tescan_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage_tilt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="c1">#* np.cos(stage_tilt)</span>


    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span><span class="s1">&#39;FibsemStagePosition&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;FibsemStagePosition&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">FibsemStagePosition</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span> <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">r</span> <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">t</span> <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
            <span class="n">coordinate_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span><span class="s1">&#39;FibsemStagePosition&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;FibsemStagePosition&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">FibsemStagePosition</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
            <span class="n">coordinate_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_scale_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">precision</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;x:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">scale</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">, y:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">scale</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">, z:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">*</span><span class="n">scale</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemState" class="doc doc-heading">
          <code>FibsemState</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>FibsemState data class that represents the current state of FIBSEM system </p>
<p>Attributes:
stage (FibsemStage): The current stage of the autoliftout workflow, as a <code>FibsemStage</code> enum member.
microscope_state (MicroscopeState): The current state of the microscope, as a <code>MicroscopeState</code> object.
start_timestamp (float): The timestamp when the autoliftout workflow began, as a Unix timestamp.
end_timestamp (float): The timestamp when the autoliftout workflow ended, as a Unix timestamp.</p>
<p>Methods:
<strong>to_dict</strong>(): Serializes the <code>FibsemState</code> object to a dictionary.
<strong>from_dict</strong>(state_dict: dict) -&gt; FibsemState: Deserializes a dictionary to a <code>FibsemState</code> object.</p>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FibsemState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FibsemState data class that represents the current state of FIBSEM system </span>

<span class="sd">    Attributes:</span>
<span class="sd">    stage (FibsemStage): The current stage of the autoliftout workflow, as a `FibsemStage` enum member.</span>
<span class="sd">    microscope_state (MicroscopeState): The current state of the microscope, as a `MicroscopeState` object.</span>
<span class="sd">    start_timestamp (float): The timestamp when the autoliftout workflow began, as a Unix timestamp.</span>
<span class="sd">    end_timestamp (float): The timestamp when the autoliftout workflow ended, as a Unix timestamp.</span>

<span class="sd">    Methods:</span>
<span class="sd">    __to_dict__(): Serializes the `FibsemState` object to a dictionary.</span>
<span class="sd">    __from_dict__(state_dict: dict) -&gt; FibsemState: Deserializes a dictionary to a `FibsemState` object.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stage</span><span class="p">:</span> <span class="n">FibsemStage</span> <span class="o">=</span> <span class="n">FibsemStage</span><span class="o">.</span><span class="n">Base</span>
    <span class="n">microscope_state</span><span class="p">:</span> <span class="n">MicroscopeState</span> <span class="o">=</span> <span class="n">MicroscopeState</span><span class="p">()</span>
    <span class="n">start_timestamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">end_timestamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

        <span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;microscope_state&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">microscope_state</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">(),</span>
            <span class="s2">&quot;start_timestamp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_timestamp</span><span class="p">,</span>
            <span class="s2">&quot;end_timestamp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_timestamp</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">state_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">state_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemState&quot;</span><span class="p">:</span>

        <span class="n">autoliftout_state</span> <span class="o">=</span> <span class="n">FibsemState</span><span class="p">(</span>
            <span class="n">stage</span><span class="o">=</span><span class="n">FibsemStage</span><span class="p">[</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">]],</span>
            <span class="n">microscope_state</span><span class="o">=</span><span class="n">MicroscopeState</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span>
                <span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;microscope_state&quot;</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">start_timestamp</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;start_timestamp&quot;</span><span class="p">],</span>
            <span class="n">end_timestamp</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;end_timestamp&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">autoliftout_state</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemSystem" class="doc doc-heading">
          <code>FibsemSystem</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FibsemSystem</span><span class="p">:</span>
    <span class="n">manufacturer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">serial_number</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">software_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">hardware_settings</span><span class="p">:</span> <span class="n">FibsemHardware</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts to a dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;manufacturer&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">manufacturer</span><span class="p">,</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_number</span><span class="p">,</span>
            <span class="s2">&quot;software_version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">software_version</span><span class="p">,</span>
            <span class="s2">&quot;hardware_settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware_settings</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemSystem&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts from a dictionary.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;hardware_settings&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
            <span class="n">hardware</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hardware</span> <span class="o">=</span> <span class="n">FibsemHardware</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;hardware_settings&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">FibsemSystem</span><span class="p">(</span>
            <span class="n">manufacturer</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="n">serial_number</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;serial_number&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="n">software_version</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;software_version&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="n">hardware_settings</span> <span class="o">=</span> <span class="n">hardware</span><span class="p">,</span>

        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemSystem.__from_dict__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts from a dictionary.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemSystem&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts from a dictionary.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;hardware_settings&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
        <span class="n">hardware</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hardware</span> <span class="o">=</span> <span class="n">FibsemHardware</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;hardware_settings&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">FibsemSystem</span><span class="p">(</span>
        <span class="n">manufacturer</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="n">serial_number</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;serial_number&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="n">software_version</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;software_version&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="n">hardware_settings</span> <span class="o">=</span> <span class="n">hardware</span><span class="p">,</span>

    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemSystem.__to_dict__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__to_dict__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts to a dictionary.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts to a dictionary.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;manufacturer&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">manufacturer</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
        <span class="s2">&quot;serial_number&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_number</span><span class="p">,</span>
        <span class="s2">&quot;software_version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">software_version</span><span class="p">,</span>
        <span class="s2">&quot;hardware_settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware_settings</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.FibsemUser" class="doc doc-heading">
          <code>FibsemUser</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FibsemUser</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">organization</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">computer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts to a dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;organization&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="p">,</span>
            <span class="s2">&quot;computer&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">computer</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemUser&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts from a dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">FibsemUser</span><span class="p">(</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="n">organization</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
            <span class="n">computer</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;computer&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemUser.__from_dict__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts from a dictionary.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FibsemUser&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts from a dictionary.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">FibsemUser</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="n">organization</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
        <span class="n">computer</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;computer&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.FibsemUser.__to_dict__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__to_dict__</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts to a dictionary.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts to a dictionary.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
        <span class="s2">&quot;organization&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="p">,</span>
        <span class="s2">&quot;computer&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">computer</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.ImageSettings" class="doc doc-heading">
          <code>ImageSettings</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>A data class representing the settings for an image acquisition.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>resolution</code></td>
          <td>
                <code>list of int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The resolution of the acquired image in pixels, [x, y].</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>dwell_time</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The time spent per pixel during image acquisition, in seconds.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>hfw</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The horizontal field width of the acquired image, in microns.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>autocontrast</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether or not to apply automatic contrast enhancement to the acquired image.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>beam_type</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.BeamType" href="#fibsem.structures.BeamType">BeamType</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of beam to use for image acquisition.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether or not to save the acquired image to disk.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>label</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The label to use when saving the acquired image.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>gamma_enabled</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether or not to apply gamma correction to the acquired image.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the directory where the acquired image should be saved.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>reduced_area</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemRectangle" href="#fibsem.structures.FibsemRectangle">FibsemRectangle</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The rectangular region of interest within the acquired image, if any.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Methods:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
          <tr>
            <td><code>__from_dict__</code></td>
            <td>
              <div class="doc-md-description">
                <p>dict) -&gt; ImageSettings:
Converts a dictionary of image settings to an ImageSettings object.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>__to_dict__</code></td>
            <td>
              <div class="doc-md-description">
                <p>Converts the ImageSettings object to a dictionary of image settings.</p>
              </div>
            </td>
          </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ImageSettings</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A data class representing the settings for an image acquisition.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        resolution (list of int): The resolution of the acquired image in pixels, [x, y].</span>
<span class="sd">        dwell_time (float): The time spent per pixel during image acquisition, in seconds.</span>
<span class="sd">        hfw (float): The horizontal field width of the acquired image, in microns.</span>
<span class="sd">        autocontrast (bool): Whether or not to apply automatic contrast enhancement to the acquired image.</span>
<span class="sd">        beam_type (BeamType): The type of beam to use for image acquisition.</span>
<span class="sd">        save (bool): Whether or not to save the acquired image to disk.</span>
<span class="sd">        label (str): The label to use when saving the acquired image.</span>
<span class="sd">        gamma_enabled (bool): Whether or not to apply gamma correction to the acquired image.</span>
<span class="sd">        save_path (Path): The path to the directory where the acquired image should be saved.</span>
<span class="sd">        reduced_area (FibsemRectangle): The rectangular region of interest within the acquired image, if any.</span>

<span class="sd">    Methods:</span>
<span class="sd">        __from_dict__(settings: dict) -&gt; ImageSettings:</span>
<span class="sd">            Converts a dictionary of image settings to an ImageSettings object.</span>
<span class="sd">        __to_dict__() -&gt; dict:</span>
<span class="sd">            Converts the ImageSettings object to a dictionary of image settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">resolution</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">dwell_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">hfw</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">autocontrast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">beam_type</span><span class="p">:</span> <span class="n">BeamType</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">gamma_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">reduced_area</span><span class="p">:</span> <span class="n">FibsemRectangle</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">line_integration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># (int32) 2 - 255</span>
    <span class="n">scan_interlacing</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># (int32) 2 - 8</span>
    <span class="n">frame_integration</span><span class="p">:</span> <span class="nb">int</span>  <span class="o">=</span> <span class="kc">None</span> <span class="c1"># (int32) 2 - 512</span>
    <span class="n">drift_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># (bool) # requires frame_integration &gt; 1</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;resolution must be a list, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dwell_time</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwell_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;dwell time must be of type float, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dwell_time</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hfw</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hfw</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">hfw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;hfw must be int or float, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hfw</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autocontrast</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocontrast</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;autocontrast setting must be bool, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autocontrast</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="p">,</span><span class="n">BeamType</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;beam type must be a BeamType object, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">,</span><span class="nb">bool</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;save option must be a bool, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;label must b str, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma_enabled</span><span class="p">,</span><span class="nb">bool</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_enabled</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;gamma enabled setting must be bool, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma_enabled</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,(</span><span class="n">Path</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;save path must be Path or str, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reduced_area</span><span class="p">,</span><span class="n">FibsemRectangle</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduced_area</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;reduced area must be a fibsemRectangle object, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reduced_area</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ImageSettings&quot;</span><span class="p">:</span>


        <span class="k">if</span> <span class="s2">&quot;reduced_area&quot;</span> <span class="ow">in</span> <span class="n">settings</span> <span class="ow">and</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;reduced_area&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reduced_area</span> <span class="o">=</span> <span class="n">FibsemRectangle</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;reduced_area&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reduced_area</span> <span class="o">=</span> <span class="kc">None</span>


        <span class="n">image_settings</span> <span class="o">=</span> <span class="n">ImageSettings</span><span class="p">(</span>
            <span class="n">resolution</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resolution&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1536</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)),</span>
            <span class="n">dwell_time</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dwell_time&quot;</span><span class="p">,</span> <span class="mf">1.0e-6</span><span class="p">),</span>
            <span class="n">hfw</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hfw&quot;</span><span class="p">,</span> <span class="mf">150e-6</span><span class="p">),</span>
            <span class="n">autocontrast</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;autocontrast&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="p">[</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;beam_type&quot;</span><span class="p">,</span> <span class="s2">&quot;Electron&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()],</span>
            <span class="n">gamma_enabled</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gamma_enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">save</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;save_path&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()),</span>
            <span class="n">label</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;default_image&quot;</span><span class="p">),</span>
            <span class="n">reduced_area</span><span class="o">=</span><span class="n">reduced_area</span><span class="p">,</span>
            <span class="n">line_integration</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line_integration&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">scan_interlacing</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scan_interlacing&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">frame_integration</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frame_integration&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">drift_correction</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;drift_correction&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">image_settings</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

        <span class="n">settings_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;beam_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;resolution&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;dwell_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwell_time</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dwell_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;hfw&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hfw</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hfw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;autocontrast&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocontrast</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autocontrast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;gamma_enabled&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_enabled</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_enabled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;save&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;save_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;reduced_area&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduced_area</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
                <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduced_area</span><span class="o">.</span><span class="n">top</span><span class="p">,</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduced_area</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduced_area</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduced_area</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;line_integration&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_integration</span><span class="p">,</span>
            <span class="s2">&quot;scan_interlacing&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_interlacing</span><span class="p">,</span>
            <span class="s2">&quot;frame_integration&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_integration</span><span class="p">,</span>
            <span class="s2">&quot;drift_correction&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_correction</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">settings_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromFibsemImage</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="s1">&#39;FibsemImage&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ImageSettings&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the image settings for a FibsemImage object.</span>

<span class="sd">        Args:</span>
<span class="sd">            image (FibsemImage): The FibsemImage object to get the image settings from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ImageSettings: The image settings for the given FibsemImage object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">fibsem</span> <span class="kn">import</span> <span class="n">utils</span>
        <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
        <span class="n">image_settings</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_settings</span><span class="p">)</span>
        <span class="n">image_settings</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">current_timestamp</span><span class="p">()</span>
        <span class="n">image_settings</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">image_settings</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.ImageSettings.fromFibsemImage" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fromFibsemImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns the image settings for a FibsemImage object.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>image</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemImage" href="#fibsem.structures.FibsemImage">FibsemImage</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The FibsemImage object to get the image settings from.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ImageSettings</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.ImageSettings" href="../started/#fibsem.structures.ImageSettings">ImageSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The image settings for the given FibsemImage object.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">fromFibsemImage</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="s1">&#39;FibsemImage&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ImageSettings&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the image settings for a FibsemImage object.</span>

<span class="sd">    Args:</span>
<span class="sd">        image (FibsemImage): The FibsemImage object to get the image settings from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ImageSettings: The image settings for the given FibsemImage object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">fibsem</span> <span class="kn">import</span> <span class="n">utils</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="n">image_settings</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_settings</span><span class="p">)</span>
    <span class="n">image_settings</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">current_timestamp</span><span class="p">()</span>
    <span class="n">image_settings</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">image_settings</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.MicroscopeSettings" class="doc doc-heading">
          <code>MicroscopeSettings</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>A data class representing the settings for a microscope system.</p>



  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>system</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.SystemSettings" href="#fibsem.structures.SystemSettings">SystemSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An instance of the <code>SystemSettings</code> class that holds the system settings.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>image</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.ImageSettings" href="../started/#fibsem.structures.ImageSettings">ImageSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An instance of the <code>ImageSettings</code> class that holds the image settings.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>protocol</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dictionary representing the protocol settings. Defaults to None.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>milling</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.FibsemMillingSettings" href="#fibsem.structures.FibsemMillingSettings">FibsemMillingSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An instance of the <code>FibsemMillingSettings</code> class that holds the fibsem milling settings. Defaults to None.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Methods:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
          <tr>
            <td><code>__to_dict__</code></td>
            <td>
              <div class="doc-md-description">
                <p>Returns a dictionary representation of the <code>MicroscopeSettings</code> object.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td><code>__from_dict__</code></td>
            <td>
              <div class="doc-md-description">
                <p>dict, protocol: dict = None) -&gt; "MicroscopeSettings": Returns an instance of the <code>MicroscopeSettings</code> class from a dictionary.</p>
              </div>
            </td>
          </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">MicroscopeSettings</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A data class representing the settings for a microscope system.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        system (SystemSettings): An instance of the `SystemSettings` class that holds the system settings.</span>
<span class="sd">        image (ImageSettings): An instance of the `ImageSettings` class that holds the image settings.</span>
<span class="sd">        protocol (dict, optional): A dictionary representing the protocol settings. Defaults to None.</span>
<span class="sd">        milling (FibsemMillingSettings, optional): An instance of the `FibsemMillingSettings` class that holds the fibsem milling settings. Defaults to None.</span>

<span class="sd">    Methods:</span>
<span class="sd">        __to_dict__(): Returns a dictionary representation of the `MicroscopeSettings` object.</span>
<span class="sd">        __from_dict__(settings: dict, protocol: dict = None) -&gt; &quot;MicroscopeSettings&quot;: Returns an instance of the `MicroscopeSettings` class from a dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">system</span><span class="p">:</span> <span class="n">SystemSettings</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">ImageSettings</span>
    <span class="n">protocol</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">milling</span><span class="p">:</span> <span class="n">FibsemMillingSettings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">hardware</span><span class="p">:</span> <span class="n">FibsemHardware</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

        <span class="n">settings_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">(),</span>
            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">(),</span>
            <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span>
            <span class="s2">&quot;milling&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">milling</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">(),</span>
            <span class="s2">&quot;hardware&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">(),</span>

        <span class="p">}</span>

        <span class="k">return</span> <span class="n">settings_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">protocol</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hardware</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MicroscopeSettings&quot;</span><span class="p">:</span>

        <span class="k">return</span> <span class="n">MicroscopeSettings</span><span class="p">(</span>
            <span class="n">system</span><span class="o">=</span><span class="n">SystemSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">]),</span>
            <span class="n">image</span><span class="o">=</span><span class="n">ImageSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]),</span>
            <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span> <span class="k">if</span> <span class="n">protocol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;protocol&quot;</span><span class="p">],</span>
            <span class="n">milling</span><span class="o">=</span><span class="n">FibsemMillingSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;milling&quot;</span><span class="p">]),</span>
            <span class="n">hardware</span><span class="o">=</span><span class="n">FibsemHardware</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">hardware</span><span class="p">)</span> <span class="k">if</span> <span class="n">hardware</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">FibsemHardware</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;hardware&quot;</span><span class="p">]),</span>

        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.MicroscopeState" class="doc doc-heading">
          <code>MicroscopeState</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Data Class representing the state of a microscope with various parameters.</p>
<p>Attributes:</p>
<pre><code>timestamp (float): A float representing the timestamp at which the state of the microscope was recorded. Defaults to the timestamp of the current datetime.
absolute_position (FibsemStagePosition): An instance of FibsemStagePosition representing the current absolute position of the stage. Defaults to an empty instance of FibsemStagePosition.
eb_settings (BeamSettings): An instance of BeamSettings representing the electron beam settings. Defaults to an instance of BeamSettings with beam_type set to BeamType.ELECTRON.
ib_settings (BeamSettings): An instance of BeamSettings representing the ion beam settings. Defaults to an instance of BeamSettings with beam_type set to BeamType.ION.
</code></pre>
<p>Methods:</p>
<pre><code>to_dict(self) -&gt; dict: Converts the current state of the Microscope to a dictionary and returns it.
from_dict(state_dict: dict) -&gt; "MicroscopeState": Returns a new instance of MicroscopeState with attributes created from the passed dictionary.
</code></pre>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">MicroscopeState</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data Class representing the state of a microscope with various parameters.</span>

<span class="sd">    Attributes:</span>

<span class="sd">        timestamp (float): A float representing the timestamp at which the state of the microscope was recorded. Defaults to the timestamp of the current datetime.</span>
<span class="sd">        absolute_position (FibsemStagePosition): An instance of FibsemStagePosition representing the current absolute position of the stage. Defaults to an empty instance of FibsemStagePosition.</span>
<span class="sd">        eb_settings (BeamSettings): An instance of BeamSettings representing the electron beam settings. Defaults to an instance of BeamSettings with beam_type set to BeamType.ELECTRON.</span>
<span class="sd">        ib_settings (BeamSettings): An instance of BeamSettings representing the ion beam settings. Defaults to an instance of BeamSettings with beam_type set to BeamType.ION.</span>

<span class="sd">    Methods:</span>

<span class="sd">        to_dict(self) -&gt; dict: Converts the current state of the Microscope to a dictionary and returns it.</span>
<span class="sd">        from_dict(state_dict: dict) -&gt; &quot;MicroscopeState&quot;: Returns a new instance of MicroscopeState with attributes created from the passed dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timestamp</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
    <span class="n">absolute_position</span><span class="p">:</span> <span class="n">FibsemStagePosition</span> <span class="o">=</span> <span class="n">FibsemStagePosition</span><span class="p">()</span>
    <span class="n">eb_settings</span><span class="p">:</span> <span class="n">BeamSettings</span> <span class="o">=</span> <span class="n">BeamSettings</span><span class="p">(</span><span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span><span class="p">)</span>
    <span class="n">ib_settings</span><span class="p">:</span> <span class="n">BeamSettings</span> <span class="o">=</span> <span class="n">BeamSettings</span><span class="p">(</span><span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">)</span>
    <span class="n">eb_detector</span><span class="p">:</span> <span class="n">FibsemDetectorSettings</span> <span class="o">=</span> <span class="n">FibsemDetectorSettings</span><span class="p">()</span>
    <span class="n">ib_detector</span><span class="p">:</span> <span class="n">FibsemDetectorSettings</span> <span class="o">=</span> <span class="n">FibsemDetectorSettings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">absolute_position</span><span class="p">,</span><span class="n">FibsemStagePosition</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolute_position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;absolute position must be of type FibsemStagePosition, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">absolute_position</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eb_settings</span><span class="p">,</span><span class="n">BeamSettings</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">eb_settings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;eb_settings must be of type BeamSettings, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eb_settings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ib_settings</span><span class="p">,</span><span class="n">BeamSettings</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ib_settings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ib_settings must be of type BeamSettings, currently us </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ib_settings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eb_detector</span><span class="p">,</span><span class="n">FibsemDetectorSettings</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">eb_detector</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;eb_detector must be of type FibsemDetectorSettings, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eb_detector</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ib_detector</span><span class="p">,</span><span class="n">FibsemDetectorSettings</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ib_detector</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ib_detector must be of type FibsemDetectorSettings, currently is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ib_detector</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

        <span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
            <span class="s2">&quot;absolute_position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolute_position</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolute_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Not defined&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eb_settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">eb_settings</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eb_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Not defined&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ib_settings&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ib_settings</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ib_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Not defined&quot;</span><span class="p">,</span>
            <span class="s2">&quot;eb_detector&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">eb_detector</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eb_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Not defined&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ib_detector&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ib_detector</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ib_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Not defined&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">state_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">state_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MicroscopeState&quot;</span><span class="p">:</span>
        <span class="n">microscope_state</span> <span class="o">=</span> <span class="n">MicroscopeState</span><span class="p">(</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span>
            <span class="n">absolute_position</span><span class="o">=</span><span class="n">FibsemStagePosition</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;absolute_position&quot;</span><span class="p">]),</span>
            <span class="n">eb_settings</span><span class="o">=</span><span class="n">BeamSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;eb_settings&quot;</span><span class="p">]),</span>
            <span class="n">ib_settings</span><span class="o">=</span><span class="n">BeamSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;ib_settings&quot;</span><span class="p">]),</span>
            <span class="n">eb_detector</span><span class="o">=</span><span class="n">FibsemDetectorSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;eb_detector&quot;</span><span class="p">,{})),</span>
            <span class="n">ib_detector</span><span class="o">=</span><span class="n">FibsemDetectorSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">state_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ib_detector&quot;</span><span class="p">,{})),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">microscope_state</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.Point" class="doc doc-heading">
          <code>Point</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Point&quot;</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__to_list__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_list__</span><span class="p">(</span><span class="n">l</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Point&quot;</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Point&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Point&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Index out of range&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_to_metres</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pixel_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Point&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">pixel_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">pixel_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_to_pixels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pixel_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Point&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">pixel_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">pixel_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Point&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the distance between two points. (other - self)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">euclidean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the euclidean distance between two points.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">__to_list__</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.Point.distance" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">distance</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate the distance between two points. (other - self)</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Point&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the distance between two points. (other - self)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="fibsem.structures.Point.euclidean" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">euclidean</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate the euclidean distance between two points.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">euclidean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the euclidean distance between two points.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">__to_list__</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.StageSettings" class="doc doc-heading">
          <code>StageSettings</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>A data class representing the settings for the stage.</p>
<p>Attributes:
rotation_flat_to_electron (float): The rotation from flat to electron in degrees.
rotation_flat_to_ion (float): The rotation from flat to ion in degrees.
tilt_flat_to_electron (float): The tilt from flat to electron in degrees.
tilt_flat_to_ion (float): The tilt from flat to ion in degrees.
pre_tilt (float): The pre-tilt in degrees.
needle_stage_height_limit (float): The height limit of the needle stage in meters.</p>
<p>Methods:
<strong>to_dict</strong>() -&gt; dict: Returns the settings as a dictionary.
<strong>from_dict</strong>(settings: dict) -&gt; "StageSettings": Returns an instance of StageSettings from a dictionary of its settings.</p>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">StageSettings</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A data class representing the settings for the stage.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    rotation_flat_to_electron (float): The rotation from flat to electron in degrees.</span>
<span class="sd">    rotation_flat_to_ion (float): The rotation from flat to ion in degrees.</span>
<span class="sd">    tilt_flat_to_electron (float): The tilt from flat to electron in degrees.</span>
<span class="sd">    tilt_flat_to_ion (float): The tilt from flat to ion in degrees.</span>
<span class="sd">    pre_tilt (float): The pre-tilt in degrees.</span>
<span class="sd">    needle_stage_height_limit (float): The height limit of the needle stage in meters.</span>

<span class="sd">    Methods:</span>
<span class="sd">    __to_dict__() -&gt; dict: Returns the settings as a dictionary.</span>
<span class="sd">    __from_dict__(settings: dict) -&gt; &quot;StageSettings&quot;: Returns an instance of StageSettings from a dictionary of its settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rotation_flat_to_electron</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># degrees</span>
    <span class="n">rotation_flat_to_ion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">230</span>  <span class="c1"># degrees</span>
    <span class="n">tilt_flat_to_electron</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">27</span>  <span class="c1"># degrees (pre_tilt)</span>
    <span class="n">tilt_flat_to_ion</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">52</span>  <span class="c1"># degrees</span>
    <span class="n">pre_tilt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">35</span>  <span class="c1"># degrees</span>
    <span class="n">needle_stage_height_limit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.7e-3</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rotation_flat_to_electron&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_flat_to_electron</span><span class="p">,</span>
            <span class="s2">&quot;rotation_flat_to_ion&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_flat_to_ion</span><span class="p">,</span>
            <span class="s2">&quot;tilt_flat_to_electron&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tilt_flat_to_electron</span><span class="p">,</span>
            <span class="s2">&quot;tilt_flat_to_ion&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tilt_flat_to_ion</span><span class="p">,</span>
            <span class="s2">&quot;pre_tilt&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_tilt</span><span class="p">,</span>
            <span class="s2">&quot;needle_stage_height_limit&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">needle_stage_height_limit</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">settings</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;StageSettings&quot;</span><span class="p">:</span>

        <span class="n">stage_settings</span> <span class="o">=</span> <span class="n">StageSettings</span><span class="p">(</span>
            <span class="n">rotation_flat_to_electron</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;rotation_flat_to_electron&quot;</span><span class="p">],</span>
            <span class="n">rotation_flat_to_ion</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;rotation_flat_to_ion&quot;</span><span class="p">],</span>
            <span class="n">tilt_flat_to_electron</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;tilt_flat_to_electron&quot;</span><span class="p">],</span>
            <span class="n">tilt_flat_to_ion</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;tilt_flat_to_ion&quot;</span><span class="p">],</span>
            <span class="n">pre_tilt</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pre_tilt&quot;</span><span class="p">],</span>
            <span class="n">needle_stage_height_limit</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;needle_stage_height_limit&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">stage_settings</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="fibsem.structures.SystemSettings" class="doc doc-heading">
          <code>SystemSettings</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Dataclass representing the system settings for the FIB-SEM instrument.</p>
<p>:param ip_address: IP address of the instrument.
:param stage: settings for the stage.
:param ion: settings for the ion beam.
:param electron: settings for the electron beam.
:param manufacturer: name of the instrument manufacturer.</p>
<p>:return: a new instance of <code>SystemSettings</code>.</p>

            <details class="quote">
              <summary>Source code in <code>fibsem/structures.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">SystemSettings</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dataclass representing the system settings for the FIB-SEM instrument.</span>

<span class="sd">    :param ip_address: IP address of the instrument.</span>
<span class="sd">    :param stage: settings for the stage.</span>
<span class="sd">    :param ion: settings for the ion beam.</span>
<span class="sd">    :param electron: settings for the electron beam.</span>
<span class="sd">    :param manufacturer: name of the instrument manufacturer.</span>

<span class="sd">    :return: a new instance of `SystemSettings`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;10.0.0.1&quot;</span>
    <span class="n">stage</span><span class="p">:</span> <span class="n">StageSettings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ion</span><span class="p">:</span> <span class="n">BeamSystemSettings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">electron</span><span class="p">:</span> <span class="n">BeamSystemSettings</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">manufacturer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">system_info</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__to_dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

        <span class="n">settings_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ip_address</span><span class="p">,</span>
            <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">(),</span>
            <span class="s2">&quot;ion&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ion</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">(),</span>
            <span class="s2">&quot;electron&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">electron</span><span class="o">.</span><span class="n">__to_dict__</span><span class="p">(),</span>
            <span class="s2">&quot;manufacturer&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">manufacturer</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">]</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">settings_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SystemSettings&quot;</span><span class="p">:</span>

        <span class="n">system_settings</span> <span class="o">=</span> <span class="n">SystemSettings</span><span class="p">(</span>
            <span class="n">ip_address</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;ip_address&quot;</span><span class="p">],</span>
            <span class="n">stage</span><span class="o">=</span><span class="n">StageSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">]),</span>
            <span class="n">ion</span><span class="o">=</span><span class="n">BeamSystemSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">],</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">),</span>
            <span class="n">electron</span><span class="o">=</span><span class="n">BeamSystemSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span>
                <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;electron&quot;</span><span class="p">],</span> <span class="n">BeamType</span><span class="o">.</span><span class="n">ELECTRON</span>
            <span class="p">),</span>
            <span class="n">manufacturer</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">],</span>
            <span class="n">system_info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="s2">&quot;manufacturer&quot;</span><span class="p">:</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">],</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
                <span class="s2">&quot;version&quot;</span><span class="p">:</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">],</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">system_settings</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>



<div class="doc doc-object doc-function">




<h2 id="fibsem.structures.check_data_format" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">check_data_format</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Checks that data is in the correct format.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_data_format</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks that data is in the correct format.&quot;&quot;&quot;</span>
    <span class="c1"># assert data.ndim == 2  # or data.ndim == 3</span>
    <span class="c1"># assert data.dtype in [np.uint8, np.uint16]</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.structures.load_needle_yaml" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load_needle_yaml</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Load the manipulator position from disk</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_needle_yaml</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ManipulatorPosition</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the manipulator position from disk&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">fibsem.structures</span> <span class="kn">import</span> <span class="n">manipulator_position_from_dict</span>

    <span class="n">position_dict</span> <span class="o">=</span> <span class="n">load_yaml</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;needle.yaml&quot;</span><span class="p">))</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">manipulator_position_from_dict</span><span class="p">(</span><span class="n">position_dict</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">position</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.structures.save_needle_yaml" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save_needle_yaml</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Save the manipulator position from disk</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_needle_yaml</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">ManipulatorPosition</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save the manipulator position from disk&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">fibsem.structures</span> <span class="kn">import</span> <span class="n">manipulator_position_to_dict</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;needle.yaml&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">manipulator_position_to_dict</span><span class="p">(</span><span class="n">position</span><span class="p">),</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.structures.stage_position_from_dict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">stage_position_from_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Converts a dictionary object to a fibsem stage position,
dictionary must have correct keys</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stage_position_from_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FibsemStagePosition</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a dictionary object to a fibsem stage position,</span>
<span class="sd">        dictionary must have correct keys&quot;&quot;&quot;</span>

    <span class="n">stage_position</span> <span class="o">=</span> <span class="n">FibsemStagePosition</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
        <span class="n">y</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
        <span class="n">z</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
        <span class="n">r</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">],</span>
        <span class="n">t</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">],</span>
        <span class="n">coordinate_system</span><span class="o">=</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;coordinate_system&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">stage_position</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.structures.stage_position_to_dict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">stage_position_to_dict</span><span class="p">(</span><span class="n">stage_position</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Converts the FibsemStagePosition Object into a dictionary</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/structures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stage_position_to_dict</span><span class="p">(</span><span class="n">stage_position</span><span class="p">:</span> <span class="n">FibsemStagePosition</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts the FibsemStagePosition Object into a dictionary&quot;&quot;&quot;</span>

    <span class="c1"># attributes = [&quot;x&quot;,&quot;y&quot;,&quot;z&quot;,&quot;r&quot;,&quot;t&quot;]</span>
    <span class="c1"># for attribute in attributes:</span>
    <span class="c1">#     assert isinstance(getattr(stage_position,attribute),float) or isinstance(getattr(stage_position,attribute),int)</span>

    <span class="c1">#assert stage_position.coordinate_system in SUPPORTED_COORDINATE_SYSTEMS or stage_position.coordinate_system is None</span>

    <span class="n">stage_position_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">stage_position</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">stage_position</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
        <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">stage_position</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
        <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="n">stage_position</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
        <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="n">stage_position</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
        <span class="s2">&quot;coordinate_system&quot;</span><span class="p">:</span> <span class="n">stage_position</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">stage_position_dict</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="utils">Utils</h2>


<div class="doc doc-object doc-module">



<a id="fibsem.utils"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="fibsem.utils.configure_logging" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">configure_logging</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">log_filename</span><span class="o">=</span><span class="s1">&#39;logfile&#39;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">_DEBUG</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Log to the terminal and to file simultaneously.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">configure_logging</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">log_filename</span><span class="o">=</span><span class="s2">&quot;logfile&quot;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">_DEBUG</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log to the terminal and to file simultaneously.&quot;&quot;&quot;</span>
    <span class="n">logfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">log_filename</span><span class="si">}</span><span class="s2">.log&quot;</span><span class="p">)</span>

    <span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">logfile</span><span class="p">)</span>
    <span class="n">stream_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">stream_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span> <span class="k">if</span> <span class="n">_DEBUG</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> — </span><span class="si">%(name)s</span><span class="s2"> — </span><span class="si">%(levelname)s</span><span class="s2"> — </span><span class="si">%(funcName)s</span><span class="s2">:</span><span class="si">%(lineno)d</span><span class="s2"> — </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">level</span><span class="o">=</span><span class="n">log_level</span><span class="p">,</span>
        <span class="c1"># Multiple handlers can be added to your logging configuration.</span>
        <span class="c1"># By default log messages are appended to the file if it exists already</span>
        <span class="n">handlers</span><span class="o">=</span><span class="p">[</span><span class="n">file_handler</span><span class="p">,</span> <span class="n">stream_handler</span><span class="p">],</span>
        <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">logfile</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.utils.create_gif" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_gif</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">gif_fname</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Creates a GIF from a set of images. Images must be in same folder</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Path to images folder</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>search</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>search name</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>gif_fname</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>name to save gif file</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>loop</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><em>description</em>. Defaults to 0.</p>
            </div>
          </td>
          <td>
                <code>0</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_gif</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">search</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">gif_fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">loop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a GIF from a set of images. Images must be in same folder</span>

<span class="sd">    Args:</span>
<span class="sd">        path (Path): Path to images folder</span>
<span class="sd">        search (str): search name</span>
<span class="sd">        gif_fname (str): name to save gif file</span>
<span class="sd">        loop (int, optional): _description_. Defaults to 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">search</span><span class="p">))</span>

    <span class="n">imgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">FibsemImage</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span><span class="si">}</span><span class="s2"> images added to gif.&quot;</span><span class="p">)</span>
    <span class="n">imgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gif_fname</span><span class="si">}</span><span class="s2">.gif&quot;</span><span class="p">),</span>
        <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">append_images</span><span class="o">=</span><span class="n">imgs</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
        <span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.utils.current_timestamp" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">current_timestamp</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns current time in a specific string format</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>String</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Current time</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">current_timestamp</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns current time in a specific string format</span>

<span class="sd">    Returns:</span>
<span class="sd">        String: Current time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">-%I-%M-%S%p&quot;</span><span class="p">)</span> <span class="c1">#PM/AM doesnt work?</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.utils.current_timestamp_v2" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">current_timestamp_v2</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns current time in a specific string format</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>String</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Current time</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">current_timestamp_v2</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns current time in a specific string format</span>

<span class="sd">    Returns:</span>
<span class="sd">        String: Current time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.utils.get_params" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_params</span><span class="p">(</span><span class="n">main_str</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Helper function to access relevant metadata parameters from sub field</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>main_str</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Sub string of relevant metadata</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>list</code></td>          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Parameters covered by metadata</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="n">main_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to access relevant metadata parameters from sub field</span>

<span class="sd">    Args:</span>
<span class="sd">        main_str (str): Sub string of relevant metadata</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Parameters covered by metadata</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cat_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">i</span> <span class="o">=</span> <span class="n">main_str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">main_str</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">main_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span><span class="p">:</span>
            <span class="n">cats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cat_str</span><span class="p">)</span>
            <span class="n">cat_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="n">main_str</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cat_str</span> <span class="o">+=</span> <span class="n">main_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">cats</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.utils.load_protocol" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load_protocol</span><span class="p">(</span><span class="n">protocol_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Load the protocol file from yaml</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>protocol_path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to protocol file. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>protocol dictionary</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_protocol</span><span class="p">(</span><span class="n">protocol_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the protocol file from yaml</span>

<span class="sd">    Args:</span>
<span class="sd">        protocol_path (Path, optional): path to protocol file. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: protocol dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">protocol_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">protocol</span> <span class="o">=</span> <span class="n">load_yaml</span><span class="p">(</span><span class="n">protocol_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">protocol</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;demo&quot;</span><span class="p">}</span>

    <span class="c1">#protocol = _format_dictionary(protocol)</span>

    <span class="k">return</span> <span class="n">protocol</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.utils.load_settings_from_config" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load_settings_from_config</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">protocol_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Load microscope settings from configuration files</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config_path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to config directory. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>protocol_path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to protocol file. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>MicroscopeSettings</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="fibsem.structures.MicroscopeSettings" href="../started/#fibsem.structures.MicroscopeSettings">MicroscopeSettings</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>microscope settings</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_settings_from_config</span><span class="p">(</span>
    <span class="n">config_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">protocol_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MicroscopeSettings</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load microscope settings from configuration files</span>

<span class="sd">    Args:</span>
<span class="sd">        config_path (Path, optional): path to config directory. Defaults to None.</span>
<span class="sd">        protocol_path (Path, optional): path to protocol file. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MicroscopeSettings: microscope settings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: this should just be system.yaml path, not directory</span>
    <span class="k">if</span> <span class="n">config_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">fibsem.config</span> <span class="kn">import</span> <span class="n">CONFIG_PATH</span>

        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CONFIG_PATH</span><span class="p">,</span> <span class="s2">&quot;system.yaml&quot;</span><span class="p">)</span>

    <span class="c1"># system settings</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">load_yaml</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">))</span>
    <span class="n">system_settings</span> <span class="o">=</span> <span class="n">SystemSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">])</span>

    <span class="c1"># user settings</span>
    <span class="n">image_settings</span> <span class="o">=</span> <span class="n">ImageSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">][</span><span class="s2">&quot;imaging&quot;</span><span class="p">])</span>

    <span class="n">milling_settings</span> <span class="o">=</span> <span class="n">FibsemMillingSettings</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">][</span><span class="s2">&quot;milling&quot;</span><span class="p">])</span>

    <span class="c1"># protocol settings</span>
    <span class="n">protocol</span> <span class="o">=</span> <span class="n">load_protocol</span><span class="p">(</span><span class="n">protocol_path</span><span class="p">)</span>

    <span class="c1"># hardware settings</span>
    <span class="n">hardware_settings</span> <span class="o">=</span> <span class="n">FibsemHardware</span><span class="o">.</span><span class="n">__from_dict__</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">])</span>

    <span class="n">settings</span> <span class="o">=</span> <span class="n">MicroscopeSettings</span><span class="p">(</span>
        <span class="n">system</span><span class="o">=</span><span class="n">system_settings</span><span class="p">,</span>
        <span class="n">image</span><span class="o">=</span><span class="n">image_settings</span><span class="p">,</span>
        <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span><span class="p">,</span>
        <span class="n">milling</span><span class="o">=</span><span class="n">milling_settings</span><span class="p">,</span>
        <span class="n">hardware</span><span class="o">=</span><span class="n">hardware_settings</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">settings</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.utils.load_yaml" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load_yaml</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>load yaml file</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fname</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>yaml file path</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Items in yaml</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_yaml</span><span class="p">(</span><span class="n">fname</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;load yaml file</span>

<span class="sd">    Args:</span>
<span class="sd">        fname (Path): yaml file path</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Items in yaml</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.utils.make_logging_directory" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">make_logging_directory</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;run&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Create a logging directory with the specified name at the specified file path. 
If no path is given, it creates the directory at the default base path.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The file path to create the logging directory at. If None, default base path is used. </p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the logging directory to create. Default is "run".</p>
            </div>
          </td>
          <td>
                <code>&#39;run&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The file path to the created logging directory.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_logging_directory</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;run&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a logging directory with the specified name at the specified file path. </span>
<span class="sd">    If no path is given, it creates the directory at the default base path.</span>

<span class="sd">    Args:</span>
<span class="sd">        path (Path, optional): The file path to create the logging directory at. If None, default base path is used. </span>
<span class="sd">        name (str, optional): The name of the logging directory to create. Default is &quot;run&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The file path to the created logging directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">BASE_PATH</span><span class="p">,</span> <span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">directory</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.utils.save_yaml" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save_yaml</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Saves a python dictionary object to a yaml file</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path location to save yaml file</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dictionary object</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_yaml</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves a python dictionary object to a yaml file</span>

<span class="sd">    Args:</span>
<span class="sd">        path (Path): path location to save yaml file</span>
<span class="sd">        data (dict): dictionary object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.yaml&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.utils.setup_session" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">setup_session</span><span class="p">(</span><span class="n">session_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">protocol_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setup_logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ip_address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">manufacturer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Setup microscope session</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>session_path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to logging directory</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>config_path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to config directory (system.yaml)</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>protocol_path</code></td>
          <td>
                <code><span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to protocol file</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>tuple</code></td>          <td>
                <code>tuple[<span title="fibsem.microscope.FibsemMicroscope">FibsemMicroscope</span>, <a class="autorefs autorefs-internal" title="fibsem.structures.MicroscopeSettings" href="../started/#fibsem.structures.MicroscopeSettings">MicroscopeSettings</a>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>microscope, settings</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_session</span><span class="p">(</span>
    <span class="n">session_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">protocol_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">setup_logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">manufacturer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">MicroscopeSettings</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup microscope session</span>

<span class="sd">    Args:</span>
<span class="sd">        session_path (Path): path to logging directory</span>
<span class="sd">        config_path (Path): path to config directory (system.yaml)</span>
<span class="sd">        protocol_path (Path): path to protocol file</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: microscope, settings</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># load settings</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">load_settings_from_config</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">protocol_path</span><span class="p">)</span>

    <span class="c1"># create session directories</span>
    <span class="n">session</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">protocol</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">current_timestamp</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="n">protocol_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">protocol_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="c1"># configure paths</span>
    <span class="k">if</span> <span class="n">session_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">session_path</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">LOG_PATH</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">session_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># configure logging</span>
    <span class="k">if</span> <span class="n">setup_logging</span><span class="p">:</span>
        <span class="n">configure_logging</span><span class="p">(</span><span class="n">session_path</span><span class="p">)</span>

    <span class="c1"># connect to microscope</span>
    <span class="kn">import</span> <span class="nn">fibsem.microscope</span> <span class="k">as</span> <span class="nn">FibSem</span>

    <span class="c1"># cheap overloading</span>
    <span class="k">if</span> <span class="n">ip_address</span><span class="p">:</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">ip_address</span> <span class="o">=</span> <span class="n">ip_address</span>

    <span class="k">if</span> <span class="n">manufacturer</span><span class="p">:</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">manufacturer</span> <span class="o">=</span> <span class="n">manufacturer</span>

    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">manufacturer</span> <span class="o">==</span> <span class="s2">&quot;Thermo&quot;</span><span class="p">:</span>
        <span class="n">microscope</span> <span class="o">=</span> <span class="n">FibSem</span><span class="o">.</span><span class="n">ThermoMicroscope</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">hardware</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">stage</span><span class="p">)</span>
        <span class="n">microscope</span><span class="o">.</span><span class="n">connect_to_microscope</span><span class="p">(</span>
            <span class="n">ip_address</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">ip_address</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">7520</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">settings</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">manufacturer</span> <span class="o">==</span> <span class="s2">&quot;Tescan&quot;</span><span class="p">:</span>
        <span class="n">microscope</span> <span class="o">=</span> <span class="n">FibSem</span><span class="o">.</span><span class="n">TescanMicroscope</span><span class="p">(</span><span class="n">ip_address</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">ip_address</span><span class="p">,</span> <span class="n">hardware_settings</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">hardware</span><span class="p">,</span> <span class="n">stage_settings</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">stage</span><span class="p">)</span>
        <span class="n">microscope</span><span class="o">.</span><span class="n">connect_to_microscope</span><span class="p">(</span>
            <span class="n">ip_address</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">ip_address</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8300</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">settings</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">manufacturer</span> <span class="o">==</span> <span class="s2">&quot;Demo&quot;</span><span class="p">:</span>
        <span class="n">microscope</span> <span class="o">=</span> <span class="n">FibSem</span><span class="o">.</span><span class="n">DemoMicroscope</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">hardware</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">stage</span><span class="p">)</span>
        <span class="n">microscope</span><span class="o">.</span><span class="n">connect_to_microscope</span><span class="p">()</span>

    <span class="c1"># image_settings</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">session_path</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished setup for session: </span><span class="si">{</span><span class="n">session</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="validation">Validation</h2>


<div class="doc doc-object doc-module">



<a id="fibsem.validation"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="fibsem.validation.check_shift_within_tolerance" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">check_shift_within_tolerance</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ref_image</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Check if required shift is wihtin safety limit</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/validation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_shift_within_tolerance</span><span class="p">(</span>
    <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">ref_image</span><span class="p">:</span> <span class="n">FibsemImage</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if required shift is wihtin safety limit&quot;&quot;&quot;</span>
    <span class="c1"># check if the cross correlation movement is within the safety limit</span>

    <span class="n">pixelsize_x</span> <span class="o">=</span> <span class="n">ref_image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">x</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">ref_image</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">resolution</span>
    <span class="n">X_THRESHOLD</span> <span class="o">=</span> <span class="n">limit</span> <span class="o">*</span> <span class="n">pixelsize_x</span> <span class="o">*</span> <span class="n">width</span>
    <span class="n">Y_THRESHOLD</span> <span class="o">=</span> <span class="n">limit</span> <span class="o">*</span> <span class="n">pixelsize_x</span> <span class="o">*</span> <span class="n">height</span>

    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">X_THRESHOLD</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">Y_THRESHOLD</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.validation.validate_initial_microscope_state" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">validate_initial_microscope_state</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Set the initial microscope state to default, and validate other settings.</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/validation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_initial_microscope_state</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="n">MicroscopeSettings</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the initial microscope state to default, and validate other settings.&quot;&quot;&quot;</span>

    <span class="c1"># validate chamber state</span>
    <span class="n">_validate_chamber_state</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>

    <span class="c1"># validate stage calibration (homed, linked)</span>
    <span class="n">_validate_stage_calibration</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>

    <span class="c1"># validate needle calibration (needle calibration, retracted)</span>
    <span class="n">_validate_needle_calibration</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">)</span>

    <span class="c1"># validate beam settings and calibration</span>
    <span class="n">_validate_beam_system_settings</span><span class="p">(</span><span class="n">microscope</span><span class="o">=</span><span class="n">microscope</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span>

    <span class="c1"># validate scan rotation</span>
    <span class="n">microscope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;scan_rotation&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">beam_type</span><span class="o">=</span><span class="n">BeamType</span><span class="o">.</span><span class="n">ION</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.validation.validate_stage_height_for_needle_insertion" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">validate_stage_height_for_needle_insertion</span><span class="p">(</span><span class="n">microscope</span><span class="p">,</span> <span class="n">needle_stage_height_limit</span><span class="o">=</span><span class="mf">0.0037</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Check if the needle can be inserted, based on the current stage height.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microscope</code></td>
          <td>
                <code>SdbMicroscopeClient</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>autoscript microscope limit</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>needle_stage_height_limit</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>minimum stage height limit. Defaults to 3.7e-3.</p>
            </div>
          </td>
          <td>
                <code>0.0037</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>bool</code></td>          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>needle is insertable</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/validation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_stage_height_for_needle_insertion</span><span class="p">(</span>
    <span class="n">microscope</span><span class="p">:</span> <span class="n">FibsemMicroscope</span><span class="p">,</span> <span class="n">needle_stage_height_limit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.7e-3</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the needle can be inserted, based on the current stage height.</span>

<span class="sd">    Args:</span>
<span class="sd">        microscope (SdbMicroscopeClient): autoscript microscope limit</span>
<span class="sd">        needle_stage_height_limit (float, optional): minimum stage height limit. Defaults to 3.7e-3.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: needle is insertable</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">stage_position</span> <span class="o">=</span> <span class="n">microscope</span><span class="o">.</span><span class="n">get_stage_position</span><span class="p">()</span>

    <span class="c1"># Unable to insert the needle if the stage height is below this limit (3.7e-3)</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">stage_position</span><span class="o">.</span><span class="n">z</span> <span class="o">&gt;</span> <span class="n">needle_stage_height_limit</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="detection">Detection</h2>


<div class="doc doc-object doc-module">



<a id="fibsem.detection.detection"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="fibsem.detection.detection.detect_bounding_box" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">detect_bounding_box</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Detect the bounding edge points of the mask for a given color (label)</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>mask</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the detection mask (PIL.Image)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>color</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the color of the label for the feature to detect (rgb tuple)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the minimum number of required pixels for a detection to count (int)</p>
            </div>
          </td>
          <td>
                <code>25</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>return:</p>
<pre><code>edge_px: the pixel coordinates of the edge points of the feature list((tuple))
</code></pre>

          <details class="quote">
            <summary>Source code in <code>fibsem/detection/detection.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">detect_bounding_box</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">25</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Detect the bounding edge points of the mask for a given color (label)</span>

<span class="sd">    args:</span>
<span class="sd">        mask: the detection mask (PIL.Image)</span>
<span class="sd">        color: the color of the label for the feature to detect (rgb tuple)</span>
<span class="sd">        threshold: the minimum number of required pixels for a detection to count (int)</span>

<span class="sd">    return:</span>

<span class="sd">        edge_px: the pixel coordinates of the edge points of the feature list((tuple))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">top_px</span><span class="p">,</span> <span class="n">bottom_px</span><span class="p">,</span> <span class="n">left_px</span><span class="p">,</span> <span class="n">right_px</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># extract class pixels</span>
    <span class="n">class_mask</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">extract_class_pixels</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

    <span class="c1"># only return an edge point if detection is above a threshold</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="c1"># convert mask to coordinates</span>
        <span class="n">px</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># get index of each value</span>
        <span class="n">top_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">bottom_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">left_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">right_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># pixel coordinates</span>
        <span class="n">top_px</span> <span class="o">=</span> <span class="n">px</span><span class="p">[</span><span class="n">top_idx</span><span class="p">]</span>
        <span class="n">bottom_px</span> <span class="o">=</span> <span class="n">px</span><span class="p">[</span><span class="n">bottom_idx</span><span class="p">]</span>
        <span class="n">left_px</span> <span class="o">=</span> <span class="n">px</span><span class="p">[</span><span class="n">left_idx</span><span class="p">]</span>
        <span class="n">right_px</span> <span class="o">=</span> <span class="n">px</span><span class="p">[</span><span class="n">right_idx</span><span class="p">]</span>

    <span class="c1"># bbox should be (x0, y0), (x1, y1)</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">top_px</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">left_px</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">bottom_px</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">right_px</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bbox</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.detection.detection.detect_centre_point" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">detect_centre_point</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Detect the centre (mean) point of the mask for a given color (label)</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>mask</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the detection mask (PIL.Image)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>idx</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the index of the desired class in the mask (int)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the minimum number of required pixels for a detection to count (int)</p>
            </div>
          </td>
          <td>
                <code>500</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>return:</p>
<pre><code>centre_px: the pixel coordinates of the centre point of the feature (tuple)
</code></pre>

          <details class="quote">
            <summary>Source code in <code>fibsem/detection/detection.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">detect_centre_point</span><span class="p">(</span><span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Detect the centre (mean) point of the mask for a given color (label)</span>

<span class="sd">    args:</span>
<span class="sd">        mask: the detection mask (PIL.Image)</span>
<span class="sd">        idx: the index of the desired class in the mask (int)</span>
<span class="sd">        threshold: the minimum number of required pixels for a detection to count (int)</span>

<span class="sd">    return:</span>

<span class="sd">        centre_px: the pixel coordinates of the centre point of the feature (tuple)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">centre_px</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># get mask px coordinates</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

    <span class="c1"># only return a centre point if detection is above a threshold</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="c1"># get the centre point of each coordinate</span>
        <span class="n">y_mid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">x_mid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># centre coordinate as tuple</span>
        <span class="n">centre_px</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_mid</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_mid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">centre_px</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.detection.detection.detect_closest_edge_v2" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">detect_closest_edge_v2</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">landing_pt</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Identify the closest edge point to the initially selected point</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>img</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>base image (np.ndarray)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>landing_px</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the initial landing point pixel (tuple) (y, x) format</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>return:
    landing_edge_pt: the closest edge point to the intitially selected point (tuple)
    edges: the edge mask (np.array)</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/detection/detection.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">detect_closest_edge_v2</span><span class="p">(</span>
    <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">landing_pt</span><span class="p">:</span> <span class="n">Point</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Identify the closest edge point to the initially selected point</span>

<span class="sd">    args:</span>
<span class="sd">        img: base image (np.ndarray)</span>
<span class="sd">        landing_px: the initial landing point pixel (tuple) (y, x) format</span>
<span class="sd">    return:</span>
<span class="sd">        landing_edge_pt: the closest edge point to the intitially selected point (tuple)</span>
<span class="sd">        edges: the edge mask (np.array)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># identify edge pixels</span>
    <span class="n">landing_px</span> <span class="o">=</span> <span class="p">(</span><span class="n">landing_pt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">landing_pt</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">edge_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="n">edge_px</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">edge_mask</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_mask</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="c1"># set min distance</span>
    <span class="n">min_dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1"># TODO: vectorise this like</span>
    <span class="c1"># https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise.euclidean_distances.html</span>

    <span class="n">landing_edge_px</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">px</span> <span class="ow">in</span> <span class="n">edge_px</span><span class="p">:</span>

        <span class="c1"># distance between edges and landing point</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">landing_px</span><span class="p">,</span> <span class="n">px</span><span class="p">)</span>

        <span class="c1"># select point with min</span>
        <span class="k">if</span> <span class="n">dst</span> <span class="o">&lt;</span> <span class="n">min_dst</span><span class="p">:</span>
            <span class="n">min_dst</span> <span class="o">=</span> <span class="n">dst</span>
            <span class="n">landing_edge_px</span> <span class="o">=</span> <span class="n">px</span>

    <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">landing_edge_px</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">y</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">landing_edge_px</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.detection.detection.extract_class_pixels" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">extract_class_pixels</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Extract only the pixels that are classified as the desired class (color)</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>mask</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>detection mask containing all detection classes (np.array)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>color</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the color of the specified class in the mask (rgb tuple)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>return</summary>
  <p>class_mask: the mask containing only the selected class
idx: the indexes of the detected class in the mask</p>
</details>
          <details class="quote">
            <summary>Source code in <code>fibsem/detection/detection.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_class_pixels</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Extract only the pixels that are classified as the desired class (color)</span>

<span class="sd">    args:</span>
<span class="sd">        mask: detection mask containing all detection classes (np.array)</span>
<span class="sd">        color: the color of the specified class in the mask (rgb tuple)</span>

<span class="sd">    return:</span>
<span class="sd">        class_mask: the mask containing only the selected class</span>
<span class="sd">        idx: the indexes of the detected class in the mask</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: should the class masks be binary?? probs easier</span>

    <span class="c1"># extract only label pixels to find edges</span>
    <span class="n">class_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">color</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">class_mask</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>

    <span class="k">return</span> <span class="n">class_mask</span><span class="p">,</span> <span class="n">idx</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.detection.detection.plot_detection" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">plot_detection</span><span class="p">(</span><span class="n">det</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Plotting image with detected features</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>det</code></td>
          <td>
                <code><span title="fibsem.detection.detection.DetectedFeatures">DetectedFeatures</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>detected features type</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>inverse</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Inverses the colour of the centre crosshair of the feature. Defaults to True.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/detection/detection.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_detection</span><span class="p">(</span><span class="n">det</span><span class="p">:</span> <span class="n">DetectedFeatures</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plotting image with detected features</span>

<span class="sd">    Args:</span>
<span class="sd">        det (DetectedFeatures): detected features type</span>
<span class="sd">        inverse (bool, optional): Inverses the colour of the centre crosshair of the feature. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_det</span><span class="p">(</span><span class="n">det</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.detection.detection.plot_detections" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">plot_detections</span><span class="p">(</span><span class="n">dets</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Plotting image with detected features</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>det</code></td>
          <td>
                <code><span title="fibsem.detection.detection.DetectedFeatures">DetectedFeatures</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>detected features type</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>inverse</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Inverses the colour of the centre crosshair of the feature. Defaults to True.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>fibsem/detection/detection.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_detections</span><span class="p">(</span><span class="n">dets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DetectedFeatures</span><span class="p">],</span> <span class="n">titles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plotting image with detected features</span>

<span class="sd">    Args:</span>
<span class="sd">        det (DetectedFeatures): detected features type</span>
<span class="sd">        inverse (bool, optional): Inverses the colour of the centre crosshair of the feature. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

    <span class="k">if</span> <span class="n">titles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Prediction </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dets</span><span class="p">))]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dets</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">det</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dets</span><span class="p">):</span>

        <span class="n">plot_det</span><span class="p">(</span><span class="n">det</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="fibsem.detection.utils"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="fibsem.detection.utils.coordinate_distance" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">coordinate_distance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Calculate the distance between two points in each coordinate</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/detection/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">coordinate_distance</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the distance between two points in each coordinate&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.detection.utils.decode_segmap" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">decode_segmap</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Decode segmentation class mask into an RGB image mask</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/detection/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">decode_segmap</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; Decode segmentation class mask into an RGB image mask&quot;&quot;&quot;</span>

    <span class="c1"># 0=background, 1=lamella, 2= needle</span>
    <span class="n">label_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>

    <span class="c1"># pre-allocate r, g, b channels as zero</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="c1"># apply the class label colours to each pixel</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">image</span> <span class="o">==</span> <span class="n">l</span>
        <span class="n">r</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_colors</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">g</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_colors</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">b</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_colors</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="c1"># stack rgb channels to form an image</span>
    <span class="n">rgb_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rgb_mask</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.detection.utils.extract_img_for_labelling" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">extract_img_for_labelling</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Extract all the images that have been identified for retraining.</p>
<p>path: path to directory containing logged images</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/detection/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_img_for_labelling</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract all the images that have been identified for retraining.</span>

<span class="sd">    path: path to directory containing logged images</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">datetime</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="kn">import</span> <span class="nn">time</span>

    <span class="kn">import</span> <span class="nn">liftout</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

    <span class="c1"># mkdir for copying images to</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">liftout</span><span class="o">.</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;retrain&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Searching in </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> for retraining images...&quot;</span><span class="p">)</span>

    <span class="c1"># find all files for retraining (with _label postfix</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;/**/*label*.tif&quot;</span><span class="p">),</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span><span class="si">}</span><span class="s2"> images found for relabelling&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copying images to </span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
        <span class="c1"># tqdm?</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copying </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># basename = os.path.basename(fname)</span>
        <span class="n">datetime_str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
            <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">.%H%M%S&quot;</span>
        <span class="p">)</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime_str</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="si">}</span><span class="s2">.tif&quot;</span>  <span class="c1"># use a random number to prevent duplicates at seconds time resolution</span>
        <span class="c1"># print(fname, basename)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">source_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">destination_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">basename</span><span class="p">)</span>
        <span class="c1"># print(f&quot;Source: {source_path}&quot;)</span>
        <span class="c1"># print(f&quot;Destination: {destination_path}&quot;)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.detection.utils.get_scale_invariant_coordinates" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_scale_invariant_coordinates</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert the point coordinates from image coordinates to scale invariant coordinates</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/detection/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_scale_invariant_coordinates</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the point coordinates from image coordinates to scale invariant coordinates&quot;&quot;&quot;</span>
    <span class="n">scaled_pt</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">point</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">scaled_pt</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.detection.utils.scale_coordinate_to_image" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">scale_coordinate_to_image</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Scale invariant coordinates to image shape</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/detection/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">scale_coordinate_to_image</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scale invariant coordinates to image shape&quot;&quot;&quot;</span>
    <span class="n">scaled_pt</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">y</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">scaled_pt</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="fibsem.detection.utils.scale_pixel_coordinates" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">scale_pixel_coordinates</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">from_image</span><span class="p">,</span> <span class="n">to_image</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Scale the pixel coordinate from one image to another</p>

          <details class="quote">
            <summary>Source code in <code>fibsem/detection/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">scale_pixel_coordinates</span><span class="p">(</span><span class="n">px</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">from_image</span><span class="p">:</span> <span class="n">FibsemImage</span><span class="p">,</span> <span class="n">to_image</span><span class="p">:</span> <span class="n">FibsemImage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scale the pixel coordinate from one image to another&quot;&quot;&quot;</span>

    <span class="n">invariant_pt</span> <span class="o">=</span> <span class="n">get_scale_invariant_coordinates</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">from_image</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">scaled_px</span> <span class="o">=</span> <span class="n">scale_coordinate_to_image</span><span class="p">(</span><span class="n">invariant_pt</span><span class="p">,</span> <span class="n">to_image</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">scaled_px</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="user-interface">User Interface</h2>


<div class="doc doc-object doc-module">



<a id="fibsem.ui"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">











  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.4e0fa4ba.min.js"></script>
      
    
  </body>
</html>